/*! Pc.Heigh-ho.Renovation-1.0.0.js 2017-03-21 */
!function(){var a,b,c=angular.module("heeyhomeApp"),d="/api/public/panorama/gettags",e="/api/public/panorama",f="/api/public/panorama/scan",g="/api/public/panorama/like",h="/api/public/panorama/collect",i={area:1,housetype:1,servicetag:1,orderKey:0,pageVal:1,limitVal:8},j={init:function(){j.initEvent()},initEvent:function(){var a=this;a.initGetTagsEvent(),i={area:1,housetype:1,servicetag:1,orderKey:0,pageVal:1,limitVal:8},vrContentHandler.vrContentEvent(i)},initGetTagsEvent:function(){$.ajax({url:d,type:"GET",async:!0,dataType:"jsonp",beforeSend:function(){$(".fliter").addClass("loagbg")},complete:function(){$(".fliter").removeClass("loagbg")},error:function(){}}).done(function(a){if(null!=a&&"000"==a.code){var b="";$.each(a.data,function(a,c){b+='<div class="fliter_'+a+'"  data-name='+a+"  >",$.each(c,function(a,c){switch(a){case 0:b+='<span class="fliter_name">'+c+'</span><ul class="fliter_tab" >';break;case 1:b+='<li class="active" data-label="'+a+'" >',b+="<a>"+c+"</a></li>";break;default:b+='<li class="" data-label="'+a+'" >',b+="<a>"+c+"</a></li>"}}),b+="</ul></div>"}),$(".fliter").html(b),tabSelectHandler.tabSelectEvent()}})}};tabSelectHandler={tabSelectEvent:function(){var a=$(".fliter div li");a.on("click",function(){$(this).addClass("active").siblings().removeClass("active");var a=$(this).closest("div"),b=a.siblings();i[a.data("name")]=$(this).data("label"),$.each(b,function(a){i[b.eq(a).data("name")]=b.eq(a).find("li.active").data("label")}),vrContentHandler.vrContentEvent(i)})}},vrContentHandler={vrContentEvent:function(b){var c=$.base64.decode($.cookie("userId"));$.ajax({url:e,type:"GET",async:!0,dataType:"jsonp",data:{user_id:c,area:b.area,housetype:b.housetype,servicetag:b.servicetag,order:b.orderKey,page:b.pageVal,limit:b.limitVal},complete:function(){$(".content_pic").removeClass("vrloagbg")}}).done(function(b){console.log(b),b&&"000"==b.code?(a=b.data[0].total,console.log(b.data[0].total),$(".content_pic").html(spliceVrContentHandler.spliceStrEvent(b.data)),pageHandler.pageContentEvent(c),viewPlus.addView(),addCollect.collectVr(),orderModuleHandler.orderClickEvent()):($(".content_pic").html('<div class="nullpage"><i>&nbsp;</i><span>暂时还没有,设计师正在加班加点的制作中...</span></div>'),$(".page_div3").empty())})}},viewPlus={addView:function(){$(".vr_pic").on("click",function(){var a=$(this).parent().attr("data-id"),b=$(this).parent(".pic_box").find(".pic_view_span");$.ajax({type:"get",url:f,async:!0,dataType:"jsonp",data:{panorama_id:a},success:function(a){a&&"000"==a.code?b.html(a.data.scan_num++):layer.alert(a.msg)},error:function(){}})})}},addCollect={collectVr:function(){$(".pic_badge").on("click",function(a){function b(){window.location.href="register.html?#dl"}var c=$.cookie("userId");if(c=null!=c&&""!=c&&void 0!=c?$.base64.decode($.cookie("userId")):"",""==c)layer.msg("亲，收藏前请先登录哦~"),setTimeout(function(){b()},1500);else{var d=$.cookie("userType");if(1==$.base64.decode(d)){var e=$(this).parents(".pic_box").attr("data-id");$.ajax({type:"get",url:h,async:!0,dataType:"jsonp",data:{user_id:c,panorama_id:e},success:function(b){layer.msg(b.msg),$(a.target).addClass("collect_badge")},error:function(){}})}else layer.alert("此功能暂时只对用户开放")}})}},countPraise={praiseVr:function(){$(".pic_praise").on("click",function(){var a=$(this).parents(".pic_box").attr("data-id");$.ajax({type:"get",url:g,async:!0,dataType:"jsonp",data:{panorama_id:a},success:function(a){a&&"000"==a.code?(a.data.like_num++,vrContentHandler.vrContentEvent(i)):layer.alert(a.msg)},error:function(){}})})}},orderModuleHandler={orderClickEvent:function(){var a=$(".content_title .sort"),b=a.parent().data("name");a.off("click").on("click",function(){$(this).addClass("active").siblings().removeClass("active"),i[b]=$(this).data("label"),vrContentHandler.vrContentEvent(i)})}},spliceVrContentHandler={spliceStrEvent:function(a){var b="";return $.each(a,function(a,c){b+='<div class="pic_box" data-id="'+c.panorama_id+'"><div class="vr_pic">',b+='<a href="'+c.panorama_url+'" target="_blank"><img src="'+c.panorama_img+'" class="now">',b+='<div class="bg_mongolia">',b+='<div class="sprite-image pic_hover"></div></div></a></div>',b+='<div class="pic_introduce">',b+='<div class="pic_style clearfix"><h2>'+c.panorama_style+"</h2></div>",b+='<div class="sprite pic_badge '+(1==c.iscollected?"collect_badge":"")+'" title="点击收藏"></div>',b+='<div class="pic_detail"><p>建筑面积：<em>'+c.panorama_area+"</em>㎡</p><p>"+c.panorama_housetype+"</p></div>",b+='<div class="pic_icon"><div class="pic_view" title="观看数" >',b+='<i class="iconfont">&#xe620;</i><span class="pic_view_span">'+c.scan_num+"</span></div>",b+='<div class="pic_praise" title="点赞数"><i class="iconfont">&#xe611;</i><span>'+c.like_num+"</span></div></div></div></div>"}),b}},pageHandler={pageContentEvent:function(c){b=Math.ceil(a/8),$(".page_number>div").append($(".page_div3").empty().paging({total:b,animation:!1,centerBgColor:"#fff",centerFontColor:"#000",centerBorder:"1px solid #ddd",transition:"all .2s",centerHoverBgColor:"#eec988",centerHoverBorder:"1px solid #eec988",centerFontHoverColor:"#fff",otherFontHoverColor:"#fff",otherBorder:"1px solid #ddd",otherHoverBorder:"1px solid #eec988",otherBgColor:"#fff",otherHoverBgColor:"#eec988",currentFontColor:"#fff",currentBgColor:"#eec988",currentBorder:"1px solid #eec988",fontSize:13,currentFontSize:13,cormer:2,gapWidth:3,showJump:!0,jumpBgColor:"#fff",jumpFontHoverColor:"#fff",jumpHoverBgColor:"#eec988",jumpBorder:"1px solid #ddd",jumpHoverBorder:"1px solid #eec988",submitType:"get",idParameter:"page",url:e,ajaxData:{user_id:c,area:i.area,housetype:i.housetype,servicetag:i.servicetag,order:i.orderKey,limit:i.limitVal},dataOperate:function(a){$(".content_pic").html(spliceVrContentHandler.spliceStrEvent(a.data)),viewPlus.addView(),addCollect.collectVr()}}))}},c.controller("panoramaCtrl",["$scope","$http",function(){j.init()}])}();