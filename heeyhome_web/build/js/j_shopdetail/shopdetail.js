/*! Pc.Heigh-ho.Renovation-1.0.0.js 2017-03-28 */
!function(){var a=angular.module("heeyhomeApp"),b="/api/public/shopinfo",c="/api/public/personal/myshop/technics",d="/api/public/myworkcase",e="/api/public/myworkers",f="/api/public/shop/collect",g="/api/public/shopwages",h="/api/public/personal/userinfo",i="/api/public/personal/safe/auth",j={},k=$.cookie("userId"),l=$.cookie("userType");k=null!=k&&""!=k&&void 0!=k?$.base64.decode(k):"",l=null!=l&&""!=l&&void 0!=l?$.base64.decode(l):"";var m={1:"平台实名认证",2:"保证金",3:"团队保险",4:"两年质保维修"},n={init:function(){n.initEvent()},initEvent:function(){var a=this,b=getUrlParamHandler.getUrlParam("pos");$("#JdpId").val(b),a.initMWorkInfoEvent(),a.initShopDataEvent(),a.initTechnicsDataEvent(),a.initWorksDataEvent(),a.initFloorNavEvent(),a.initClickAddEvent(),a.initMWworkClickEvent(),a.initDeleteMworkEvent(),a.initGoReservationEvent(),a.initArtificialPriceEvent(),a.initSpriceListEvent(),a.initCollectionEvent(),a.initBackTopEvent(),a.initinlineEvent()},initBackTopEvent:function(){$(".mui-mbar-tabs .gotop").on("click",function(){return $("body,html").animate({scrollTop:0},200),!1})},initinlineEvent:function(){$(document).on("click",".hh-inline",function(){$.ajax({url:h,type:"GET",async:!0,dataType:"jsonp",data:{user_id:k}}).done(function(a){var b="",c="",d="";"000"==a.code&&(b=a.data.user_name,c=a.data.userinfo_phone,d=a.data.userinfo_email),window.easemobim=window.easemobim||{},easemobim.bind({tenantId:"22227",hide:!0,visitor:{trueName:b,phone:c,description:"描述信息",email:d},satisfaction:!0,resources:!0})})})},initCollectionEvent:function(){var a=$.cookie("userType"),b=$.base64.decode($.cookie("userId")),c=sessionStorage.getItem("iscollected");"1"==c&&1==$.base64.decode(a)&&$("#collect_shop i").html("已收藏"),$(document).on("click","#collect_shop",function(){function c(){window.location.href="register.html?#dl"}null!=b&&""!=b&&void 0!=b&&(1==$.base64.decode(a)?$.ajax({url:f,type:"GET",async:!0,dataType:"jsonp",data:{user_id:b,shop_id:$("#JdpId").val()},success:function(a){layer.msg(a.msg),"000"==a.code&&$("#collect_shop i").html("已收藏")},error:function(a){layer.msg(a.msg)}}):2==$.base64.decode(a)?layer.alert("工长暂时还不能收藏店铺哦~~"):(layer.msg("亲，收藏前请先登录哦~"),setTimeout(function(){c()},1500)))})},initPictureScrollEvent:function(){$(".wrapper_box").slide({titCell:"",mainCell:".wrapper_ul ul",autoPage:!0,effect:"leftLoop",autoPlay:!1,vis:4}),$(".picBtnTop").slide({mainCell:".bd ul",effect:"fade",autoPlay:!0,triggerTime:4})},initFloorNavEvent:function(){var a=$(".same_class");$(".tabUl li").click(function(){$(".tabUl").addClass("fixed")}),$(".tabUl li ").click(function(b){b.stopPropagation();var c=$(this).index(),d=a.eq(c).offset().top;$("html,body").stop().animate({scrollTop:d},10)}),$(window).scroll(function(){var b=$(document).scrollTop(),c=$("#tabUl"),d="";b>=c.offset().top?$(".tabUl").addClass("fixed"):$(".tabUl").removeClass("fixed"),a.each(function(){var a=$(this),c=a.offset().top;return b>c-100&&void(d="&"+a.attr("id"))});var e=c.find(".tab_active");d&&e.find("a").attr("tab")!=d&&(c.find("[tab= '"+d+"']").parent().addClass("tab_active"),e.removeClass("tab_active"))})},initMWorkInfoEvent:function(){var a=this,b=JSON.parse(sessionStorage.getItem("wObj"));if(null!=b&&void 0!=b){var c=0;for(var d in b)c++;$(".h-bd").text(c),$(".settlement-total").find("em").text(c),$.each(b,function(b,c){j[b]={ucateid:0,shopName:"",resList:[]},j[b].resList.push(c.resList[0]),j[b].ucateid=c.ucateid,j[b].shopName=c.shopName,$(".selectItemContent").append(a.spliceConFrameEvent(c.ucateid,c.shopName)),$("#cata"+c.ucateid+" .needclist").append(a.spliceWdataEvent(c.ucateid,b,c.resList[0]))})}},initShopDataEvent:function(){var a=this,c=$("#JdpId").val(),d=spliceShopDetailContHandler;$.ajax({url:b,type:"GET",async:!0,dataType:"jsonp",data:{shop_id:c},beforeSend:function(){$(".hd").addClass("loagbg"),$(".bd").addClass("loagbg"),$(".scontent").addClass("loagbg p1")},success:function(b){$(".sname").html(null!=b.data.shop_name&&""!=b.data.shop_name?b.data.shop_name:"--"),$("#JgzId").val(b.data.shopper_id),$(".Jmore").attr("href","successcase.html#/successcase?pos="+$("#JgzId").val()+"&sn="+encodeURI(b.data.shop_name)+"&si="+c),$(".hd ul").html(d.spliceHdPictureEvent(b.data)),$(".bd ul").html(d.spliceBdPictureEvent(b.data)),$(".scontent").html(d.spliceShopInfoEvent(b.data)),$(".manager_introduce").append(d.spliceManagerInfoEvent(b.data)),$(".work_experience ul").append(d.spliceBeInfoEvent(b.data)),$(".decoration_history ul").append(d.spliceDhInfoEvent(b.data)),a.initSuccessCaseDataEvent(b.data.shopper_id),a.lazyload(),a.initPictureScrollEvent()},complete:function(){$(".hd").removeClass("loagbg"),$(".bd").removeClass("loagbg"),$(".scontent").removeClass("loagbg p1")},error:function(){}})},lazyload:function(){for(var a=this,b=document.getElementById("demo1").getElementsByTagName("img"),c=b.length,d=0,e=d;c>e;e++){var f=new Image;if(f.src=b[e].getAttribute("data-src"),f.complete)return void a.throttle();f.onload=function(){f.onload=null,a.throttle()}}},throttle:function(){for(var a=document.getElementById("demo1").getElementsByTagName("img"),b=a.length,c=0,d=c;b>d;d++)""===a[d].getAttribute("src")&&(a[d].src=a[d].getAttribute("data-src"),a[d].style.background=a[d].getAttribute("data-original-background")),c+=1},initTechnicsDataEvent:function(){var a=spliceShopDetailContHandler,b=$("#JdpId").val();$.ajax({url:c,type:"GET",async:!0,dataType:"jsonp",data:{shop_id:b},success:function(b){"000"==b.code?$(".process_content").append(a.spliceGyInfoEvent(b.data)):$(".process_content").html('<div class="nullpage"><i>&nbsp;</i><span>空空如也...</span></div>')},error:function(){}})},initSuccessCaseDataEvent:function(a){var b=spliceShopDetailContHandler;$.ajax({url:d,type:"GET",async:!0,dataType:"jsonp",data:{foreman_id:a},success:function(a){"000"==a.code?($("#sd_hexgrid").append(b.spliceCgInfoEvent(a.data)),$.cookie("foremanId",$.base64.encode(a.data[0].foreman_id)),sessionStorage.setItem("isshopdetail","0")):$(".sdcon").html('<div class="nullpage"><i>&nbsp;</i><span>空空如也...</span></div>')},error:function(){}}),$(document).on("click","#sd_hexgrid li",function(){var a=$(this).attr("data-type"),b=$(this).attr("data-id");1==a?(sessionStorage.setItem("case_id",b),window.open("success_case.html#/success/success_case")):(sessionStorage.setItem("orderid",b),window.open("order_detail.html#/morder_wrap/morder_detail"))}),$("#sdcontent .s_more").on("click",function(){var a=window.location.hash,b=a.split("=")[1];sessionStorage.setItem("shopid",b)})},initWorksDataEvent:function(){var a=this,b=$("#JdpId").val(),c=spliceShopDetailContHandler;$.ajax({url:e,type:"GET",async:!0,dataType:"jsonp",data:{shop_id:b},success:function(b){"000"==b.code&&(0!=b.data.eleworker.length?($("#water_electrician .wrapper_ul ul").append(c.spliceGrInfoEvent(b.data.eleworker)),$("#water_electrician ").append(c.spliceHidePicEvent(b.data.eleworker))):$("#water_electrician .team_con").html('<div class="nullpage"><i>&nbsp;</i><span>店铺还没有该工种...</span></div>'),0!=b.data.brickworker.length?($("#bricklayer .wrapper_ul ul").append(c.spliceGrInfoEvent(b.data.brickworker)),$("#bricklayer ").append(c.spliceHidePicEvent(b.data.brickworker))):$("#bricklayer .team_con").html('<div class="nullpage"><i>&nbsp;</i><span>店铺还没有该工种...</span></div>'),0!=b.data.woodworker.length?($("#woodworking .wrapper_ul ul").append(c.spliceGrInfoEvent(b.data.woodworker)),$("#woodworking ").append(c.spliceHidePicEvent(b.data.woodworker))):$("#woodworking .team_con").html('<div class="nullpage"><i>&nbsp;</i><span>店铺还没有该工种...</span></div>'),0!=b.data.paintworker.length?($("#painter .wrapper_ul ul").append(c.spliceGrInfoEvent(b.data.paintworker)),$("#painter ").append(c.spliceHidePicEvent(b.data.paintworker))):$("#painter .team_con").html('<div class="nullpage"><i>&nbsp;</i><span>店铺还没有该工种...</span></div>'),a.initPictureScrollEvent())},error:function(){}})},initClickAddEvent:function(){var a=this;$(document).on("click",".btnCart",function(b){var c=$(this).data("uid");a.initParabolaAnimationEvent(c,b)})},initParabolaAnimationEvent:function(a,b){var c=this,d=document.querySelector("#flyItem"+a),e=document.querySelector("#shopCart"),f=$("#flyItem"+a).data("cate"),g=$("#flyItem"+a).data("info"),h=$(".shop_name h2").text();if("{}"==JSON.stringify(j))$(".selectItemContent").append(c.spliceConFrameEvent(f,h)),$("#cata"+f+" .needclist").append(c.spliceWdataEvent(f,a,g));else{var i=[];if($.each(j,function(a,b){i.push(b.ucateid)}),$.inArray(f,i)+1){if($.inArray(a,Object.keys(j))+1)return void layer.alert("该用户已经添加在你的购物车里了，请不要重复添加");$("#cata"+f+" .needclist").append(c.spliceWdataEvent(f,a,g))}else $(".selectItemContent").append(c.spliceConFrameEvent(f,h)),$("#cata"+f+" .needclist").append(c.spliceWdataEvent(f,a,g))}var k=funParabola(d,e,{speed:400,curvature:8e-4,complete:function(){d.style.visibility="hidden";var a=parseInt($(".h-bd").text());e.querySelector("div.h-bd").innerHTML=++a,$(".settlement-total").find("em").text(parseInt($(".h-bd").text()))}});if(d&&e){var l=document.documentElement.scrollLeft||document.body.scrollLeft||0,m=document.documentElement.scrollTop||document.body.scrollTop||0;b=b?b:window.event,d.style.left=b.clientX+l+"px",d.style.top=b.clientY+m+"px",d.style.visibility="visible",k.position().move(),j[a]={ucateid:0,shopName:"",resList:[]},j[a].resList.push(g),j[a].ucateid=f,j[a].shopName=h,sessionStorage.wObj=JSON.stringify(j)}},initMWworkClickEvent:function(){$(document).on("click",".mwwork",function(){$("#J_SelectedItems").toggle(),$(this).hasClass("item_hover_180")?$(this).removeClass("item_hover_180"):$(this).addClass("item_hover_180")})},initDeleteMworkEvent:function(){$(document).on("click",".needclose",function(){var a=JSON.parse(sessionStorage.getItem("wObj")),b=$(this).parent().data("nid");delete a[b];var c=0;for(var d in a)c++;$(".h-bd").text(c),$(".settlement-total").find("em").text(c),"{}"==JSON.stringify(a)?j={}:$.each(a,function(a,b){j={},j[a]={ucateid:0,shopName:"",resList:[]},j[a].resList.push(b.resList[0]),j[a].ucateid=b.ucateid,j[a].shopName=b.shopName}),sessionStorage.wObj=JSON.stringify(j),1==$(this).parents(".needclist").children("div").length?$(this).parents(".needcont").remove():$(this).parent().remove()})},spliceConFrameEvent:function(a,b){var c="";switch(a){case 1:c="杂工";break;case 2:c="水电工";break;case 3:c="瓦工";break;case 4:c="木工";break;case 5:c="油漆工"}var d='<div id="cata'+a+'" class="needcont"><div class="needheader"><div class="needtitle">';return d+='<span title="'+b+'">'+b+"-"+c+'</span></div></div><div class="needclist"></div></div>'},spliceWdataEvent:function(a,b,c){var d='<div class="Jworker" data-nid="'+b+'" data-ntype="'+a+'"><div class="needpic"><img src="'+c.img+'"></div><div class="needname">';return d+="<span>"+c.name+"</span><span>"+c.city+'</span></div><div class="needmoney">'+c.cp+'元/平方米</div><a class="sprite needclose"></a></div>'},initGoReservationEvent:function(){var a=$("#JdpId").val();$(document).on("click","#JReservation",function(){function b(){window.location.href="register.html?#dl"}""!=k?2==l?layer.msg("此功能暂时只对用户开放~~"):$.ajax({url:i,type:"GET",async:!0,dataType:"jsonp",data:{user_id:$.base64.decode($.cookie("userId"))},success:function(b){if("000"==b.code){var c=$("#JgzId").val(),d={};d.dp=a,d.gz=c,d.mark="onekey",sessionStorage.setItem("rt_list",JSON.stringify(d));var e="reservation.html#/reservation";window.location.href=e+"?type=1"}else layer.confirm("您还没有身份验证，现在去进行身份验证？",{btn:["确定","取消"]},function(){window.location.href="center.html#/center/setting/authentication/authentication_1"})}}):(layer.msg("一键预约前请先登录哦~"),setTimeout(function(){b()},1500))}),$(document).on("click",".settlement-btncon",function(){function b(){window.location.href="register.html?#dl"}""!=k?2==l?layer.msg("此功能暂时只对用户开放~~"):$.ajax({url:i,type:"GET",async:!0,dataType:"jsonp",data:{user_id:$.base64.decode($.cookie("userId"))},success:function(b){if("000"==b.code){var c=$(".h-bd").text();if(0!=parseInt(c)){var d={};d={dp:0,mark:"choose",worker:[]},d.dp=a,$.each($(".selectItemContent>div"),function(a,b){var c={};c.nid=$(b).find(".Jworker").data("nid"),c.ntype=$(b).find(".Jworker").data("ntype"),d.worker.push(c)}),sessionStorage.setItem("rt_list",JSON.stringify(d));var e="reservation.html#/reservation";window.location.href=e+"?type=2"}else layer.msg("请先选择相应的工人")}else layer.confirm("您还没有身份验证，现在去进行身份验证？",{btn:["确定","取消"]},function(){window.location.href="center.html#/center/setting/authentication/authentication_1"})}}):(layer.msg("请先登录哦~"),setTimeout(function(){b()},1500))})},initArtificialPriceEvent:function(){var a=$("#JdpId").val();$.ajax({url:g,type:"GET",async:!0,dataType:"jsonp",data:{shop_id:a},success:function(a){"000"==a.code&&$.each($(".con_price ul li"),function(b,c){$.each($(c).find("p"),function(c,d){$(d).find("span.Jprice").html(a.data[b+1][c+1])})})},error:function(){}})},initSpriceListEvent:function(){$(document).on("click",".btndown",function(){$(this).hasClass("pickdowm")?($(this).find("span").text("展开"),$(this).removeClass("pickdowm").siblings(".price_list").addClass("autoheight")):($(this).find("span").text("收起"),$(this).addClass("pickdowm").siblings(".price_list").removeClass("autoheight"))})}};getUrlParamHandler={getUrlParam:function(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)"),c=window.location.hash.split("?")[1].match(b);return null!=c?unescape(c[2]):null}},spliceShopDetailContHandler={spliceHdPictureEvent:function(a){var b="";return $.each(a.shop_imgs,function(a,c){b+='<li><img src="" data-original-background="none" data-src="'+c.shop_img+'" /></li>'}),b},spliceBdPictureEvent:function(a){var b="";return $.each(a.shop_imgs,function(a,c){b+='<li><div class="pic"><img src="" data-original-background="none" data-src="'+c.shop_img+'" /></div></li>'}),b},spliceShopInfoEvent:function(a){var b='<div class="shop_name"><h2>'+(null!=a.shop_name&&""!=a.shop_name?a.shop_name:"无")+"</h2>";return $.each(a.authentication,function(a,c){null!=c&&""!=c&&(b+='<span style="background-position:'+-20*(c-1)+'px 0" title='+m[c]+"></span>")}),b+='</div><div class="signature"><h3>'+(null!=a.shop_describe&&""!=a.shop_describe?a.shop_describe:"无")+"</h3></div>",b+='<div class="shop_introduce"><p><em class="sprite icon-position"></em>'+(null!=a.shop_address&&""!=a.shop_address?a.shop_address:"无")+'</p><p class="service_area">服务范围:&nbsp;',0!=a.servicearea.length?$.each(a.servicearea,function(a,c){b+=null!=c&&""!=c?"<span>"+c+";</span>":"<span>--</span>"}):b+="<span>无</span>",b+='</p><div class="good_form clearfix"><p class="good_style">擅长风格:&nbsp;</p>',0!=a.servicetag.length?$.each(a.servicetag,function(a,c){b+=null!=c&&""!=c?"<span>"+c+";</span>":"<span>--</span>"}):b+="<span>--</span>",b+='</div></div><div class="shop_assess clearfix"><div><p>工程质量</p><p><span>'+a.shop_score.projectquality+"</span>分</p></div><div><p>服务态度</p><p><span>"+a.shop_score.serviceattitude+"</span>分</p></div><div><p>综合评价</p><p><span>"+a.shop_score.overallmerit+"</span>分</p></div></div>"},spliceManagerInfoEvent:function(a){var b='<div class="icon_head"><img src="'+a.shopper_info.portrait_img+'"></div>';b+='<div class="manager_detail"><div><span>姓名</span><span>'+a.shopper_info.foremaninfo_realname+"</span></div><div><span>籍贯</span><span>",b+=null!=a.shopper_info.home_province&&""!=a.shopper_info.home_province?a.shopper_info.home_province:"-",b+=null!=a.shopper_info.home_city&&""!=a.shopper_info.home_city?a.shopper_info.home_city:"-";var c=a.opentime;return c=c.substring(0,10),b+="</span></div><div><span>施工团队</span><span>"+a.shop_workernum+"人</span></div><div><span>工龄</span><span>"+(null!=a.shopper_info.worktime&&""!=a.shopper_info.worktime?a.shopper_info.worktime+"年":"--")+"</span></div><div><span>开店时间</span><span>"+c+"</span></div><div><span>接单数</span><span>"+a.shopper_info.ordernum+"</span></div></div>"},spliceBeInfoEvent:function(a){var b="";return 0!=a.shopper_info.experience.length?$.each(a.shopper_info.experience,function(a,c){b+=null!=c&&""!=c?"<li>"+c+"</li>":"<li>无</li>"}):b+="无",b},spliceDhInfoEvent:function(a){var b="";return 0!=a.shopper_info.decoratedareas.length?$.each(a.shopper_info.decoratedareas,function(a,c){b+=null!=c&&""!=c?"<li>"+c+"</li>":"<li>无</li>"}):b+="无",b},spliceGyInfoEvent:function(a){var b="",c=getUrlParamHandler.getUrlParam("pos");return $.each(a,function(a,d){0!=d.technics_img.length&&(b+='<div class="process_box"><a rel="nofollow" href="album.html?ams='+c+"&voe="+d.technics_id+'" target="_blank" ><img src="'+d.technics_img[0].technics_img+'"><div class="btntc"><i class="sprite"></i><p title='+d.technics_text+"><em>"+d.technics_text+"</em></p></div></a></div>")}),b},spliceCgInfoEvent:function(a){var b="";return $.each(a,function(a,c){7>a&&0!=c.img.length&&(b+='<li class="sd_hexli" data-type="'+c.type+'" data-id="'+c.case_id+'"><a><div><img src="'+c.img[0].case_img+'"><div class="sd_title"><span class="sd_area">'+c.area+"㎡</span></div>",b+='<div class="sd_stips"><span>'+c.housetype+"&middot;"+c.style+"</span>",b+="</div></div></a></li>")}),b},spliceGrInfoEvent:function(a){var b="";return $.each(a,function(a,c){b+='<li><div class="sliderworker_item"><div class="workertext"><em class="workerimg"><img src="'+c.portrait_img+'"></em>',b+='<p class="workername"><span>'+c.name+'</span></p><p class="workerinfo"><span>'+(1==c.sex?"男":"女")+"</span><span>"+c.age+"岁</span><span>"+c.birthplace+"</span>",b+='<p class="workermoney"><em>200</em>元<span>&nbsp;/&nbsp;天</span></p><p class="workerother"><span>从业时间&nbsp;&nbsp;<em>'+c.worktime+"</em>年</span><span>订单数&nbsp;&nbsp;<em>"+c.ordernum+"</em></span>",b+='</p><p class="workerBook"><a class="masklayer btnCart" data-uid="'+c.userid+'" >预约</a></p></div></div></li>'}),b},spliceHidePicEvent:function(a){var b="";return $.each(a,function(a,c){var d={img:c.portrait_img,name:c.name,city:c.birthplace,cp:300,shopId:c.shopid};b+='<div id="flyItem'+c.userid+'" class="fly_item" data-cate="'+c.cate_id+'" data-info='+JSON.stringify(d)+'  ><img src="'+c.portrait_img+'" width="40" height="40"></div>'}),b}},a.controller("shopDetailCtrl",["$scope","$http",function(){n.init()}])}();