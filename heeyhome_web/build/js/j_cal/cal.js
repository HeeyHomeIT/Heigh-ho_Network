/*! Pc.Heigh-ho.Renovation-1.0.0.js 2017-03-23 */
var roomPlanObj={},Msg1="未保存工艺",Msg2="已保存工艺",COUNTURL="/api/public/costcalculator/count",heeyhomeCal={init:function(){var a=this;a.houseSelectEvent(),a.selectRoomTechnologyEvent(),a.roomConfigureSelectEvent(),a.lastdivClickEvent(),a.sumbitCalEvent()},houseSelectEvent:function(){var a,b,c,d,e,f,g=this;$(".housediv div").on("click",function(a){if(a.stopPropagation(),c=$("#c_area").val(),null==c||void 0==c||""==$.trim(c))return void layer.msg("请先输入建筑面积");if(c>=70&&80>c)d="<li>1</li><li>2</li>",e="<li>1</li>",f="<li>1</li><li>2</li>";else if(c>=80&&90>c)d="<li>1</li><li>2</li><li>3</li>",e="<li>1</li>",f="<li>1</li><li>2</li>";else if(c>=90&&120>c)d="<li>1</li><li>2</li><li>3</li>",e="<li>1</li><li>2</li>",f="<li>1</li><li>2</li><li>3</li>";else if(c>=120&&140>c)d="<li>1</li><li>2</li><li>3</li><li>4</li>",e="<li>1</li><li>2</li>",f="<li>1</li><li>2</li><li>3</li>";else{if(!(c>=140&&160>=c))return void layer.msg("暂支持70m²~160m²户型，其他户型请咨询客服");d="<li>1</li><li>2</li><li>3</li><li>4</li>",e="<li>1</li><li>2</li><li>3</li>",f="<li>1</li><li>2</li><li>3</li>"}$(".room ul").html(d),$(".bathroom ul").html(e),$(".balcony ul").html(f),$(this).hasClass("item_hover_180")?$(this).removeClass("item_hover_180"):$(this).addClass("item_hover_180"),$(this).find("ul").slideToggle(),$(this).siblings().removeClass("item_hover_180").find("ul").slideUp()}),$(".housediv ul").delegate("li","click",function(){b=$(this).text(),$(this).parent().prev().text(b),$(this).parent().parent().hasClass("room")&&(a=g.changeTitleEvent(parseInt(b)),$(".Jtitle").html(a),1!=parseInt(b)?($(".roomsdiv a.add-btn").removeClass("off").addClass("Jcursor"),g.comboboxInitEvent(),g.roomPlanEvent(parseInt(b)-1)):(g.comboboxInitEvent(),$(".roomsdiv a").off("click"),$(".roomsdiv a").addClass("off").removeClass("Jcursor")))}),g.closeDropBoxEvent($(".housediv div"),$(".housediv ul"))},roomPlanEvent:function(a){var b=this;$(".roomsdiv a").off().on("click",function(){var c,d=$(this),e=0,f=0;if(d.hasClass("sub-btn")){if(c=parseInt(d.siblings("span").find("input").val())-1,-1==c)return;b.roomsPlanStatusEvent(d.parent().attr("id"),c,d.siblings("span").attr("data-en"),d.siblings("span").attr("data-nj"),d.siblings("span").attr("data-tag")),d.siblings("a").removeClass("off"),$(".add-btn").removeClass("off").addClass("Jcursor"),$(this).siblings("span").find("input").val(c),0==c&&(d.addClass("off").removeClass("Jcursor"),b.initThisObjContentStrEvent(d.parent().attr("id")))}else{if(c=parseInt(d.siblings("span").find("input").val())+1,$.each(roomPlanObj,function(a,b){f+=parseInt(b.count)}),c==a+1||f==a)return;b.roomsPlanStatusEvent(d.parent().attr("id"),c,d.siblings("span").attr("data-en"),d.siblings("span").attr("data-nj"),d.siblings("span").attr("data-tag")),d.siblings("a").removeClass("off").addClass("Jcursor"),$(this).siblings("span").find("input").val(c),$.each(roomPlanObj,function(a,b){e+=parseInt(b.count)}),(c==a||e==a)&&(d.addClass("off").removeClass("Jcursor"),$(".add-btn").addClass("off").removeClass("Jcursor"))}b.roomOperationEvent()})},roomsPlanStatusEvent:function(a,b,c,d,e){var f=a,g=b,h=c,i=d,j=e;roomPlanObj[f]={count:g,name:h,cname:i,tag:j}},roomOperationEvent:function(){var a;$.each(roomPlanObj,function(b,c){$(".mainarea_list li").hasClass("house"+c.tag)?0==parseInt(c.count)&&$(".mainarea_list li.house"+c.tag).remove():0!=parseInt(c.count)&&(a='<li class="house'+c.tag+' scd">\t<label for="'+c.name+'Radio" id="Checkbox'+c.tag+'" class="Jcursor">\t<input type="checkbox" class="I'+b+" J"+c.name+' sccc display" data-sw="0" data-type="'+c.name+'" data-name="'+c.cname+'"  id="'+c.name+'Radio">\t<s class="J'+b+' scb"></s> \t<div class="room'+c.tag+'"> \t<em></em> <dl>'+c.cname+'</dl> \t</div></label><span class="already_choose none"></span></li> ',$(".mainarea_list").append(a))})},selectRoomTechnologyEvent:function(){var a=this;$(document).on("click","#zwRadio,#cwRadio,#fmfRadio,#ymjRadio,#etfRadio,#sfRadio,#kctRadio,#ytRadio,#cfRadio",function(){var b,c,d,e,f=$(this);b=f.attr("data-sw"),c=f.data("type"),d=f.data("name"),$.each($(".mainareadiv input[type='checkbox']"),function(a,b){0==parseInt($(b).attr("data-sw"))&&($(b).siblings("s").removeClass("rep_craft_check"),$(b).closest("li").children("span").addClass("none").empty())}),0==parseInt(b)?(f.siblings("s").addClass("rep_craft_check"),f.closest("li").children("span").removeClass("none").html(Msg1)):1==parseInt(b)&&(e=JSON.parse(f.attr("data-option"))),a.contentStrEvent(c,d,e)})},comboboxInitEvent:function(){var a=this;$(".roomsdiv input").val(0),$(".roomsdiv a.sub-btn").addClass("off").removeClass("Jcursor"),$(".scc").removeClass("can_not_check rep_craft_check"),$(".scb").removeClass("rep_craft_check").addClass("can_not_check"),$(".mainareadiv li").find("span").addClass("none").removeClass("Jcol").empty(),$(".mainareadiv li").find("input").attr("data-sw",0),$(".mainareadiv li").find("input").attr("data-option",""),$(".mainareadiv li").find("input").attr("checked",!1),$(".mainareadiv li").find("input.sccc").attr("disabled","disabled"),$(".mainareadiv li").find("input.sccc").parent("label").removeClass("Jcursor"),$(".mainareadiv li.scd").remove(),a.initcontentStrEvent(),roomPlanObj={}},closeDropBoxEvent:function(a,b){var c=a,d=b;$(document).on("click",function(){c.hasClass("item_hover_180")&&c.removeClass("item_hover_180"),d.slideUp()})},changeTitleEvent:function(a){var b;switch(a){case 1:b="您只有一间主卧&nbsp&nbsp请<span style='color:#f60'>跳过第二步继续填写下面的内容</span>";break;case 2:b="除了主卧以外其余<span style='color:#f60'>一间</span>房间怎么安排";break;case 3:b="除了主卧以外其余<span style='color:#f60'>两间</span>房间怎么安排";break;case 4:b="除了主卧以外其余<span style='color:#f60'>三间</span>房间怎么安排"}return b},contentStrEvent:function(a,b,c){var d,e;null!=c&&void 0!=c&&(e=c[a]),d='<i class="title">房间类型：<em class="JroomName" data-rn="'+a+'">'+b+'</em></i> <div class="filter_mod"> <div class="filter_item"><label class="item_title" data-name="ground">地面处理方式：</label> <div class="item_mod"><a class="'+(null==e||void 0==e||"smdb"==e.ground?"cit":"")+'" rel="nofollow" data-val="smdb">实木地板</a> <a class="'+(null!=e&&void 0!=e&&"qhfhdb"==e.ground?"cit":"")+'" rel="nofollow" data-val="qhfhdb">强化复合地板</a><a class="'+(null!=e&&void 0!=e&&"cz"==e.ground?"cit":"")+'" rel="nofollow" data-val="cz">铺设瓷砖</a></div></div> ',("zw"==a||"ymj"==a||"cw"==a||"etf"==a||"fmf"==a)&&(d+='<div class="filter_item"><label class="item_title" data-name="wardrobe" >衣柜制作方式：</label> <div class="item_mod"><a class="'+(null==e||void 0==e||1==e.wardrobe?"cit":"")+'" rel="nofollow" data-val="true" >木工制作衣柜</a> <a class="'+(null!=e&&void 0!=e&&0==e.wardrobe?"cit":"")+'" rel="nofollow" data-val="false" >自行购买衣柜</a></div></div> '),("zw"==a||"cw"==a||"etf"==a||"fmf"==a||"ymj"==a||"sf"==a||"kct"==a)&&(d+='<div class="filter_item"><label class="item_title" data-name="ceiling" >木工制作吊顶：</label> <div class="item_mod"><a class="'+(null==e||void 0==e||1==e.ceiling?"cit":"")+'" rel="nofollow" data-val="true" >需要</a>\t <a class="'+(null!=e&&void 0!=e&&0==e.ceiling?"cit":"")+'" rel="nofollow" data-val="false" >不需要</a></div></div> <div class="filter_item"><label class="item_title" data-name="wallpaper" >墙面铺贴墙纸：</label> <div class="item_mod"><a class="'+(null==e||void 0==e||1==e.wallpaper?"cit":"")+'" rel="nofollow" data-val="true" >需要</a>\t <a class="'+(null!=e&&void 0!=e&&0==e.wallpaper?"cit":"")+'" rel="nofollow" data-val="false" >不需要</a></div></div> '),("zw"==a||"cw"==a||"etf"==a||"fmf"==a||"ymj"==a||"sf"==a)&&(d+='<div class="filter_item"><label class="item_title" data-name="window" >有无飘窗结构：</label> <div class="item_mod"><a class="'+(null==e||void 0==e||1==e.window?"cit":"")+'" rel="nofollow" data-val="true" >有飘窗</a> <a class="'+(null!=e&&void 0!=e&&0==e.window?"cit":"")+'" rel="nofollow" data-val="false" >没有飘窗</a></div></div> '),("etf"==a||"sf"==a)&&(d+='<div class="filter_item"><label class="item_title" data-name="tatami" >榻榻米的制作：</label> <div class="item_mod"><a class="'+(null==e||void 0==e||1==e.tatami?"cit":"")+'" rel="nofollow" data-val="true" >木工制作榻榻米</a> <a class="'+(null!=e&&void 0!=e&&0==e.tatami?"cit":"")+'" rel="nofollow" data-val="false" >自行购买榻榻米</a></div></div> '),"sf"==a&&(d+='<div class="filter_item"><label class="item_title" data-name="bookcase" >书桌书柜选择：</label> <div class="item_mod"><a class="'+(null==e||void 0==e||1==e.bookcase?"cit":"")+'" rel="nofollow" data-val="true" >木工制作简易书桌书柜</a> <a class="'+(null!=e&&void 0!=e&&0==e.bookcase?"cit":"")+'" rel="nofollow" data-val="false" >购买成品书桌书柜</a></div></div> '),"etf"==a&&(d+='<div class="filter_item"><label class="item_title" data-name="desk" >书桌书架选择：</label> <div class="item_mod"><a class="'+(null==e||void 0==e||1==e.desk?"cit":"")+'" rel="nofollow" data-val="true" >木工制作简易书桌书架</a> <a class="'+(null!=e&&void 0!=e&&0==e.desk?"cit":"")+'" rel="nofollow" data-val="false" >购买成品书桌书架</a></div></div> '),"kct"==a&&(d+='<div class="filter_item"><label class="item_title" data-name="shoebox" >鞋柜制作方式：</label> <div class="item_mod"><a class="'+(null==e||void 0==e||1==e.shoebox?"cit":"")+'" rel="nofollow" data-val="true" >木工制作鞋柜</a> <a class="'+(null!=e&&void 0!=e&&0==e.shoebox?"cit":"")+'" rel="nofollow" data-val="false" >自行购买鞋柜</a></div></div> <div class="filter_item"><label class="item_title" data-name="wine_cabinet" >酒柜制作方式：</label> <div class="item_mod"><a class="'+(null==e||void 0==e||1==e.wine_cabinet?"cit":"")+'" rel="nofollow" data-val="true" >木工制作酒柜</a> <a class="'+(null!=e&&void 0!=e&&0==e.wine_cabinet?"cit":"")+'" rel="nofollow" data-val="false" >自行购买酒柜</a></div></div> '),"yt"==a&&(d+='<div class="filter_item"><label class="item_title" data-name="hanging_cabinet" >木工制作吊柜：</label> <div class="item_mod"><a class="'+(null==e||void 0==e||1==e.hanging_cabinet?"cit":"")+'" rel="nofollow" data-val="true" >需要</a> <a class="'+(null!=e&&void 0!=e&&0==e.hanging_cabinet?"cit":"")+'" rel="nofollow" data-val="false" >不需要</a></div></div> '),"cf"==a&&(d+='<div class="filter_item"><label class="item_title" data-name="cupboard" >木工制作橱柜：</label> <div class="item_mod"><a class="'+(null==e||void 0==e||1==e.cupboard?"cit":"")+'" rel="nofollow" data-val="true" >需要</a> <a class="'+(null!=e&&void 0!=e&&0==e.cupboard?"cit":"")+'" rel="nofollow" data-val="false" >不需要</a></div></div> '),d+='</div><div class="savediv"><input type="button" class="saveBtn J_btnR" value="保存工艺"></div> ',$(".mainareadiv .filter_nav ").html(d)},initThisObjContentStrEvent:function(a){var b,c=$(".I"+a).data("type"),d=$(".JroomName").data("rn");null!=c&&void 0!=c&&null!=d&&void 0!=d&&c==d&&(b='<div class="prompt"><i>&nbsp;</i><span>请先选择左边的房间</span></div>',$(".mainareadiv .filter_nav ").html(b))},initcontentStrEvent:function(){var a;a='<div class="prompt"><i>&nbsp;</i><span>请先选择左边的房间</span></div>',$(".mainareadiv .filter_nav ").html(a)},roomConfigureSelectEvent:function(){$(document).on("click",".filter_item a",function(){$(this).addClass("cit").siblings().removeClass("cit")}),$(document).off("click",".J_btnR").on("click",".J_btnR",function(){var a,b=$(this).closest("div.filter_nav"),c={},d={};a=b.find(".JroomName").data("rn"),$.each(b.find(".filter_item"),function(a,b){c[$(b).find("label").data("name")]=$(b).find("div.item_mod a.cit").data("val")}),d[a]=c,$(".J"+a).attr("data-option",JSON.stringify(d)),$(".J"+a).attr("data-sw",1),$(".J"+a).closest("li").children("span").addClass("Jcol").removeClass("none").html(Msg2)})},lastdivClickEvent:function(){$(document).on("click",".lastdiv input[type='checkbox']",function(){var a=$(this);a.is(":checked")?(a.siblings("s").addClass("rep_craft_check"),a.attr("data-select","1")):(a.siblings("s").removeClass("rep_craft_check"),a.attr("data-select","0"))})},sumbitCalEvent:function(){var a=this;$(document).off("click",".nowcal").on("click",".nowcal",function(){var b={},c={},d={},e=0,f=0,g="";b.city=$("#Jcity").text()+"市",b.area=$("#c_area").val(),b.room_num=$(".room span").text(),b.parlor_num=$(".parlor span").text(),b.bathroom_num=$(".bathroom span").text(),b.balcony_num=$(".balcony span").text(),c.master=1,c.second=$(".Jsecond").val(),c.child=$(".Jchild").val(),c.parent=$(".Jparent").val(),c.cloakroom=$(".Jcloakroom").val(),c.study=$(".Jstudy").val(),b.room_distribution=c,b.master_distribution=a.initGetCalDataEvent($(".Jzw")),b.second_distribution=a.initGetCalDataEvent($(".Jcw")),b.child_distribution=a.initGetCalDataEvent($(".Jetf")),b.parent_distribution=a.initGetCalDataEvent($(".Jfmf")),b.cloakroom_distribution=a.initGetCalDataEvent($(".Jymj")),b.study_distribution=a.initGetCalDataEvent($(".Jsf")),b.parlor_distribution=a.initGetCalDataEvent($(".Jkct")),b.balcony_distribution=a.initGetCalDataEvent($(".Jyt")),b.kitchen_distribution=a.initGetCalDataEvent($(".Jcf")),d=a.initGetFloorDataEvent($(".othersdiv .filter_item")),0==d.isElevator?b.floor=d.isElevator:-1==d.isElevator&&(b.floor=d.floor),b.wall=$("#qtccgcRadio").attr("data-select"),b.ground_sank=$("#wsjdmxcRadio").attr("data-select");var h=$(".Jzw").attr("data-sw"),i=$(".Jkct").attr("data-sw"),j=$(".Jyt").attr("data-sw"),k=$(".Jcf").attr("data-sw"),l=!0;$.each(roomPlanObj,function(a,b){"0"!=b.count&&"0"==$(".I"+a).attr("data-sw")&&(l=!1),e+=b.count}),f=parseInt($(".room").find("span").text())-1-e,""==$("#c_area").val()?layer.msg("建筑面积还没有填哦~~"):f>0?layer.msg("您还有"+f+"间房间没有安排"):"0"==h?layer.msg("主卧还没有保存工艺哦~~"):"0"==i?layer.msg("客餐厅还没有保存工艺哦~~"):"0"==j?layer.msg("阳台还没有保存工艺哦~~"):"0"==k?layer.msg("厨房还没有保存工艺哦~~"):l?$.ajax({url:COUNTURL,type:"GET",async:!0,dataType:"jsonp",data:{calculator_json:JSON.stringify(b)},beforeSend:function(){$("#loading").removeClass("display")},success:function(a){if("000"==a.code){var c={};c.gzrg=a.data.gzrg,c.sdrg=a.data.sdrg,c.wgrg=a.data.wgrg,c.mgrg=a.data.mgrg,c.yqgrg=a.data.yqgrg,c.zgrg=a.data.zgrg,c.rgzj=a.data.rgzj,c.zdsdcl=a.data.zdsdcl,c.gdsdcl=a.data.gdsdcl,c.wgfc=a.data.wgfc,c.mgfc=a.data.mgfc,c.yqcl=a.data.yqcl,c.czdd=a.data.czdd,c.czgd=a.data.czgd,c.bc=a.data.bc,c.dls=a.data.dls,c.db=a.data.db,c.mm=a.data.mm,c.cfym=a.data.cfym,c.lyfym=a.data.lyfym,c.ygym=a.data.ygym,c.jcdd=a.data.jcdd,c.cgsys=a.data.cgsys,c.zxzj=a.data.zxzj,sessionStorage.payJson=JSON.stringify(c);var d="calresult.html#/calresult";window.location.href=d+"?cs="+b.city+"&mj="+b.area+"&fj="+b.room_num+"&kt="+b.parlor_num+"&wsj="+b.bathroom_num+"&yt="+b.balcony_num}else 200==a.code&&layer.alert(a.msg)},complete:function(){$("#loading").addClass("display")},error:function(){}}):($.each(roomPlanObj,function(a,b){"0"!=b.count&&"0"==$(".I"+a).attr("data-sw")&&(g+=b.cname+",")}),g=g.substring(0,g.lastIndexOf(",")),layer.msg(g+"还没有保存工艺"))})},initGetCalDataEvent:function(a){var b,c={},d=a.attr("data-sw"),e=a.data("type");return null!=d&&void 0!=d&&0!=parseInt(d)&&(b=JSON.parse(a.attr("data-option")),c=b[e]),c},initGetFloorDataEvent:function(a){var b={};return $.each(a,function(a,c){b[$(c).find("label").data("name")]=$(c).find("div.item_mod a.cit").data("val")}),b}};$(function(){var a=angular.module("heeyhomeApp");a.controller("calCtrl",["$scope","$http",function(){heeyhomeCal.init()}])});