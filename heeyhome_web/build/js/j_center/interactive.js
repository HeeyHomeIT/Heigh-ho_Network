/*! Pc.Heigh-ho.Renovation-1.0.0.js 2017-03-22 */
!function(){var email,pic_total,bill_total,shop_total,newValue,TOTAL,MAXROWS,HHIT_CENTERAPP=angular.module("heeyhomeApp"),BASEURL="/api/public/",USERDATAURL=BASEURL+"personal/userinfo",EDITUSERDATAURL=BASEURL+"personal/userinfo/change",USERIMGURL=BASEURL+"personal/portrait",UPUSERIMGURL=BASEURL+"personal/portrait/change",SAFELEVELURL=BASEURL+"personal/safe",PANORAMAURL=BASEURL+"personal/collection/panorama?callback=JSON_CALLBACK",SHOPCURL=BASEURL+"personal/collection/shop?callback=JSON_CALLBACK",BILLURL=BASEURL+"costcalculator/result/get?callback=JSON_CALLBACK",BILLDELURL=BASEURL+"costcalculator/result/del?callback=JSON_CALLBACK",DSHOPURL=BASEURL+"personal/collection/shopdel?callback=JSON_CALLBACK",DPICURL=BASEURL+"personal/collection/panoramadel?callback=JSON_CALLBACK",NEWSURL=BASEURL+"personal/message/isnew",READURL=BASEURL+"personal/message",DELETEURL=BASEURL+"personal/message/del",HAVEREADURL=BASEURL+"personal/message/read",ALLREADURL=BASEURL+"personal/message/readall",USERORDERURL=BASEURL+"order/client/list",ORDERDETAILURL=BASEURL+"order/detail",SHOPIMGURL=BASEURL+"personal/myshop/imgs",SELSTATUSURL=BASEURL+"order/client/selstatus",CALRESULTURL=BASEURL+"costcalculator/result/get",CANCELORDERURL=BASEURL+"order/client/destory",HOUSESTYLEURL=BASEURL+"order/style/addhousestyle",BASICINFOURL=BASEURL+"/order/shop/orderbasicinfo",ORDEREVALURL=BASEURL+"/order/order/evaluation",load='<div class="loading"><img src="image/icon-loading.gif"></div>',USERID=$.cookie("userId");USERID=null!=USERID&&""!=USERID&&void 0!=USERID?$.base64.decode($.cookie("userId")):"";var certification={1:"平台实名认证",2:"保证金",3:"团队保险",4:"两年质保维修"},centerWrap={init:function(){centerWrap.initEvent()},initEvent:function(){var a=this;a.initStyleChangeEvent(),a.initMDataEvent(),a.initMHomeEvent(),a.initMCollectionEvent(),a.initMsgInfo(),a.initMOrderDataEvent(),a.initMOrderDetailEvent()},initStyleChangeEvent:function(){HHIT_CENTERAPP.controller("styleCtrl",["$scope","$http",function(){$(".left_ul li").click(function(){$(this).addClass("left_active").siblings().removeClass("left_active")});var a=window.location.hash,b=$("#left_ul a");b.each(function(){var b=$(this).attr("ui-sref");-1!=a.indexOf(b.replace(".","/"))&&$(this).parent().addClass("left_active")}),$.ajaxSetup({beforeSend:function(){$(".right_content_wrap").append(load),$(".order_content .right_content").append(load),$(".safe_right_content").append(load)},complete:function(){$(".right_content_wrap .loading").remove(),$(".order_content .right_content .loading").remove(),$(".safe_right_content .loading").remove()}}),$.ajax({type:"get",url:NEWSURL,async:!0,dataType:"jsonp",data:{user_id:USERID},success:function(a){null!=a&&"000"==a.code&&a.data.newmsgtotal>0&&$(".left_ul li").eq(4).append("<i>"+a.data.newmsgtotal+"</i>")},error:function(){}})}])},initMHomeEvent:function(){HHIT_CENTERAPP.controller("homeCtrl",["$scope","$http",function(){$(".Jcenter").html("我的主页"),$(".left_ul li").eq(0).addClass("left_active").siblings().removeClass("left_active"),getHomeInfoHandler.getInfoEvent(),getHomeInfoHandler.getImgEvent(),getHomeInfoHandler.getOrderEvent(),getHomeInfoHandler.getCollectEvent(),getHomeInfoHandler.getSafeEvent(),getUserAvatarHandler.getInfoEvent()}])},initMDataEvent:function(){HHIT_CENTERAPP.controller("mDataCtrl",["$scope","$http",function(){$(".Jcenter").html("个人资料"),$(".left_ul li").eq(1).addClass("left_active").siblings().removeClass("left_active"),$('[data-toggle="distpicker"]').distpicker(),getUserInfoHandler.getInfoEvent()}])},initMOrderDataEvent:function(){HHIT_CENTERAPP.controller("mMorderCtrl",["$scope","$http",function(){$(".Jcenter").html("我的订单"),$(".left_ul li").eq(2).addClass("left_active").siblings().removeClass("left_active"),$.ajax({type:"get",url:USERORDERURL,async:!0,dataType:"jsonp",data:{user_id:USERID,page:1,limit:3},success:function(a){if(null!=a&&"000"==a.code){var b=a.data.order_count,c="";$.each(a.data.order_list,function(a,b){c+=spliceOrderHandler.spliceOrderList(b)}),$(".order_content .page_number").before(c),$(".order_box").each(function(){1==$(this).find(".all a").length&&$(this).find(".all .top").addClass("one")}),OrderPageHandler.pageContentEvent(b)}else"205"==a.code?($("#orderContent").remove(),$(".not_information").show().removeClass("hide"),$(".not_information_text").html("您的订单空空如也~~")):layer.msg(a.msg)},error:function(){}}),$(document).off("click",".ordercnt_content .all .top").on("click",".ordercnt_content .all .top",function(){var a=$(this).parent().attr("data-shopid"),b=$(this).parent().attr("data-orderid");sessionStorage.setItem("shopid",a),sessionStorage.setItem("orderid",b)}),$(document).off("click",".ordercnt_content .all .look_new").on("click",".ordercnt_content .all .look_new",function(){var a=$(this).parent().attr("data-shopid"),b=$(this).parent().attr("data-orderid"),c=$(this).parent().attr("data-sss"),d={};d.shop_id=a,d.user_id=c,d.order_id=b,$.cookie("dd",JSON.stringify(d),{expires:1,path:"/"}),window.open("reservation.html#/waitcontact?type=1")}),$(document).off("click",".ordercnt_content .all .bottom").on("click",".ordercnt_content .all .bottom",function(){function eval(a){$(document).on("click",a,function(){$(a).removeClass("activei");var b=$(this),c=b.index();b.parent().find(".describe").data("grade",c);for(var d=0;c+1>d;d++)$(a).eq(d).addClass("activei")})}function hover(a){$(a).hover(function(){var b=$(this),c=b.index();$(a).removeClass("activei");for(var d=0;c+1>d;d++)$(a).eq(d).addClass("activei");b.parent().find(".describe").show().html(gradeArray[c])},function(){$(a).removeClass("activei");var b=$(this).parent().find(".describe"),c=b.data("grade");if(void 0==c)b.hide();else{for(var d=0;c+1>d;d++)$(a).eq(d).addClass("activei");b.show().html(gradeArray[c])}})}var shopid=$(this).parent().attr("data-shopid"),orderid=$(this).parent().attr("data-orderid"),orderstep=$(this).parent().attr("data-orderstep");if(sessionStorage.setItem("shopid",shopid),sessionStorage.setItem("orderid",orderid),sessionStorage.setItem("orderstep",orderstep),"取消订单"==$(this).html())$.ajax({type:"get",url:CANCELORDERURL,async:!0,dataType:"jsonp",data:{user_id:USERID,order_id:orderid},success:function(a){a&&"000"==a.code?(layer.alert(a.msg),location.reload(!0)):layer.alert(a.msg)},error:function(){}});else if("确认验货"==$(this).html()){var order_id=sessionStorage.getItem("orderid"),gradeArray=["2分 失望","4分 不满","6分 一般","8分 满意","10分 惊喜"],$engineering_quality=$('<p class="engineering_quality">工程质量：</p>'),$service_attitude=$('<p class="service_attitude">服务态度：</p>'),$overview=$('<p class="overview">综合评价：</p>'),ihtml='<i class="iconfont">&#xe64e;</i>',span='<span class="describe" style="display: none"></span>',evaButton='<input class="evaButton" type="button" value="提交评价">';$.each(gradeArray,function(){$engineering_quality.append(ihtml),$service_attitude.append(ihtml),$overview.append(ihtml)}),$engineering_quality.append(span),$service_attitude.append(span),$overview.append(span);var content=$engineering_quality[0].outerHTML+$service_attitude[0].outerHTML+$overview[0].outerHTML+evaButton;layer.open({type:1,skin:"layui-layer-rim",area:["420px","270px"],content:content}),$(document).off("click",".evaButton").on("click",".evaButton",function(){var a=2*$(".engineering_quality .activei").length,b=2*$(".service_attitude .activei").length,c=2*$(".overview .activei").length;$.ajax({type:"get",url:ORDEREVALURL,async:!0,dataType:"jsonp",data:{order_id:order_id,projectquality:a,serviceattitude:b,overallmerit:c},success:function(a){a&&"000"==a.code?($(".layui-layer-shade").remove(),$(".layui-layer").remove(),$(".confirm_inspection").parent(".all").find(".top").addClass("one"),$(".all .confirm_inspection").remove()):layer.msg(a.msg)},error:function(){}})}),eval(".engineering_quality i"),eval(".service_attitude i"),eval(".overview i"),hover(".engineering_quality i"),hover(".service_attitude i"),hover(".overview i")}})}])},initMOrderDetailEvent:function(){HHIT_CENTERAPP.controller("order_detailCtrl",["$scope","$http",function(){$("#menuNavOuter").remove();var a=sessionStorage.getItem("shopid"),b=sessionStorage.getItem("orderid");$.ajax({type:"get",url:BASICINFOURL,async:!0,dataType:"jsonp",data:{shop_id:a,order_id:b},success:function(a){null!=a&&"000"==a.code?($(".owner_picture img").attr("src",a.data.order_list[0].user_portrait),$(".owner_summary h3").html(a.data.order_list[0].user_realname),$(".owner_summary p span").html(a.data.order_list[0].user_phone),$(".owner_left .area p span").html(a.data.order_list[0].area),$(".owner_left .order p").html(b),$(".owner_middle .type p").html(a.data.order_list[0].room+"室"+a.data.order_list[0].parlour+"厅"+a.data.order_list[0].toilet+"卫"+a.data.order_list[0].balcony+"阳台"),$(".owner_middle .time p").html(a.data.order_list[0].order_time),$(".owner_right .address p").html(a.data.order_list[0].order_address)):layer.alert(a.msg)},error:function(){}}),$.ajax({url:HOUSESTYLEURL,type:"GET",async:!0,dataType:"jsonp",data:{order_id:b},success:function(a){a&&"000"==a.code&&$(".housetype p").html(null!=a.data["装修风格"]?a.data["装修风格"]:"无")},error:function(){}}),OrderDetail.getDetail()}])},initMCollectionEvent:function(){HHIT_CENTERAPP.controller("mCollectionCtrl",["$scope","$http",function(){$(".Jcenter").html("我的收藏"),$(".left_ul li").eq(3).addClass("left_active").siblings().removeClass("left_active");var a=30,b=location.hash;if(-1!=b.indexOf("?")){var c=b.substring(b.indexOf("?")+1);$(".complete_before").hide(),$(".check_list_wrap").hide(),$(".collection_shop_wrap").hide(),$("#works_complete_wrap >div:eq("+c.substring(6,7)+")").show().removeClass("hide"),a=30+214*c.substring(6,7)}var b=window.location.hash;if(-1!=b.indexOf("#/center/mcollection")){var d=$("#left_ul a");d.each(function(){var a=$(this).attr("ui-sref");-1!=b.indexOf(a.replace(".","/"))&&$(this).parent().addClass("left_active").siblings().removeClass("left_active")})}var e=$("#works_content_title div"),f=0,g=document.getElementById("title_active");$(g).css("left",a+"px");for(var h=0;h<e.length-1;h++)e[h].onclick=function(){startMoveHandler.startMoveEvent(g,this.offsetLeft,f,a),$(".complete_before").hide(),$(".check_list_wrap").hide(),$(".collection_shop_wrap").hide(),$(".works_complete_wrap >div:eq("+$(this).index()+")").show().removeClass("hide"),0==$(this).index()?getPicInfoHandler.picInfo():1==$(this).index()?getBillInfoHandler.billInfoEvent():2==$(this).index()&&getShopInfoHandler.shopInfo()};getPicInfoHandler.picInfo(),getBillInfoHandler.billInfoEvent(),getShopInfoHandler.shopInfo()}])},initMsgInfo:function(){HHIT_CENTERAPP.controller("msgCtrl",["$scope","$http",function(){$(".Jcenter").html("消息中心"),$(".left_ul li").eq(4).addClass("left_active").siblings().removeClass("left_active"),initInfo.info()}])}};startMoveHandler={startMoveEvent:function(a,b,c,d){clearInterval(a.timer),a.timer=setInterval(function(){c+=(b-a.offsetLeft)/10,c*=.7,d+=c,Math.abs(c)<1&&Math.abs(d-b)<1?(clearInterval(a.timer),a.style.left=b+"px"):a.style.left=d+"px"},30)}},getHomeInfoHandler={getInfoEvent:function(){$.ajax({url:USERDATAURL,type:"GET",async:!0,dataType:"jsonp",data:{user_id:$.base64.decode($.cookie("userId"))},success:function(a){if(a&&"000"==a.code){var b=a.data.userinfo_phone.substr(0,3)+"****"+a.data.userinfo_phone.substr(7,11);$(".user_name").html(a.data.userinfo_nickname),$("#user_phone").html(b),email=a.data.userinfo_email,null!=email&&($("#email span").html("已绑定"),$("#email a").html("立即修改"))}},error:function(){}})},getImgEvent:function(){$.ajax({url:USERIMGURL,type:"GET",async:!0,dataType:"jsonp",data:{user_id:USERID},success:function(a){a&&"000"==a.code&&$(".left_img").html('<img src="'+a.data.user_img+'"><a class="edit_avatar" href="javascript:;">修改头像<input type="file" name="" id="renderings_file"></a> ')},error:function(){}})},getOrderEvent:function(){$.ajax({type:"get",url:USERORDERURL,async:!0,dataType:"jsonp",data:{user_id:USERID},beforeSend:function(){$(".my_order_content").addClass("loagbg"),$(".order_content_title ").addClass("display"),$(".order_content_cnt ").addClass("display")},success:function(data){if(data&&"000"==data.code){var _new=0,orderid=data.data.order_list[_new].order_id,shopid=data.data.order_list[_new].shop_id;$.ajax({type:"get",url:SHOPIMGURL,async:!0,dataType:"jsonp",data:{shop_id:shopid},success:function(a){if(a&&"000"==a.code){var b=a.data[0].shop_img;$(".order_content_title .order_title_left .order_title_left_img").html('<img src="'+b+'">')}else layer.msg(a.msg)},error:function(){}});var status=data.data.order_list[_new].order_status,step=data.data.order_list[_new].order_step;if($(".order_cnt_right").on("click",function(){sessionStorage.setItem("shopid",data.data.order_list[_new].shop_id),sessionStorage.setItem("orderid",data.data.order_list[_new].order_id)}),18!=step||1!=status&&2!=status&&3!=status&&4!=status&&7!=status)$(".order_cnt_right .detail").attr("href","order_detail.html#/morder_wrap/morder_detail");else{var oInfoObj={};oInfoObj.shop_id=data.data.order_list[0].shop_id,oInfoObj.user_id=data.data.order_list[0].user_id,oInfoObj.order_id=data.data.order_list[0].order_id,$.cookie("dd",JSON.stringify(oInfoObj),{expires:1,path:"/"}),$(".order_cnt_right .detail").attr("href","reservation.html#/waitcontact?type=1")}if(5==status)if(3==step||7==step||11==step||15==step)if("1"==data.data.order_list[0].order_material_is_exist){var type=0;-1!=data.data.order_list[0].order_step_ch.indexOf("水电")&&(type=1),-1!=data.data.order_list[0].order_step_ch.indexOf("瓦工")&&(type=3),-1!=data.data.order_list[0].order_step_ch.indexOf("木工")&&(type=4),-1!=data.data.order_list[0].order_step_ch.indexOf("油漆")&&(type=5),$(".order_cnt_right .operation").attr("href","reservation.html#/materiallist?pos="+data.data.order_list[_new].order_id+"&&material_type="+type).html("辅材支付")}else $(".order_cnt_right .operation").css({width:"0",height:"0",border:"none"});else if(5==step||9==step||13==step||17==step)if("1"==data.data.order_list[0].order_actual_isclick){var order_step_type=0;-1!=data.data.order_list[0].order_step_ch.indexOf("水电")&&(order_step_type=5),-1!=data.data.order_list[0].order_step_ch.indexOf("瓦工")&&(order_step_type=9),-1!=data.data.order_list[0].order_step_ch.indexOf("木工")&&(order_step_type=13),-1!=data.data.order_list[0].order_step_ch.indexOf("油漆")&&(order_step_type=17),$(".order_cnt_right .operation").attr("href","reservation.html#/advancelist?pos="+data.data.order_list[_new].order_id+"&&order_step_type="+order_step_type).html("人工支付")}else $(".order_cnt_right .operation").css({width:"0",height:"0",border:"none"});else $(".order_cnt_right .operation").remove(),$(".order_cnt_right .detail").addClass("one");else 6==status?"0"==data.data.order_list[0].is_evaluation?($(".order_cnt_right .operation").html("确认验货"),$(".all .bottom").addClass("confirm_inspection"),$(".order_cnt_right .operation").on("click",function(){function eval(a){$(document).on("click",a,function(){$(a).removeClass("activei");var b=$(this),c=b.index();b.parent().find(".describe").data("grade",c);for(var d=0;c+1>d;d++)$(a).eq(d).addClass("activei")})}function hover(a){$(a).hover(function(){var b=$(this),c=b.index();$(a).removeClass("activei");for(var d=0;c+1>d;d++)$(a).eq(d).addClass("activei");b.parent().find(".describe").show().html(gradeArray[c])},function(){$(a).removeClass("activei");var b=$(this).parent().find(".describe"),c=b.data("grade");if(void 0==c)b.hide();else{for(var d=0;c+1>d;d++)$(a).eq(d).addClass("activei");b.show().html(gradeArray[c])}})}var order_id=sessionStorage.getItem("orderid"),gradeArray=["2分 失望","4分 不满","6分 一般","8分 满意","10分 惊喜"],$engineering_quality=$('<p class="engineering_quality">工程质量：</p>'),$service_attitude=$('<p class="service_attitude">服务态度：</p>'),$overview=$('<p class="overview">综合评价：</p>'),ihtml='<i class="iconfont">&#xe64e;</i>',span='<span class="describe" style="display: none"></span>',evaButton='<input class="evaButton" type="button" value="提交评价">';$.each(gradeArray,function(){$engineering_quality.append(ihtml),$service_attitude.append(ihtml),$overview.append(ihtml)}),$engineering_quality.append(span),$service_attitude.append(span),$overview.append(span);var content=$engineering_quality[0].outerHTML+$service_attitude[0].outerHTML+$overview[0].outerHTML+evaButton;layer.open({type:1,skin:"layui-layer-rim",area:["420px","270px"],content:content}),$(document).off("click",".evaButton").on("click",".evaButton",function(){var a=2*$(".engineering_quality .activei").length,b=2*$(".service_attitude .activei").length,c=2*$(".overview .activei").length;$.ajax({type:"get",url:ORDEREVALURL,async:!0,dataType:"jsonp",data:{order_id:order_id,projectquality:a,serviceattitude:b,overallmerit:c},success:function(a){a&&"000"==a.code?($(".layui-layer-shade").remove(),$(".layui-layer").remove(),$(".confirm_inspection").parent(".order_cnt_right").find(".detail").addClass("one"),$(".order_cnt_right .confirm_inspection").remove()):layer.msg(a.msg)},error:function(){}})}),eval(".engineering_quality i"),eval(".service_attitude i"),eval(".overview i"),hover(".engineering_quality i"),hover(".service_attitude i"),hover(".overview i")})):($(".order_cnt_right .operation").remove(),$(".order_cnt_right .detail").addClass("one")):4==status?$(".order_cnt_right .operation").attr("href","reservation.html#/advancelist?pos="+data.data.order_list[_new].order_id).html("人工支付"):1==status?($(".order_cnt_right .operation").html("取消订单"),$(".order_cnt_right .operation").off("click",".order_cnt_right .operation").on("click",function(){$.ajax({type:"get",url:CANCELORDERURL,async:!0,dataType:"jsonp",data:{user_id:USERID,order_id:orderid},success:function(a){a&&"000"==a.code?(layer.alert(a.msg),$(".order_cnt_right .operation").css("cursor","not-allowed"),getHomeInfoHandler.getOrderEvent()):layer.alert(a.msg)},error:function(){}})})):($(".order_cnt_right .operation").remove(),$(".order_cnt_right .detail").addClass("one"));$(".order_content_title .order_title_left span").html(data.data.order_list[_new].shop_name),$(".order_content_title .order_title_right span").html(data.data.order_list[_new].order_time),$(".order_cnt_left .status .order_span_right").html(data.data.order_list[_new].order_status_ch),$(".order_cnt_left .address .order_span_right").html(data.data.order_list[_new].order_address),$(".order_cnt_left .house .order_span_right .area").html(data.data.order_list[_new].area);var type=data.data.order_list[_new].room+"室"+data.data.order_list[_new].parlour+"厅"+data.data.order_list[_new].toilet+"卫"+data.data.order_list[_new].balcony+"阳台";$(".order_cnt_left .house .order_span_right .type").html(type);var result_id=data.data.order_list[_new].calculator_result_id;$.ajax({type:"get",url:CALRESULTURL,async:!0,dataType:"jsonp",data:{user_id:USERID},success:function(a){a&&"000"==a.code?$.each(a.data.calculator_data,function(a,b){b.calculator_results_id==result_id&&$(".order_cnt_left .house .order_span_right .money").html(b.zj)}):layer.alert(a.msg)},error:function(){}});var time="(";$.ajax({type:"get",url:SELSTATUSURL,async:!0,dataType:"jsonp",data:{user_id:USERID,order_id:orderid},success:function(a){if(a&&"000"==a.code)if($.each(a.data.reservation_time_user,function(a,b){if(null!=b&&""!=b){var c=b.split(" ")[0];time+=c+"   "}}),time+=")",1==status)$(".order_cnt_left .time .order_span_right").html("待工长确认"+time);else{var b=a.data.reservation_time.split(" ")[0];$(".order_cnt_left .time .order_span_right").html(b)}else layer.alert(a.msg)},error:function(){}})}else"205"==data.code?($(".my_order_content").remove(),$(".not_information").show().removeClass("hide"),$(".not_information_text").html("您暂时还没有订单消息哦~~")):layer.alert(data.msg)},complete:function(){$(".my_order_content").removeClass("loagbg"),$(".order_content_title ").removeClass("display"),$(".order_content_cnt ").removeClass("display")},error:function(){}})},getCollectEvent:function(){$.ajax({dataType:"JSONP",url:PANORAMAURL,type:"GET",async:!0,data:{user_id:USERID,page:1,limit:1},success:function(a){$("#pic_total").html(a&&"000"==a.code?a.data[0].total:0)},error:function(){}}),$.ajax({dataType:"JSONP",url:SHOPCURL,type:"GET",async:!0,data:{user_id:USERID,page:1,limit:1},success:function(a){$("#shop_total").html(a&&"000"==a.code?a.data[0].total:0)},error:function(){}}),$.ajax({url:BILLURL,type:"GET",async:!0,dataType:"jsonp",data:{user_id:USERID,page:1,limit:2},success:function(a){$("#bill_total").html(null!=a&&"000"==a.code?a.data.calculator_count:0)},error:function(){}})},getSafeEvent:function(){$.ajax({dataType:"JSONP",url:SAFELEVELURL,type:"GET",async:!0,data:{user_id:USERID},success:function(a){a&&"000"==a.code&&(parseInt(a.data.score)>0&&parseInt(a.data.score)<=3.3?($("#active_level").css("width","47px"),$(".safe_name span").eq(0).addClass("active_name")):parseInt(a.data.score)>3.3&&parseInt(a.data.score)<=6.7?($("#active_level").css("width","94px"),$(".safe_name span").eq(1).addClass("active_name")):($("#active_level").css("width","141px"),$(".safe_name span").eq(2).addClass("active_name")))},error:function(){}})}},getUserInfoHandler={getInfoEvent:function(){$(".sex").click(function(){$(".sex em").removeClass("checked"),$(this).find("em").addClass("checked")}),$.ajax({url:USERDATAURL,type:"GET",async:!0,dataType:"jsonp",data:{user_id:USERID},success:function(a){if(null!=a&&"000"==a.code){"2"==a.data.isedit&&$(".personal_user_name").attr("disabled",!0),$(".personal_user_name").val(a.data.user_name);var b=a.data.userinfo_phone.substr(0,3)+"****"+a.data.userinfo_phone.substr(7,11);if($(".personal_tel").html(b),$(".personal_user_age").val(a.data.userinfo_age),$(".personal_user_nickname").val(a.data.userinfo_nickname),1==a.data.userinfo_sex?($("#man").attr("checked","checked"),$(".sman em").addClass("checked")):($("#women").attr("checked","checked"),$(".swomen em").addClass("checked")),null!=a.data.userinfo_email&&""!=a.data.userinfo_email){var c=a.data.userinfo_email,d=a.data.userinfo_email.length,e=c.substr(0,3)+"****"+c.substr(d-3,d);$(".personal_form_list .email").html(e).addClass("apparent"),$(".personal_form_list p a").html("修改绑定")}else $(".personal_form_list .email").removeClass("apparent"),$(".personal_form_list p a").html("绑定邮箱");$("#nowAddress").distpicker({province:a.data.loc_province,city:a.data.loc_city,district:a.data.loc_district}),$("#homeAddress").distpicker({province:a.data.home_province,city:a.data.home_city,district:a.data.home_district}),$(".personal_form_list .personal_area_detail").val(a.data.loc_address)}},error:function(){}}),$(".personal_form .personal_submit").on("click",function(){var a=($(".personal_tel").html(),$(".personal_user_name").val()),b=$(".personal_user_age").val(),c=$(".personal_user_nickname").val(),d=$(".personal_form_list #province1 option:selected").val(),e=$(".personal_form_list #city1 option:selected").val(),f=$(".personal_form_list #district1 option:selected").val(),g=$(".personal_form_list #province2 option:selected").val(),h=$(".personal_form_list #city2 option:selected").val(),i=$(".personal_form_list #district2 option:selected").val(),j=$(".personal_form_list .personal_area_detail").val();$.ajax({type:"get",url:EDITUSERDATAURL,async:!0,dataType:"jsonp",data:{user_id:USERID,name:a,nickname:c,sex:$("input[name='sex']:checked").val(),age:b,loc_province:d,loc_city:e,loc_district:f,loc_address:j,home_province:g,home_city:h,home_district:i},beforeSend:function(){$(".personal_form .personal_submit").attr("disabled",!0)},success:function(a){layer.msg(null!=a||"000"==a.code?a.msg:a.msg)},complete:function(){$(".personal_form .personal_submit").attr("disabled",!1)},error:function(){}})})}},getUserAvatarHandler={getInfoEvent:function(){$(document).off("change","#renderings_file").on("change","#renderings_file",function(){var a=$(this),b=a.get(0).files[0];if(!/image\/\w+/.test(b.type))return layer.msg("请确保文件为图像类型"),a.val(""),!1;var c=new FormData;c.append("user_id",USERID),c.append("myfile",$("#renderings_file")[0].files[0]),$.ajax({type:"POST",url:UPUSERIMGURL,data:c,dataType:"jsonp",jsonp:"callback",cache:!1,processData:!1,contentType:!1,success:function(a){"000"==a.code?(layer.msg(a.msg),getHomeInfoHandler.getImgEvent()):layer.alert(a.msg)},error:function(){layer.alert("未知错误")}})})}},OrderDetail={getDetail:function(){var a=sessionStorage.getItem("orderid");$.ajax({type:"get",url:ORDERDETAILURL,async:!0,dataType:"jsonp",data:{order_id:a},success:function(a){if(null!=a&&"000"==a.code){if(18!=a.data.now_order_step){var b='<div class="axis_start">';b+="<h2>进场准备</h2>",b+="<h3>READING..</h3>",b+="</div>";var c='<div class="work_worker">';$.each(a.data.detail,function(a,c){b+=spliceStageHandler.spliceStrEvent(c),"配送中"==c.material_pay_status&&($(document).on("mouseover",".step span",function(){$(".step span").addClass("distribution")}),$(document).on("mouseout",".step",function(){$(".step span").removeClass("distribution")}))}),1!=a.data.now_order_step&&($.each(a.data.worker,function(a,b){c+='<div class="worker">',c+='<img src="'+b.portrait+'">',c+='<p><span class="worker_cname">'+b.name+"</span>",c+="</p></div>"}),c+="</div>",$(".axis_content").append(c)),$(".axis_content").append(b);for(var d=0;d<$(".work_stage .step .status").length;d++)"(undefined)"==$(".work_stage .step .status").eq(d).html()&&$(".work_stage .step .status").eq(d).empty();if(6==a.data.noworder_status){var e='<div class="axis_end">';e+="<i></i>",e+="<h2>工期完成</h2>",e+="<h3>FINISH</h3>",e+="</div>",$(".axis_content").append(e)}$("#time_axis").css("height",$(".axis_content").height()+200),suspensionMenu.menuTab()}else layer.alert("还未开工哦，亲~~");layer.photos({photos:".stage_pic",anim:5})}else layer.alert(a.msg)},error:function(){}})}},getBillInfoHandler={billInfoEvent:function(){function a(){$.ajax({url:BILLURL,type:"GET",async:!0,dataType:"jsonp",data:{user_id:USERID,page:1,limit:3},success:function(a){if(null!=a&&"000"==a.code){bill_total=a.data.calculator_count;var b="";$.each(a.data.calculator_data,function(a,c){b+=spliceBillHandler.spliceStrEvent(c)}),$(".billWrap").html(b),billPageHandler.pageContentEvent(),$(document).on("click",".collection_detail",function(a){sessionStorage.setItem("payJson",$(a.target).parents(".check_list").attr("data-cal"))})}else"200"==a.code&&($(".check_wrap").remove(),$(".check_list_wrap .not_information").show().removeClass("hide"),$(".check_list_wrap .not_information_text").html("您现在还没有关于成本计算的收藏哦~~"))},error:function(){}})}a(),$(document).off("click","#collection_del").on("click","#collection_del",function(b){var c=$(b.target).parents(".check_list").attr("calculator_results_id");$.ajax({url:BILLDELURL,type:"GET",async:!0,dataType:"jsonp",data:{user_id:USERID,calculator_results_id:c},success:function(b){layer.msg(b.msg),a(),billPageHandler.pageContentEvent()},error:function(a){layer.msg(a.msg)}})})}},getShopInfoHandler={shopInfo:function(){function a(){$.ajax({url:SHOPCURL,type:"GET",async:!0,dataType:"jsonp",data:{user_id:USERID,page:1,limit:4},success:function(a){if(null!=a&&"000"==a.code){shop_total=a.data[0].total;var b="";$.each(a.data,function(a,c){b+=spliceShopHandler.spliceStrEvent(c)}),$(".shopWrap").html(b),$(".shopWrap .collection_shop .left_img").on("click",function(){var a=$(this).parent().attr("shopid");window.location.href="view_shop.html#/shopdetails?pos="+a}),shopPageHandler.pageContentEvent()}else"117"==a.code&&($(".shop_wrap").remove(),$(".collection_shop_wrap .not_information").show().removeClass("hide"),$(".collection_shop_wrap .not_information_text").html("您现在还没有收藏店铺哦~~"))},error:function(){}})}a(),$(document).off("click",".collection_shop_del").on("click",".collection_shop_del",function(b){var c=$(b.target).parents(".collection_shop").attr("shopId");$.ajax({url:DSHOPURL,type:"GET",async:!0,dataType:"jsonp",data:{user_id:USERID,shop_id:c},success:function(b){layer.msg(b.msg),a()},error:function(){}})})}},getPicInfoHandler={picInfo:function(){function a(){$.ajax({url:PANORAMAURL,type:"GET",async:!0,dataType:"jsonp",data:{user_id:USERID,page:1,limit:12},success:function(a){if(a&&"000"===a.code){pic_total=a.data[0].total;var b="";$.each(a.data,function(a,c){b+=splicePicHandler.spliceStrEvent(c)}),$(".picWrap").html(b),pageHandler.pageContentEvent()}else"117"==a.code&&($(".img_wrap").remove(),$(".complete_before .not_information").show().removeClass("hide"),$(".complete_before .not_information_text").html("您现在还没有收藏全景图哦~~"))},error:function(a){layer.msg(a.msg)}})}a(),$(document).off("click","#pic_del").on("click","#pic_del",function(){var b=$(this).parent().attr("panorama_id");$.ajax({url:DPICURL,type:"GET",async:!0,dataType:"jsonp",data:{user_id:USERID,panorama_id:b},success:function(b){b&&"000"==b.code&&(layer.msg(b.msg),a(),pageHandler.pageContentEvent())},error:function(a){layer.msg(a.msg)}})})}},judgeNews={isnews:function(){$(".main_content").each(function(){"0"==$(this).attr("data-isread")&&$(this).addClass("isnews")})}},readNews={tobeRead:function(){$(".main_content .content").on("click",function(){var a=$(this).siblings(".cnt").html();if(layer.open({type:1,skin:"layui-layer-rim",area:["420px","240px"],content:"<p>"+a+"</p>"}),"0"==$(this).parent().attr("data-isread")){var b=$(this).parent().attr("data-id"),c=$(this).parent(),d=$(".left_ul li i").html();0!=d?(d--,0==d?$(".left_ul li i").remove():$(".left_ul li i").html(d)):$(".left_ul li i").remove(),$.ajax({type:"get",url:HAVEREADURL,async:!0,dataType:"jsonp",data:{msgid:b},success:function(){c.attr("data-isread","1").removeClass("isnews")},error:function(){}})}})}},initInfo={info:function(){$.ajax({type:"get",url:READURL,async:!0,dataType:"jsonp",data:{user_id:USERID,page:1,limit:10},success:function(a){null!=a&&"000"==a.code?($(".main_contentWrap").empty(),TOTAL=a.data[0].total,$.each(a.data,function(a,b){var c=spliceMsgHandler.spliceStrEvent(b);$(".main_contentWrap").append(c)}),judgeNews.isnews(),readNews.tobeRead(),infopageHandler.pageContentEvent(),deleteRecord.singleSelection(),markRead.checkAll()):"117"==a.code?($("#contentWrap").remove(),$(".not_information").show().removeClass("hide"),$(".not_information_text").html("您的消息空空如也~~")):layer.msg(a.msg)},error:function(){}})}},spliceMsgHandler={spliceStrEvent:function(a){var b='<div class="main_content" data-isread="'+a.isread+'" data-id="'+a.id+'">';return b+='<span class="name">'+a.senduser+"</span>",b+='<span class="content">'+a.msgtitle+"</span>",b+='<span class="time">'+a.sendtime+"</span>",b+='<span class="cnt">'+a.msgcontent+"</span>",b+='<a class="delete" href="javascript:;"><em class="sprite-details"></em></a>',b+="</div>"}},infopageHandler={pageContentEvent:function(){MAXROWS=Math.ceil(TOTAL/10),$(".page_div2").empty().paging({total:MAXROWS,animation:!1,centerBgColor:"#fff",centerFontColor:"#000",centerBorder:"1px solid #ddd",transition:"all .2s",centerHoverBgColor:"#eec988",centerHoverBorder:"1px solid #eec988",centerFontHoverColor:"#fff",otherFontHoverColor:"#fff",otherBorder:"1px solid #ddd",otherHoverBorder:"1px solid #eec988",otherBgColor:"#fff",otherHoverBgColor:"#eec988",currentFontColor:"#fff",currentBgColor:"#eec988",currentBorder:"1px solid #eec988",fontSize:13,currentFontSize:13,cormer:2,gapWidth:3,showJump:!0,jumpBgColor:"#fff",jumpFontHoverColor:"#fff",jumpHoverBgColor:"#eec988",jumpBorder:"1px solid #ddd",jumpHoverBorder:"1px solid #eec988",submitType:"get",idParameter:"page",url:READURL,ajaxData:{user_id:USERID,page:1,limit:10},dataOperate:function(a){$(".main_contentWrap").empty(),$.each(a.data,function(a,b){var c=spliceMsgHandler.spliceStrEvent(b);$(".main_contentWrap").append(c)}),judgeNews.isnews(),readNews.tobeRead(),deleteRecord.singleSelection()}})}},deleteRecord={singleSelection:function(){$(".main_contentWrap .delete").on("click",function(){var a=$(this).parent().attr("data-id");$.ajax({type:"get",url:DELETEURL,async:!0,dataType:"jsonp",data:{id:a},success:function(a){null!=a&&"000"==a.code?(initInfo.info(),layer.msg(a.msg)):layer.alert(a.msg)},error:function(){}})})}},markRead={checkAll:function(){$(document).on("click",".set_default input",function(){$(this).is(":checked")?$(this).siblings("em").removeClass("checked"):$(this).siblings("em").addClass("checked")}),$(".information_choose a").on("click",function(){
$(".information_choose .set_default em").hasClass("checked")?$.ajax({type:"get",url:ALLREADURL,async:!0,dataType:"jsonp",data:{user_id:USERID},success:function(a){null!=a&&"000"==a.code?($(".main_content").attr("data-isread","1").removeClass("isnews"),$(".left_ul li i").remove()):layer.alert(a.msg)},error:function(){}}):layer.alert("请先选中全选按钮")})}},errorMsgHendler={remindBox:function(a){var b=$("#ReminderBox"),c=$(".remindebox");b.removeClass("display"),$(".info_header span").text(a),c.stop().animate({"margin-top":"-150px",opacity:1},500),$(".remindemodel_ok").on("click",function(){c.stop().animate({"margin-top":"-40px",opacity:0},500,function(){b.addClass("display")})})}},suspensionMenu={menuTab:function(){var a=$(".work_stage");a.eq(0).addClass("first_stage bar"),a.eq(1).addClass("sdg_stage bar"),a.eq(5).addClass("wg_stage bar"),a.eq(9).addClass("mg_stage bar"),a.eq(13).addClass("yqg_stage bar"),a.eq(17).addClass("end_stage bar");var b="";a.hasClass("first_stage")&&(b+='<li class="current">',b+='<a href="javascript:void(0)" tab="&first_stage">进场准备</a>',b+="</li>"),a.hasClass("sdg_stage")&&(b+="<li>",b+='<a href="javascript:void(0)" tab="&sdg_stage">水电工阶段</a>',b+="</li>"),a.hasClass("wg_stage")&&(b+="<li>",b+='<a href="javascript:void(0)" tab="&wg_stage">瓦工阶段</a>',b+="</li>"),a.hasClass("mg_stage")&&(b+="<li>",b+='<a href="javascript:void(0)" tab="&mg_stage">木工阶段</a>',b+="</li>"),a.hasClass("yqg_stage")&&(b+="<li>",b+='<a href="javascript:void(0)" tab="&yqg_stage">油漆工阶段</a>',b+="</li>"),a.hasClass("end_stage")&&(b+="<li>",b+='<a href="javascript:void(0)" tab="&end_stage">工期完成</a>',b+="</li>"),$("#suspension_menu ul").append(b);var c=$(".commonhead");$(c).addClass("to_head bar");var d=$(".bar"),e=$("#suspension_menu li ");$(e).on("click",function(a){a.stopPropagation();var b,c=$(this).index();b=$(this).hasClass("litop")?d.eq(0).offset().top:d.eq(c+1).offset().top,$("html,body").stop().animate({scrollTop:b-20},10)}),$(window).scroll(function(){var a=$(document).scrollTop(),b=$("#suspension_menu"),c="";a>550?$(b).css("display","block"):$(b).css("display","none"),d.each(function(){var b=$(this),d=b.offset().top;return a>d-100&&void(c="&"+b.attr("class").split(" ")[1])});var e=b.find(".current");c&&e.find("a").attr("tab")!=c&&(b.find("[tab= '"+c+"']").parent().addClass("current"),e.removeClass("current"))})}},spliceStageHandler={spliceStrEvent:function(a){1==a.material_pay_status?a.material_pay_status="未配送":2==a.material_pay_status?a.material_pay_status="配送中":3==a.material_pay_status?a.material_pay_status="配送完成":4==a.material_pay_status&&(a.material_pay_status="自行购买");var b='<div class="work_stage">';b+='<div class="stage_title">',b+='<span class="date">'+a.img_time.split(" ")[0]+"</span>",b+="<em></em>",b+="<b></b>";var c=sessionStorage.getItem("orderid");if(a.order_step.indexOf("辅材")>0){var d=0;-1!=a.order_step.indexOf("水电")&&(d=1),-1!=a.order_step.indexOf("瓦工")&&(d=3),-1!=a.order_step.indexOf("木工")&&(d=4),-1!=a.order_step.indexOf("油漆")&&(d=5),b+='<span class="step">'+a.order_step+'[<span class="'+("配送中"==a.material_pay_status?"c_eec988":"")+'">'+a.material_pay_status+'</span>]<a href="reservation.html#/materiallist?pos='+c+"&&material_type="+d+'" target="_blank" class="balance">材料清单</a></span>',b+="</div>",b+='<div class="stage_content">',b+='<div class="stage_pic clearfix">',$.each(a.img,function(c,d){b+='<img src="'+d.img_url+'" alt="'+a.order_step+'">'}),b+="</div>",b+="</div>"}else if(a.order_step.indexOf("完成")>0){var e=0;-1!=a.order_step.indexOf("水电")&&(e=5),-1!=a.order_step.indexOf("瓦工")&&(e=9),-1!=a.order_step.indexOf("木工")&&(e=13),-1!=a.order_step.indexOf("油漆")&&(e=17),b+='<span class="step">'+a.order_step+"</span>","1"==a.order_actual_isclick&&(b+='<a href="reservation.html#/advancelist?pos='+c+"&&order_step_type="+e+'" target="_blank" class="settlement">结算清单</a>'),b+="</div>",b+='<div class="stage_content">',b+='<div class="stage_pic clearfix">',$.each(a.img,function(c,d){b+='<img src="'+d.img_url+'" alt="'+a.order_step+'">'}),b+="</div>",b+="</div>",b+="</div>"}else-1!=a.order_step.indexOf("剪裁")?(b+='<span class="step">'+a.order_step+'<a href="reservation.html#/advancelist?pos='+a.order_id+'&order_step_type=18" target="_blank" class="balance prepayment">预支付单</a></span>',b+="</div>",b+='<div class="stage_content">',b+='<div class="stage_pic clearfix">',$.each(a.img,function(c,d){b+='<img src="'+d.img_url+'" alt="'+a.order_step+'">'}),b+="</div>",b+="</div>"):(b+='<span class="step">'+a.order_step+"</span>",b+="</div>",b+='<div class="stage_content">',b+='<div class="stage_pic clearfix">',$.each(a.img,function(c,d){b+='<img src="'+d.img_url+'" alt="'+a.order_step+'">'}),b+="</div>",b+="<p>"+a.img_content+"</p>",b+="</div>");return b+="</div>"}},spliceOrderHandler={spliceOrderList:function(a){var b='<div class="order_box">';if(b+='<div class="ordercnt_title clearfix">',b+='<span class="type">'+a.room+"室 "+a.parlour+"厅"+a.toilet+"卫"+a.balcony+"阳台</span>",b+='<span class="time">'+a.order_time+"</span><span>订单号</span>",b+='<span class="order_num">'+a.order_id+'</span><a class="name" href="view_shop.html#/shopdetails?pos='+a.shop_id+'" target="_blank">'+a.shop_name+"</a>",b+='</div><div class="ordercnt_content">',b+='<div class="block clearfix"><div class="address">',b+="<p>"+a.order_address+"</p></div>",b+='<div class="area"><p class="item_hover_0"><span>'+a.area+"</span>㎡</p></div>","3"==a.order_step?"0"==a.order_material_is_exist&&(a.order_step_ch="水电工开工"):"7"==a.order_step?"0"==a.order_material_is_exist&&(a.order_step_ch="瓦工开工"):"11"==a.order_step?"0"==a.order_material_is_exist&&(a.order_step_ch="木工开工"):"15"==a.order_step&&"0"==a.order_material_is_exist&&(a.order_step_ch="油漆工开工"),b+='<div class="now_stage"><p>'+a.order_step_ch+"</p></div>",b+=null==a.actual_finish_amount?'<div class="money"><p>0.00</p></div>':'<div class="money"><p>'+a.actual_finish_amount+"</p></div>",b+='<div class="trade_stage"><p>'+a.order_status_ch+"</p></div>",b+=18!=a.order_step||1!=a.order_status&&2!=a.order_status&&3!=a.order_status&&4!=a.order_status&&7!=a.order_status?'<div class="all" data-shopid="'+a.shop_id+'" data-orderid="'+a.order_id+'"  data-orderstep="'+a.order_step+'"><a href="order_detail.html#/morder_wrap/morder_detail" target="_blank" class="top">查看详情</a>':'<div class="all" data-sss="'+a.user_id+'" data-shopid="'+a.shop_id+'" data-orderid="'+a.order_id+'"  data-orderstep="'+a.order_step+'"><a href="javascript:;" class="top look_new">查看详情</a>',6==a.order_status&&"0"==a.is_evaluation&&(b+='<a href="javascript:;" class="bottom confirm_inspection">确认验货</a>'),1==a.order_status&&(b+='<a href="javascript:;" class="bottom">取消订单</a>'),4==a.order_status&&(b+='<a href="reservation.html#/advancelist?pos='+a.order_id+'"  class="bottom">人工支付</a>'),5==a.order_status){if((3==a.order_step||7==a.order_step||11==a.order_step||15==a.order_step)&&"1"==a.order_material_is_exist){var c=0;-1!=a.order_step_ch.indexOf("水电")&&(c=1),-1!=a.order_step_ch.indexOf("瓦工")&&(c=3),-1!=a.order_step_ch.indexOf("木工")&&(c=4),-1!=a.order_step_ch.indexOf("油漆")&&(c=5),b+='<a href="reservation.html#/materiallist?pos='+a.order_id+"&&material_type="+c+'" class="bottom">辅材支付</a>'}if((5==a.order_step||9==a.order_step||13==a.order_step||17==a.order_step)&&"1"==a.order_actual_isclick){var d=0;-1!=a.order_step_ch.indexOf("水电")&&(d=5),-1!=a.order_step_ch.indexOf("瓦工")&&(d=9),-1!=a.order_step_ch.indexOf("木工")&&(d=13),-1!=a.order_step_ch.indexOf("油漆")&&(d=17),b+='<a href="reservation.html#/advancelist?pos='+a.order_id+"&&order_step_type="+d+'" class="bottom">人工支付</a>'}}return b+="</div></div>",b+="</div></div>"}},OrderPageHandler={pageContentEvent:function(order_total){$(".page_div2").empty().paging({total:Math.ceil(order_total/3),animation:!1,centerBgColor:"#fff",centerFontColor:"#000",centerBorder:"1px solid #ddd",transition:"all .2s",centerHoverBgColor:"#eec988",centerHoverBorder:"1px solid #eec988",centerFontHoverColor:"#fff",otherFontHoverColor:"#fff",otherBorder:"1px solid #ddd",otherHoverBorder:"1px solid #eec988",otherBgColor:"#fff",otherHoverBgColor:"#eec988",currentFontColor:"#fff",currentBgColor:"#eec988",currentBorder:"1px solid #eec988",fontSize:13,currentFontSize:13,cormer:2,gapWidth:3,showJump:!0,jumpBgColor:"#fff",jumpFontHoverColor:"#fff",jumpHoverBgColor:"#eec988",jumpBorder:"1px solid #ddd",jumpHoverBorder:"1px solid #eec988",submitType:"get",idParameter:"page",url:USERORDERURL,ajaxData:{user_id:USERID,page:1,limit:3},dataOperate:function(data){$(".order_content .page_number").prevAll().remove();var order="";$.each(data.data.order_list,function(a,b){order+=spliceOrderHandler.spliceOrderList(b)}),$(".order_content .page_number").before(order),$(".order_box").each(function(){1==$(this).find(".all a").length&&$(this).find(".all .top").addClass("one")}),$(document).off("click",".ordercnt_content .all .bottom").on("click",".ordercnt_content .all .bottom",function(){function eval(a){$(document).on("click",a,function(){$(a).removeClass("activei");var b=$(this),c=b.index();b.parent().find(".describe").data("grade",c);for(var d=0;c+1>d;d++)$(a).eq(d).addClass("activei")})}function hover(a){$(a).hover(function(){var b=$(this),c=b.index();$(a).removeClass("activei");for(var d=0;c+1>d;d++)$(a).eq(d).addClass("activei");b.parent().find(".describe").show().html(gradeArray[c])},function(){$(a).removeClass("activei");var b=$(this).parent().find(".describe"),c=b.data("grade");if(void 0==c)b.hide();else{for(var d=0;c+1>d;d++)$(a).eq(d).addClass("activei");b.show().html(gradeArray[c])}})}var shopid=$(this).parent().attr("data-shopid"),orderid=$(this).parent().attr("data-orderid"),orderstep=$(this).parent().attr("data-orderstep");if(sessionStorage.setItem("shopid",shopid),sessionStorage.setItem("orderid",orderid),sessionStorage.setItem("orderstep",orderstep),"取消订单"==$(this).html())$.ajax({type:"get",url:CANCELORDERURL,async:!0,dataType:"jsonp",data:{user_id:USERID,order_id:orderid},success:function(a){a&&"000"==a.code?(layer.alert(a.msg),location.reload(!0)):layer.alert(a.msg)},error:function(){}});else if("确认验货"==$(this).html()){var order_id=sessionStorage.getItem("orderid"),gradeArray=["2分 失望","4分 不满","6分 一般","8分 满意","10分 惊喜"],$engineering_quality=$('<p class="engineering_quality">工程质量：</p>'),$service_attitude=$('<p class="service_attitude">服务态度：</p>'),$overview=$('<p class="overview">综合评价：</p>'),ihtml='<i class="iconfont">&#xe64e;</i>',span='<span class="describe" style="display: none"></span>',evaButton='<input class="evaButton" type="button" value="提交评价">';$.each(gradeArray,function(){$engineering_quality.append(ihtml),$service_attitude.append(ihtml),$overview.append(ihtml)}),$engineering_quality.append(span),$service_attitude.append(span),$overview.append(span);var content=$engineering_quality[0].outerHTML+$service_attitude[0].outerHTML+$overview[0].outerHTML+evaButton;layer.open({type:1,skin:"layui-layer-rim",area:["420px","270px"],content:content}),$(document).off("click",".evaButton").on("click",".evaButton",function(){var a=2*$(".engineering_quality .activei").length,b=2*$(".service_attitude .activei").length,c=2*$(".overview .activei").length;$.ajax({type:"get",url:ORDEREVALURL,async:!0,dataType:"jsonp",data:{order_id:order_id,projectquality:a,serviceattitude:b,overallmerit:c},success:function(a){a&&"000"==a.code?($(".layui-layer-shade").remove(),$(".layui-layer").remove(),$(".confirm_inspection").parent(".all").find(".top").addClass("one"),$(".all .confirm_inspection").remove()):layer.msg(a.msg)},error:function(){}})}),eval(".engineering_quality i"),eval(".service_attitude i"),eval(".overview i"),hover(".engineering_quality i"),hover(".service_attitude i"),hover(".overview i")}})}})}},pageHandler={pageContentEvent:function(){$(".page_div3").empty().paging({total:Math.ceil(pic_total/12),animation:!1,centerBgColor:"#fff",centerFontColor:"#000",centerBorder:"1px solid #ddd",transition:"all .2s",centerHoverBgColor:"#eec988",centerHoverBorder:"1px solid #eec988",centerFontHoverColor:"#fff",otherFontHoverColor:"#fff",otherBorder:"1px solid #ddd",otherHoverBorder:"1px solid #eec988",otherBgColor:"#fff",otherHoverBgColor:"#eec988",currentFontColor:"#fff",currentBgColor:"#eec988",currentBorder:"1px solid #eec988",fontSize:13,currentFontSize:13,cormer:2,gapWidth:3,showJump:!0,jumpBgColor:"#fff",jumpFontHoverColor:"#fff",jumpHoverBgColor:"#eec988",jumpBorder:"1px solid #ddd",jumpHoverBorder:"1px solid #eec988",submitType:"get",idParameter:"page",url:PANORAMAURL,ajaxData:{user_id:USERID,page:1,limit:12},dataOperate:function(a){var b="";$.each(a.data,function(a,c){b+=splicePicHandler.spliceStrEvent(c)}),$(".picWrap").html(b)}})}},splicePicHandler={spliceStrEvent:function(a){var b='<div class="works_detail works_detail_first fl complete_img" panorama_id="'+a.panorama_id+'">';return b+='\t<a id="pic_del" class="complete_del" href="javascript:;">',b+='\t\t<em class="sprite-details"></em>',b+="\t\t</a>",b+='\t\t<div class="detail_img">',b+='\t<img src="'+a.panorama_img+'">',b+="\t</div><!--detail_img-->",b+='\t\t<a href="'+a.panorama_url+'" class="complete_bg"></a><!--complete_bg-->',b+='\t\t\t<a href="'+a.panorama_url+'" class="panorama_style">'+a.panorama_style+"</a>",b+='\t\t\t<a href="'+a.panorama_url+'" class="bg"></a>',b+="\t\t\t</div><!--works_detail-->"}},billPageHandler={pageContentEvent:function(){$(".page_div").empty().paging({total:Math.ceil(bill_total/4),animation:!1,centerBgColor:"#fff",centerFontColor:"#000",centerBorder:"1px solid #ddd",transition:"all .2s",centerHoverBgColor:"#eec988",centerHoverBorder:"1px solid #eec988",centerFontHoverColor:"#fff",otherFontHoverColor:"#fff",otherBorder:"1px solid #ddd",otherHoverBorder:"1px solid #eec988",otherBgColor:"#fff",otherHoverBgColor:"#eec988",currentFontColor:"#fff",currentBgColor:"#eec988",currentBorder:"1px solid #eec988",fontSize:13,currentFontSize:13,cormer:2,gapWidth:3,showJump:!0,jumpBgColor:"#fff",jumpFontHoverColor:"#fff",jumpHoverBgColor:"#eec988",jumpBorder:"1px solid #ddd",jumpHoverBorder:"1px solid #eec988",submitType:"get",idParameter:"page",url:BILLURL,ajaxData:{user_id:USERID,page:1,limit:3},dataOperate:function(a){var b="";$.each(a.data.calculator_data,function(a,c){b+=spliceBillHandler.spliceStrEvent(c)}),$(".billWrap").html(b)}})}},spliceBillHandler={spliceStrEvent:function(a){newValue=JSON.stringify(a);var b='<div class="check_list" data-cal=\''+newValue+"' calculator_results_id =\""+a.calculator_results_id+'">';return b+='\t<div class="check_list_title">',b+='\t\t<span class="covered_area">建筑面积</span>',b+='\t\t<span class="room_number">厅数</span>',b+='\t<span class="room">房间</span>',b+='\t<span class="toilet">卫生间</span>',b+='\t\t<span class="balcony">阳台</span>',b+='\t\t\t<span class="clearing_time">结算时间</span>',b+='\t\t\t<a id="collection_del" class="collection_del" href="javascript:;">',b+='\t\t\t<em class="sprite-details"></em>',b+="\t\t\t</a>",b+="\t\t\t</div><!--check_list_title-->",b+='\t\t\t<div class="check_list_content">',b+='\t\t\t<span class="covered_area"><i>'+a.area+"</i>m<sup>2</sup></span>",b+='\t\t\t<span class="room_number">'+a.parlour+"</span>",b+='\t\t\t<span class="room">'+a.room+"</span>",b+='\t\t\t<span class="toilet">'+a.toilet+"</span>",b+='\t\t\t<span class="balcony">'+a.balcony+"</span>",b+='\t\t\t<span class="clearing_time">'+a.calculator_results_time+"</span>",b+='\t\t\t<a class="collection_detail" target="_blank" href="calresult.html#/calresult?cs='+a.city+"&mj="+a.area+"&fj="+a.room+"&kt="+a.parlour+"&wsj="+a.toilet+"&yt="+a.balcony+'">查看详情</a>',b+="\t\t\t</div><!--check_list_content-->",b+="\t\t\t</div><!--check_list-->"}},shopPageHandler={pageContentEvent:function(){$(".page_div1").empty().paging({total:Math.ceil(shop_total/4),animation:!1,centerBgColor:"#fff",centerFontColor:"#000",centerBorder:"1px solid #ddd",transition:"all .2s",centerHoverBgColor:"#eec988",centerHoverBorder:"1px solid #eec988",centerFontHoverColor:"#fff",otherFontHoverColor:"#fff",otherBorder:"1px solid #ddd",otherHoverBorder:"1px solid #eec988",otherBgColor:"#fff",otherHoverBgColor:"#eec988",currentFontColor:"#fff",currentBgColor:"#eec988",currentBorder:"1px solid #eec988",fontSize:13,currentFontSize:13,cormer:2,gapWidth:3,showJump:!0,jumpBgColor:"#fff",jumpFontHoverColor:"#fff",jumpHoverBgColor:"#eec988",jumpBorder:"1px solid #ddd",jumpHoverBorder:"1px solid #eec988",submitType:"get",idParameter:"page",url:SHOPCURL,ajaxData:{user_id:USERID,page:1,limit:4},dataOperate:function(a){var b="";$.each(a.data,function(a,c){b+=spliceShopHandler.spliceStrEvent(c)}),$(".shopWrap").html(b),$(".shopWrap .collection_shop .left_img").on("click",function(){var a=$(this).parent().attr("shopid");window.location.href="view_shop.html#/shopdetails?pos="+a})}})}},spliceShopHandler={spliceStrEvent:function(a){var b='<div class="collection_shop clearfix" shopId="'+a.shop_id+'">';return b+='\t<div class="left_img fl">',null!=a.img&&""!=a.img&&(b+='\t<img src="'+a.img+'">'),b+="\t\t</div><!--left_img-->",b+='\t\t<div class="left_detail fl">',b+='\t<p class="manager_shop">'+(null!=a.shop_name&&""!=a.shop_name?a.shop_name:"无"),$.each(a.authentication,function(a,c){b+='\t\t<span style="background-position:'+-20*(c-1)+'px 0" title='+certification[c]+"></span>"}),b+="\t</p>",b+="\t<p>常驻地址：<span>"+(null!=a.shop_address&&""!=a.shop_address?a.shop_address:"无")+"</span></p>",b+="<p>服务范围：",$.each(a.servicearea,function(a,c){b+=""!=c&&null!=c?"<span>"+c+"</span>;":"<span>无</span>"}),b+="</p>",b+='\t\t\t<a class="eyes" href="javascript:;">',b+='\t\t\t<i class="iconfont">&#xe69c;</i><span>'+a.shop_scan+"</span>",b+="\t\t\t</a>",b+='\t\t\t<a class="shake_hands" href="javascript:;">',b+='\t\t\t<i class="iconfont">&#xe626;</i><span>'+a.shop_volume+"</span>",b+="\t\t\t</a>",b+="\t\t\t</p>",b+="\t\t\t</div><!--left_detail-->",b+='\t\t\t<div class="collection_shop_right fr">',b+='\t\t\t<div class="shop_quality_wrap fl">',b+='\t\t\t<p class="shop_quality">工程质量<span>'+a.shop_score.projectquality+"</span>分</p>",b+="\t\t\t<p>服务态度<span>"+a.shop_score.serviceattitude+"</span>分</p>",b+="\t\t\t<p>综合评价<span>"+a.shop_score.overallmerit+"</span>分</p>",b+="\t\t\t</div><!--shop_quality_wrap-->",b+='\t\t\t<a class="collection_shop_del fl" href="javascript:;">',b+='\t\t\t<em class="sprite-details"></em>',b+="\t\t\t</a>",b+="\t\t\t</div><!--collection_shop_right-->",b+="\t\t\t</div><!--collection_shop-->"}},centerWrap.init()}();