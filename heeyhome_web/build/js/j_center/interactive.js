/*! Pc.Heigh-ho.Renovation-1.0.0.js 2017-01-22 */
!function(){var a,b,c,d,e,f,g,h=angular.module("heeyhomeApp"),i="http://www.heeyhome.com/api/public/",j=i+"personal/userinfo",k=i+"personal/userinfo/change",l=i+"personal/portrait",m=i+"personal/portrait/change",n=i+"personal/safe",o=i+"personal/collection/panorama?callback=JSON_CALLBACK",p=i+"personal/collection/shop?callback=JSON_CALLBACK",q=i+"costcalculator/result/get?callback=JSON_CALLBACK",r=i+"costcalculator/result/del?callback=JSON_CALLBACK",s=i+"personal/collection/shopdel?callback=JSON_CALLBACK",t=i+"personal/collection/panoramadel?callback=JSON_CALLBACK",u=i+"personal/message/isnew",v=i+"personal/message",w=i+"personal/message/del",x=i+"personal/message/read",y=i+"personal/message/readall",z=i+"order/shop/list",A=i+"order/client/list",B=i+"order/detail",C=i+"personal/myshop/imgs",D=i+"order/client/selstatus",E=i+"costcalculator/result/get",F=i+"order/client/destory",G='<div class="loading"><img src="image/icon-loading.gif"></div>',H=$.cookie("userId");H=null!=H&&""!=H&&void 0!=H?$.base64.decode($.cookie("userId")):"";var I={init:function(){I.initEvent()},initEvent:function(){var a=this;a.initStyleChangeEvent(),a.initMDataEvent(),a.initMHomeEvent(),a.initMCollectionEvent(),a.initMsgInfo(),a.initMOrderDataEvent(),a.initMOrderDetailEvent(),a.initSuccessPayEvent()},initStyleChangeEvent:function(){h.controller("styleCtrl",["$scope","$http",function(){$(".left_ul li").click(function(){$(this).addClass("left_active").siblings().removeClass("left_active")});var a=window.location.hash,b=$("#left_ul a");b.each(function(){var b=$(this).attr("ui-sref");-1!=a.indexOf(b.replace(".","/"))&&$(this).parent().addClass("left_active")}),$.ajaxSetup({beforeSend:function(){$(".right_content_wrap").append(G),$(".order_content .right_content").append(G),$(".safe_right_content").append(G),$(".safe_right_content .loading").css("top","80%")},complete:function(){$(".right_content_wrap .loading").remove(),$(".order_content .right_content .loading").remove(),$(".safe_right_content .loading").remove()}}),$.ajax({type:"get",url:u,async:!0,dataType:"jsonp",data:{user_id:H},success:function(a){null!=a&&"000"==a.code&&a.data.newmsgtotal>0&&$(".left_ul li").eq(4).append("<i>"+a.data.newmsgtotal+"</i>")},error:function(){}})}])},initMHomeEvent:function(){h.controller("homeCtrl",["$scope","$http",function(){$(".Jcenter").html("我的主页"),$(".left_ul li").eq(0).addClass("left_active").siblings().removeClass("left_active"),getHomeInfoHandler.getInfoEvent(),getHomeInfoHandler.getImgEvent(),getHomeInfoHandler.getOrderEvent(),getHomeInfoHandler.getCollectEvent(),getHomeInfoHandler.getSafeEvent()}])},initMDataEvent:function(){h.controller("mDataCtrl",["$scope","$http",function(){$(".Jcenter").html("个人资料"),$(".left_ul li").eq(1).addClass("left_active").siblings().removeClass("left_active"),$('[data-toggle="distpicker"]').distpicker();for(var a=$("#works_content_title div"),b=0,c=0,d=document.getElementById("title_active"),e=0;e<a.length-1;e++)a[e].onclick=function(){startMoveHandler.startMoveEvent(d,this.offsetLeft,b,c),$(".personal_content").hide(),$(".update_head").hide(),$(".works_content >div:eq("+($(this).index()+1)+")").show().removeClass("hide")};getUserInfoHandler.getInfoEvent(),getUserAvatarHandler.getInfoEvent(),uploadPictureHandler.uploadAvatar()}])},initMOrderDetailEvent:function(){h.controller("order_detailCtrl",["$scope","$http",function(){$("#menuNavOuter").remove();var a=sessionStorage.getItem("shopid"),b=sessionStorage.getItem("orderid");$.ajax({type:"get",url:z,async:!0,dataType:"jsonp",data:{shop_id:a},success:function(a){null!=a&&"000"==a.code?$.each(a.data.order_list,function(a,c){c.order_id==b&&($(".owner_picture img").attr("src",c.user_portrait),$(".owner_summary h3").html(c.user_realname),$(".owner_summary p span").html(c.user_phone),$(".owner_left .area p span").html(c.area),$(".owner_left .order p").html(b),$(".owner_middle .type p").html(c.room+"室"+c.parlour+"厅"+c.toilet+"卫"+c.balcony+"阳台"),$(".owner_middle .time p").html(c.order_time),$(".owner_right .address p").html(c.order_address))}):layer.alert(a.msg)},error:function(){}}),OrderDetail.getDetail()}])},initMOrderDataEvent:function(){h.controller("mMorderCtrl",["$scope","$http",function(){$(".Jcenter").html("我的订单"),$(".left_ul li").eq(2).addClass("left_active").siblings().removeClass("left_active"),$.ajax({type:"get",url:A,async:!0,dataType:"jsonp",data:{user_id:H,page:1,limit:2},success:function(a){if(null!=a&&"000"==a.code){var b=a.data.order_count,c="";$.each(a.data.order_list,function(a,b){c+=spliceOrderHandler.spliceOrderList(b)}),$(".order_content .page_number").before(c),$(".order_box").each(function(){1==$(this).find(".all a").length&&$(this).find(".all .top").addClass("one")}),$(document).off("click",".ordercnt_content .all").on("click",".ordercnt_content .all",function(){var a=$(this).attr("data-shopid"),b=$(this).attr("data-orderid"),c=$(this).attr("data-orderstep");sessionStorage.setItem("shopid",a),sessionStorage.setItem("orderid",b),sessionStorage.setItem("orderstep",c),"取消订单"==$(this).children(".bottom").html()?$.ajax({type:"get",url:F,async:!0,dataType:"jsonp",data:{user_id:H,order_id:b},success:function(a){a&&"000"==a.code?(layer.alert(a.code),location.reload(!0)):layer.alert(a.code)},error:function(){}}):"确认验货"==$(this).children(".bottom").html()&&layer.alert("订单已完成")}),OrderPageHandler.pageContentEvent(b)}else"205"==a.code?($("#orderContent").remove(),$(".not_information").show().removeClass("hide"),$(".not_information_text").html("您的订单空空如也~~")):layer.msg(a.msg)},error:function(){}})}])},initMCollectionEvent:function(){h.controller("mCollectionCtrl",["$scope","$http",function(){$(".Jcenter").html("我的收藏"),$(".left_ul li").eq(3).addClass("left_active").siblings().removeClass("left_active");var a=30,b=location.hash;if(-1!=b.indexOf("?")){var c=b.substring(b.indexOf("?")+1);$(".complete_before").hide(),$(".check_list_wrap").hide(),$(".collection_shop_wrap").hide(),$("#works_complete_wrap >div:eq("+c.substring(6,7)+")").show().removeClass("hide"),a=30+214*c.substring(6,7)}var b=window.location.hash;if(-1!=b.indexOf("#/center/mcollection")){var d=$("#left_ul a");d.each(function(){var a=$(this).attr("ui-sref");-1!=b.indexOf(a.replace(".","/"))&&$(this).parent().addClass("left_active").siblings().removeClass("left_active")})}var e=$("#works_content_title div"),f=0,g=document.getElementById("title_active");$(g).css("left",a+"px");for(var h=0;h<e.length-1;h++)e[h].onclick=function(){startMoveHandler.startMoveEvent(g,this.offsetLeft,f,a),$(".complete_before").hide(),$(".check_list_wrap").hide(),$(".collection_shop_wrap").hide(),$(".works_complete_wrap >div:eq("+$(this).index()+")").show().removeClass("hide"),0==$(this).index()?getPicInfoHandler.picInfo():1==$(this).index()?getBillInfoHandler.billInfoEvent():2==$(this).index()&&getShopInfoHandler.shopInfo()};getPicInfoHandler.picInfo(),getBillInfoHandler.billInfoEvent(),getShopInfoHandler.shopInfo()}])},initMsgInfo:function(){h.controller("msgCtrl",["$scope","$http",function(){$(".Jcenter").html("消息中心"),$(".left_ul li").eq(4).addClass("left_active").siblings().removeClass("left_active"),initInfo.info()}])},initSuccessPayEvent:function(){h.controller("pay_endCtrl",["$scope","$http",function(){$("#headerWrapper").remove(),$("#menuNavOuter").remove()}])}};startMoveHandler={startMoveEvent:function(a,b,c,d){clearInterval(a.timer),a.timer=setInterval(function(){c+=(b-a.offsetLeft)/10,c*=.7,d+=c,Math.abs(c)<1&&Math.abs(d-b)<1?(clearInterval(a.timer),a.style.left=b+"px"):a.style.left=d+"px"},30)}},getHomeInfoHandler={getInfoEvent:function(){$.ajax({url:j,type:"GET",async:!0,dataType:"jsonp",data:{user_id:$.base64.decode($.cookie("userId"))},success:function(b){if(b&&"000"==b.code){var c=b.data.userinfo_phone.substr(0,3)+"****"+b.data.userinfo_phone.substr(7,11);$(".user_name").html(b.data.userinfo_nickname),$("#user_phone").html(c),a=b.data.userinfo_email,null!=a&&($("#email span").html("已绑定"),$("#email a").html("立即修改"))}},error:function(){}})},getImgEvent:function(){$.ajax({url:l,type:"GET",async:!0,dataType:"jsonp",data:{user_id:H},success:function(a){a&&"000"==a.code&&$(".left_img").html('<img src="'+a.data.user_img+'">')},error:function(){}})},getOrderEvent:function(){$.ajax({type:"get",url:A,async:!0,dataType:"jsonp",data:{user_id:H},beforeSend:function(){$(".my_order_content").addClass("loagbg"),$(".order_content_title ").addClass("display"),$(".order_content_cnt ").addClass("display")},success:function(a){if(a&&"000"==a.code){var b=a.data.order_count-1,c=a.data.order_list[b].order_id,d=a.data.order_list[b].shop_id;$.ajax({type:"get",url:C,async:!0,dataType:"jsonp",data:{shop_id:d},success:function(a){if(a&&"000"==a.code){var b=a.data[0].shop_img;$(".order_content_title .order_title_left .order_title_left_img").html('<img src="'+b+'">')}else layer.msg(a.msg)},error:function(){}});var e=a.data.order_list[b].order_status,f=a.data.order_list[b].order_step;$(".order_cnt_right").on("click",function(){sessionStorage.setItem("shopid",a.data.order_list[b].shop_id),sessionStorage.setItem("orderid",a.data.order_list[b].order_id)}),18!=f||1!=e&&2!=e&&3!=e&&4!=e?$(".order_cnt_right .detail").attr("href","order_detail.html#/morder_wrap/morder_detail"):$(".order_cnt_right .detail").attr("href","reservation.html#/waitcontact?type=1"),5==e?3==f||7==f||11==f||15==f?$(".order_cnt_right .operation").attr("href","reservation.html#/materiallist?pos="+a.data.order_list[b].order_id).html("辅材支付"):5==f||9==f||13==f||17==f?$(".order_cnt_right .operation").attr("href","reservation.html#/advancelist?pos="+a.data.order_list[b].order_id).html("人工支付"):($(".order_cnt_right .operation").remove(),$(".order_cnt_right .detail").addClass("one")):6==e?($(".order_cnt_right .operation").html("确认验货"),$(".order_cnt_right .operation").on("click",function(){layer.alert("订单已完成")})):4==e?$(".order_cnt_right .operation").attr("href","reservation.html#/advancelist?pos="+a.data.order_list[b].order_id).html("人工支付"):1==e?($(".order_cnt_right .operation").html("取消订单"),$(".order_cnt_right .operation").off("click",".order_cnt_right .operation").on("click",function(){$.ajax({type:"get",url:F,async:!0,dataType:"jsonp",data:{user_id:H,order_id:c},success:function(a){a&&"000"==a.code?(layer.alert(a.msg),$(".order_cnt_right .operation").css("cursor","not-allowed"),getHomeInfoHandler.getOrderEvent()):layer.alert(a.msg)},error:function(){}})})):($(".order_cnt_right .operation").remove(),$(".order_cnt_right .detail").addClass("one")),$(".order_content_title .order_title_left span").html(a.data.order_list[b].shop_name),$(".order_content_title .order_title_right span").html(a.data.order_list[b].order_time),$(".order_cnt_left .status .order_span_right").html(a.data.order_list[b].order_status_ch),$(".order_cnt_left .address .order_span_right").html(a.data.order_list[b].order_address),$(".order_cnt_left .house .order_span_right .area").html(a.data.order_list[b].area);var g=a.data.order_list[b].room+"室"+a.data.order_list[b].parlour+"厅"+a.data.order_list[b].toilet+"卫"+a.data.order_list[b].balcony+"阳台";$(".order_cnt_left .house .order_span_right .type").html(g);var h=a.data.order_list[b].calculator_result_id;$.ajax({type:"get",url:E,async:!0,dataType:"jsonp",data:{user_id:H},success:function(a){a&&"000"==a.code?$.each(a.data.calculator_data,function(a,b){b.calculator_results_id==h&&$(".order_cnt_left .house .order_span_right .money").html(b.zj)}):layer.alert(a.msg)},error:function(){}});var i="(";$.ajax({type:"get",url:D,async:!0,dataType:"jsonp",data:{user_id:H,order_id:c},success:function(a){a&&"000"==a.code?($.each(a.data.reservation_time_user,function(a,b){i+=b+"   "}),i+=")",$(".order_cnt_left .time .order_span_right").html(1==e?"待工长确认"+i:a.data.reservation_time)):layer.alert(a.msg)},error:function(){}})}else"205"==a.code?($(".my_order_content").remove(),$(".not_information").show().removeClass("hide"),$(".not_information_text").html("您暂时还没有订单消息哦~~")):layer.alert(a.msg)},complete:function(){$(".my_order_content").removeClass("loagbg"),$(".order_content_title ").removeClass("display"),$(".order_content_cnt ").removeClass("display")},error:function(){}})},getCollectEvent:function(){$.ajax({dataType:"JSONP",url:o,type:"GET",async:!0,data:{user_id:H,page:1,limit:1},success:function(a){$("#pic_total").html(a&&"000"==a.code?a.data[0].total:0)},error:function(){}}),$.ajax({dataType:"JSONP",url:p,type:"GET",async:!0,data:{user_id:H,page:1,limit:1},success:function(a){$("#shop_total").html(a&&"000"==a.code?a.data[0].total:0)},error:function(){}}),$.ajax({url:q,type:"GET",async:!0,dataType:"jsonp",data:{user_id:H,page:1,limit:2},success:function(a){$("#bill_total").html(null!=a&&"000"==a.code?a.data.calculator_count:0)},error:function(){}})},getSafeEvent:function(){$.ajax({dataType:"JSONP",url:n,type:"GET",async:!0,data:{user_id:H},success:function(a){a&&"000"==a.code&&(parseInt(a.data.score)>0&&parseInt(a.data.score)<=3.3?($("#active_level").css("width","47px"),$(".safe_name span").eq(0).addClass("active_name")):parseInt(a.data.score)>3.3&&parseInt(a.data.score)<=6.7?($("#active_level").css("width","94px"),$(".safe_name span").eq(1).addClass("active_name")):($("#active_level").css("width","141px"),$(".safe_name span").eq(2).addClass("active_name")))},error:function(){}})}},getUserInfoHandler={getInfoEvent:function(){$.ajax({url:j,type:"GET",async:!0,dataType:"jsonp",data:{user_id:H},success:function(a){if(null!=a&&"000"==a.code){console.log(a.data),"2"==a.data.isedit&&$(".personal_user_name").attr("disabled",!0),$(".personal_user_name").val(a.data.user_name);var b=a.data.userinfo_phone.substr(0,3)+"****"+a.data.userinfo_phone.substr(7,11);if($(".personal_tel").html(b),$(".personal_user_age").val(a.data.userinfo_age),$(".personal_user_nickname").val(a.data.userinfo_nickname),1==a.data.userinfo_sex?$("#man").attr("checked","checked"):$("#women").attr("checked","checked"),null!=a.data.userinfo_email&&""!=a.data.userinfo_email){var c=a.data.userinfo_email,d=a.data.userinfo_email.length,e=c.substr(0,3)+"****"+c.substr(d-3,d);$(".personal_form_list .email").html(e).addClass("apparent"),$(".personal_form_list p a").html("修改绑定")}else $(".personal_form_list .email").removeClass("apparent"),$(".personal_form_list p a").html("绑定邮箱");null!=a.data.loc_province&&""!=a.data.loc_province&&$("#nowAddress").distpicker({province:a.data.loc_province}),null!=a.data.loc_city&&""!=a.data.loc_city&&$("#nowAddress").distpicker({city:a.data.loc_city}),null!=a.data.loc_district&&""!=a.data.loc_district&&$("#nowAddress").distpicker({district:a.data.loc_district}),null!=a.data.home_province&&""!=a.data.home_province&&$("#homeAddress").distpicker({province:a.data.home_province}),null!=a.data.home_city&&""!=a.data.home_city&&$("#homeAddress").distpicker({city:a.data.home_city}),null!=a.data.home_district&&""!=a.data.home_district&&$("#homeAddress").distpicker({district:a.data.home_district}),$(".personal_form_list .personal_area_detail").val(a.data.loc_address)}},error:function(){}}),$(".personal_form .personal_submit").on("click",function(){var a,b=($(".personal_tel").html(),$(".personal_user_name").val()),c=$(".personal_user_age").val(),d=$(".personal_user_nickname").val();a="checked"==$("#man").attr("checked")?1:0;var e=$(".personal_form_list #province1 option:selected").val(),f=$(".personal_form_list #city1 option:selected").val(),g=$(".personal_form_list #district1 option:selected").val(),h=$(".personal_form_list #province2 option:selected").val(),i=$(".personal_form_list #city2 option:selected").val(),j=$(".personal_form_list #district2 option:selected").val(),l=$(".personal_form_list .personal_area_detail").val();$.ajax({type:"get",url:k,async:!0,dataType:"jsonp",data:{user_id:H,name:b,nickname:d,sex:a,age:c,loc_province:e,loc_city:f,loc_district:g,loc_address:l,home_province:h,home_city:i,home_district:j},beforeSend:function(){$(".personal_form .personal_submit").attr("disabled",!0)},success:function(a){layer.msg(null!=a||"000"==a.code?a.msg:a.msg)},complete:function(){$(".personal_form .personal_submit").attr("disabled",!1)},error:function(){}})})}},getUserAvatarHandler={getInfoEvent:function(){$("#user_id").val($.base64.decode($.cookie("userId"))),$("#form").attr("action",m),$(document).ready(function(){var a="";$(".head_submit").click(function(){setTimeout(function(){a=$(document.getElementById("if").contentWindow.document.body).html(),console.log(a);var b=a.substring(a.indexOf("(")+1,a.indexOf(")"));console.log(b);var c=JSON.parse(b);"000"==c.code?layer.alert("上传成功"):"112"==c.code?layer.alert("用户id不能为空"):"121"==c.code?layer.alert("没有图片被上传"):"111"==c.code?layer.alert("上传失败"):"122"==c.code?layer.alert("图片上传出错"):"123"==c.code&&layer.alert("图片上传出错,不能大于2M")},5e3)})})}},OrderDetail={getDetail:function(){var a=sessionStorage.getItem("orderid");$.ajax({type:"get",url:B,async:!0,dataType:"jsonp",data:{order_id:a},success:function(a){if(null!=a&&"000"==a.code)if(18!=a.data.now_order_step){var b='<div class="axis_start">';b+="<h2>进场准备</h2>",b+="<h3>READING..</h3>",b+="</div>";var c='<div class="work_worker">';$.each(a.data.detail,function(a,c){b+=spliceStageHandler.spliceStrEvent(c)}),1!=a.data.now_order_step&&($.each(a.data.worker,function(a,b){c+='<div class="worker">',c+='<img src="'+b.portrait+'">',c+='<p><span class="worker_cname">'+b.name+"</span>",c+="</p></div>"}),c+="</div>",$(".axis_content").append(c)),$(".axis_content").append(b);for(var d=0;d<$(".work_stage .step .status").length;d++)"(undefined)"==$(".work_stage .step .status").eq(d).html()&&$(".work_stage .step .status").eq(d).empty();if($(".work_stage").eq(0).addClass("first_stage").find(".stage_title em").remove(),$(".work_stage").eq(0).find(".stage_title b").before("<i></i>"),$(".complete_stage").prev().children().find(".step").html("工长上传图片"),17==$(".work_stage").length){var e='<div class="axis_end">';e+="<i></i>",e+="<h2>工期完成</h2>",e+="<h3>FINISH</h3>",e+="</div>",$(".axis_content").append(e)}$("#time_axis").css("height",$(".axis_content").height()+200),suspensionMenu.menuTab()}else layer.alert("还未开工哦，亲~~");else layer.alert(a.msg)},error:function(){}})}},getBillInfoHandler={billInfoEvent:function(){function a(){$.ajax({url:q,type:"GET",async:!0,dataType:"jsonp",data:{user_id:H,page:1,limit:4},success:function(a){if(null!=a&&"000"==a.code){c=a.data.calculator_count;var b="";$.each(a.data.calculator_data,function(a,c){b+=spliceBillHandler.spliceStrEvent(c)}),$(".billWrap").html(b),billPageHandler.pageContentEvent(),$(document).on("click",".collection_detail",function(a){sessionStorage.setItem("payJson",$(a.target).parents(".check_list").attr("data-cal"))})}else"200"==a.code&&($(".check_wrap").remove(),$(".check_list_wrap .not_information").show().removeClass("hide"),$(".check_list_wrap .not_information_text").html("您现在还没有关于成本计算的收藏哦~~"))},error:function(){}})}a(),$(document).off("click","#collection_del").on("click","#collection_del",function(b){var c=$(b.target).parents(".check_list").attr("calculator_results_id");$.ajax({url:r,type:"GET",async:!0,dataType:"jsonp",data:{user_id:H,calculator_results_id:c},success:function(b){layer.msg(b.msg),a(),billPageHandler.pageContentEvent()},error:function(a){layer.msg(a.msg)}})})}},getShopInfoHandler={shopInfo:function(){function a(){$.ajax({url:p,type:"GET",async:!0,dataType:"jsonp",data:{user_id:H,page:1,limit:4},success:function(a){if(null!=a&&"000"==a.code){d=a.data[0].total;var b="";$.each(a.data,function(a,c){b+=spliceShopHandler.spliceStrEvent(c)}),$(".shopWrap").html(b),$(".shopWrap .collection_shop .left_img").on("click",function(){var a=$(this).parent().attr("shopid");window.location.href="view_shop.html#/shopdetails?pos="+a}),shopPageHandler.pageContentEvent()}else"117"==a.code&&($(".shop_wrap").remove(),$(".collection_shop_wrap .not_information").show().removeClass("hide"),$(".collection_shop_wrap .not_information_text").html("您现在还没有收藏店铺哦~~"))},error:function(){}})}a(),$(document).off("click",".collection_shop_del").on("click",".collection_shop_del",function(b){var c=$(b.target).parents(".collection_shop").attr("shopId");$.ajax({url:s,type:"GET",async:!0,dataType:"jsonp",data:{user_id:H,shop_id:c},success:function(b){layer.msg(b.msg),a()},error:function(){}})})}},getPicInfoHandler={picInfo:function(){function a(){$.ajax({url:o,type:"GET",async:!0,dataType:"jsonp",data:{user_id:H,page:1,limit:12},success:function(a){if(a&&"000"===a.code){b=a.data[0].total;var c="";$.each(a.data,function(a,b){c+=splicePicHandler.spliceStrEvent(b)}),$(".picWrap").html(c),pageHandler.pageContentEvent()}else"117"==a.code&&($(".img_wrap").remove(),$(".complete_before .not_information").show().removeClass("hide"),$(".complete_before .not_information_text").html("您现在还没有收藏全景图哦~~"))},error:function(a){layer.msg(a.msg)}})}a(),$(document).off("click","#pic_del").on("click","#pic_del",function(){var b=$(this).parent().attr("panorama_id");$.ajax({url:t,type:"GET",async:!0,dataType:"jsonp",data:{user_id:H,panorama_id:b},success:function(b){b&&"000"==b.code&&(layer.msg(b.msg),a(),pageHandler.pageContentEvent())},error:function(a){layer.msg(a.msg)}})})}},uploadPictureHandler={uploadAvatar:function(){var a={thumbBox:".thumbBox",spinner:".spinner",imgSrc:"css/img/imgWrap_bg.png"},b=$(".imageBox").cropbox(a);$("#upload-file").on("change",function(){var c=new FileReader;c.onload=function(c){a.imgSrc=c.target.result,b=$(".imageBox").cropbox(a),$(".thumbBox").show().removeClass("hide")},c.readAsDataURL(this.files[0])}),$("#btnCrop").on("click",function(){var a=b.getDataURL(),c=$(".cropped .result_100"),d=$(".cropped .result_50");c.html(""),d.html(""),c.append('<img src="'+a+'" align="absmiddle" style="width:100px;height:100px;box-shadow:0 0 12px #7E7E7E;">'),d.append('<img src="'+a+'" align="absmiddle" style="width:50px;height:50px;box-shadow:0 0 12px #7E7E7E;" >')}),$("#btnZoomIn").on("click",function(){b.zoomIn()}),$("#btnZoomOut").on("click",function(){b.zoomOut()}),$(".imgWrap").hover(function(){disabledMouseWheel.chromeDepend()},function(){window.onmousewheel=document.onmousewheel=!0,document.removeEventListener("DOMMouseScroll",disabledMouseWheel.firefoxDepend,!1)})}},disabledMouseWheel={chromeDepend:function(){document.addEventListener&&document.addEventListener("DOMMouseScroll",disabledMouseWheel.firefoxDepend,!1),window.onmousewheel=document.onmousewheel=disabledMouseWheel.firefoxDepend},firefoxDepend:function(a){return a=a||window.event,a.preventDefault?(a.preventDefault(),a.stopPropagation()):(a.cancelBubble=!0,a.returnValue=!1),!1}},judgeNews={isnews:function(){$(".main_content").each(function(){"0"==$(this).attr("data-isread")&&$(this).addClass("isnews")})}},readNews={tobeRead:function(){$(".main_content .content").on("click",function(){var a=$(this).siblings(".cnt").html();if(layer.open({type:1,skin:"layui-layer-rim",area:["420px","240px"],content:"<p>"+a+"</p>"}),"0"==$(this).parent().attr("data-isread")){var b=$(this).parent().attr("data-id"),c=$(this).parent(),d=$(".left_ul li i").html();0!=d?(d--,$(".left_ul li i").html(d)):$(".left_ul li i").remove(),$.ajax({type:"get",url:x,async:!0,dataType:"jsonp",data:{msgid:b},success:function(){c.attr("data-isread","1").removeClass("isnews")},error:function(){}})}})}},initInfo={info:function(){$.ajax({type:"get",url:v,async:!0,dataType:"jsonp",data:{user_id:H,page:1,limit:4},success:function(a){null!=a&&"000"==a.code?($(".main_contentWrap").empty(),f=a.data[0].total,$.each(a.data,function(a,b){var c=spliceMsgHandler.spliceStrEvent(b);$(".main_contentWrap").append(c)}),judgeNews.isnews(),readNews.tobeRead(),infopageHandler.pageContentEvent(),deleteRecord.singleSelection(),markRead.checkAll()):"117"==a.code?($("#contentWrap").remove(),$(".not_information").show().removeClass("hide"),$(".not_information_text").html("您的消息空空如也~~")):layer.msg(a.msg)},error:function(){}})}},spliceMsgHandler={spliceStrEvent:function(a){var b='<div class="main_content" data-isread="'+a.isread+'" data-id="'+a.id+'">';return b+='<span class="name">'+a.senduser+"</span>",b+='<span class="content">'+a.msgtitle+"</span>",b+='<span class="time">'+a.sendtime+"</span>",b+='<span class="cnt">'+a.msgcontent+"</span>",b+='<a class="delete" href="javascript:;"><em class="sprite-details"></em></a>',b+="</div>"}},infopageHandler={pageContentEvent:function(){g=Math.ceil(f/4),$(".page_div2").empty().paging({total:g,animation:!1,centerBgColor:"#fff",centerFontColor:"#000",centerBorder:"1px solid #ddd",transition:"all .2s",centerHoverBgColor:"#eec988",centerHoverBorder:"1px solid #eec988",centerFontHoverColor:"#fff",otherFontHoverColor:"#fff",otherBorder:"1px solid #ddd",otherHoverBorder:"1px solid #eec988",otherBgColor:"#fff",otherHoverBgColor:"#eec988",currentFontColor:"#fff",currentBgColor:"#eec988",currentBorder:"1px solid #eec988",fontSize:13,currentFontSize:13,cormer:2,gapWidth:3,showJump:!0,jumpBgColor:"#fff",jumpFontHoverColor:"#fff",jumpHoverBgColor:"#eec988",jumpBorder:"1px solid #ddd",jumpHoverBorder:"1px solid #eec988",submitType:"get",idParameter:"page",url:v,ajaxData:{user_id:H,page:1,limit:4},dataOperate:function(a){$(".main_contentWrap").empty(),$.each(a.data,function(a,b){var c=spliceMsgHandler.spliceStrEvent(b);$(".main_contentWrap").append(c)}),judgeNews.isnews(),readNews.tobeRead(),deleteRecord.singleSelection()}})}},deleteRecord={singleSelection:function(){$(".main_contentWrap .delete").on("click",function(){var a=$(this).parent().attr("data-id");$.ajax({type:"get",url:w,async:!0,dataType:"jsonp",data:{id:a},success:function(a){null!=a&&"000"==a.code?(initInfo.info(),layer.msg(a.msg)):layer.alert(a.msg)},error:function(){}})})}},markRead={checkAll:function(){$(".information_choose a").on("click",function(){$(".information_choose input").is(":checked")?$.ajax({type:"get",url:y,async:!0,dataType:"jsonp",data:{user_id:H},success:function(a){null!=a&&"000"==a.code?($(".main_content").attr("data-isread","1").removeClass("isnews"),$(".left_ul li i").remove()):layer.alert(a.msg)},error:function(){}}):layer.alert("请先选中全选按钮")})}},errorMsgHendler={remindBox:function(a){var b=$("#ReminderBox"),c=$(".remindebox");b.removeClass("display"),$(".info_header span").text(a),c.stop().animate({"margin-top":"-150px",opacity:1},500),$(".remindemodel_ok").on("click",function(){c.stop().animate({"margin-top":"-40px",opacity:0},500,function(){b.addClass("display")})})}},suspensionMenu={menuTab:function(){$(".work_stage").eq(0).addClass("first_stage bar"),$(".work_stage").eq(1).addClass("sdg_stage bar"),$(".work_stage").eq(5).addClass("wg_stage bar"),$(".work_stage").eq(9).addClass("mg_stage bar"),$(".work_stage").eq(13).addClass("yqg_stage bar"),$(".work_stage").eq(17).addClass("end_stage bar");var a="";if($(".work_stage").hasClass("first_stage")&&(a+='<li class="current">',a+='<a href="javascript:void(0)" tab="&first_stage">进场准备</a>',a+="</li>"),$(".work_stage").hasClass("sdg_stage")&&(a+="<li>",a+='<a href="javascript:void(0)" tab="&sdg_stage">水电工阶段</a>',a+="</li>"),$(".work_stage").hasClass("wg_stage")&&(a+="<li>",a+='<a href="javascript:void(0)" tab="&wg_stage">瓦工阶段</a>',a+="</li>"),$(".work_stage").hasClass("mg_stage")&&(a+="<li>",a+='<a href="javascript:void(0)" tab="&mg_stage">木工阶段</a>',a+="</li>"),$(".work_stage").hasClass("yqg_stage")&&(a+="<li>",a+='<a href="javascript:void(0)" tab="&yqg_stage">油漆工阶段</a>',a+="</li>"),$(".work_stage").hasClass("end_stage")&&(a+="<li>",a+='<a href="javascript:void(0)" tab="&end_stage">工期完成</a>',a+="</li>"),$("#suspension_menu ul").append(a),$("#suspension_menu ul li").length>=3){var b="";b+="<li>",b+='<a href="javascript:void(0)" tab="&to_head">回到顶部</a>',b+="</li>",$("#suspension_menu ul").append(b)}var c=$(".commonhead");$(c).addClass("to_head bar");var d=$(".bar"),e=$("#suspension_menu li ");$(e).on("click",function(a){a.stopPropagation();var b,c=$(this).index();b=c==e.length-1?d.eq(0).offset().top:d.eq(c+1).offset().top,$("html,body").stop().animate({scrollTop:b},10)}),$(window).scroll(function(){var a=$(document).scrollTop(),b=$("#suspension_menu"),c="";a>550?$(b).css("display","block"):$(b).css("display","none"),d.each(function(){var b=$(this),d=b.offset().top;return a>d-100&&void(c="&"+b.attr("class").split(" ")[1])});var e=b.find(".current");c&&e.find("a").attr("tab")!=c&&(b.find("[tab= '"+c+"']").parent().addClass("current"),e.removeClass("current"))})}},spliceStageHandler={spliceStrEvent:function(a){1==a.material_pay_status?a.material_pay_status="未配送":2==a.material_pay_status?a.material_pay_status="配送中":3==a.material_pay_status&&(a.material_pay_status="配送完成");var b='<div class="work_stage">';return b+='<div class="stage_title">',b+='<span class="date">'+a.img_time+"</span>",b+="<em></em>",b+="<b></b>",b+='<span class="step">'+a.order_step+'<span class="status">('+a.material_pay_status+")</span></span>",b+="</div>",b+='<div class="stage_content">',b+='<div class="stage_pic clearfix">',$.each(a.img,function(a,c){b+='<div class="pic">',b+='<img src="'+c.img_url+'">',b+="</div>"}),b+="</div>",b+="<p>"+a.img_content+"</p>",b+="</div></div>",a.order_step.indexOf("完成")>0&&(b+='<div class="work_stage complete_stage">',b+='<div class="stage_title">',b+="<i></i>",b+="<b></b>",b+='<span class="step">'+a.order_step+"</span>",b+='<a href="javascript:;" target="_blank" class="balance">结算清单</a>',b+="</div>",b+='<div class="stage_content">',b+="</div></div>"),b}},spliceOrderHandler={spliceOrderList:function(a){var b='<div class="order_box">';if(b+='<div class="ordercnt_title clearfix">',b+='<span class="type">'+a.room+"室 "+a.parlour+"厅"+a.toilet+"卫"+a.balcony+"阳台</span>",b+='<span class="time">'+a.order_time+"</span><span>订单号</span>",b+='<span class="order_num">'+a.order_id+'</span><span class="name">'+a.shop_name+"</span>",b+='</div><div class="ordercnt_content">',b+='<div class="block clearfix"><div class="address">',b+="<p>"+a.order_address+"</p></div>",b+='<div class="area"><p class="item_hover_0"><span>'+a.area+"</span>㎡</p></div>",b+='<div class="now_stage"><p>'+a.order_step_ch+"</p></div>",b+='<div class="money"><p>'+a.actual_finish_amount+"</p></div>",b+='<div class="trade_stage"><p>'+a.order_status_ch+"</p></div>",18!=a.order_step||1!=a.order_status&&2!=a.order_status&&3!=a.order_status&&4!=a.order_status)b+='<div class="all" data-shopid="'+a.shop_id+'" data-orderid="'+a.order_id+'"  data-orderstep="'+a.order_step+'"><a href="order_detail.html#/morder_wrap/morder_detail" target="_blank" class="top">查看详情</a>';else{console.log(a);var c={};c.shop_id=a.shop_id,c.user_id=a.user_id,c.order_id=a.order_id,$.cookie("dd",JSON.stringify(c),{expires:1,path:"/"}),b+='<div class="all" data-shopid="'+a.shop_id+'" data-orderid="'+a.order_id+'"  data-orderstep="'+a.order_step+'"><a href="reservation.html#/waitcontact?type=1" target="_blank" class="top">查看详情</a>'}return 6==a.order_status&&(b+='<a href="javascript:;" class="bottom">确认验货</a>'),1==a.order_status&&(b+='<a href="javascript:;" class="bottom">取消订单</a>'),4==a.order_status&&(b+='<a href="reservation.html#/advancelist?pos='+a.order_id+'"  class="bottom">人工支付</a>'),5==a.order_status&&((3==a.order_step||7==a.order_step||11==a.order_step||15==a.order_step)&&(b+='<a href="reservation.html#/materiallist?pos='+a.order_id+'" class="bottom">辅材支付</a>'),(5==a.order_step||9==a.order_step||13==a.order_step||17==a.order_step)&&(b+='<a href="reservation.html#/advancelist?pos='+a.order_id+'"  class="bottom">人工支付</a>')),b+="</div></div>",b+="</div></div>"}},OrderPageHandler={pageContentEvent:function(a){$(".page_div2").empty().paging({total:Math.ceil(a/2),animation:!1,centerBgColor:"#fff",centerFontColor:"#000",centerBorder:"1px solid #ddd",transition:"all .2s",centerHoverBgColor:"#eec988",centerHoverBorder:"1px solid #eec988",centerFontHoverColor:"#fff",otherFontHoverColor:"#fff",otherBorder:"1px solid #ddd",otherHoverBorder:"1px solid #eec988",otherBgColor:"#fff",otherHoverBgColor:"#eec988",currentFontColor:"#fff",currentBgColor:"#eec988",currentBorder:"1px solid #eec988",fontSize:13,currentFontSize:13,cormer:2,gapWidth:3,showJump:!0,jumpBgColor:"#fff",jumpFontHoverColor:"#fff",jumpHoverBgColor:"#eec988",jumpBorder:"1px solid #ddd",
jumpHoverBorder:"1px solid #eec988",submitType:"get",idParameter:"page",url:A,ajaxData:{user_id:H,page:1,limit:2},dataOperate:function(a){$(".order_content .page_number").prevAll().remove();var b="";$.each(a.data.order_list,function(a,c){b+=spliceOrderHandler.spliceOrderList(c)}),$(".order_content .page_number").before(b),$(".order_box").each(function(){1==$(this).find(".all a").length&&$(this).find(".all .top").addClass("one")}),$(document).off("click",".ordercnt_content .all").on("click",".ordercnt_content .all",function(){var a=$(this).attr("data-shopid"),b=$(this).attr("data-orderid"),c=$(this).attr("data-orderstep");sessionStorage.setItem("shopid",a),sessionStorage.setItem("orderid",b),sessionStorage.setItem("orderstep",c),"取消订单"==$(this).children(".bottom").html()?$.ajax({type:"get",url:F,async:!0,dataType:"jsonp",data:{user_id:H,order_id:b},success:function(a){a&&"000"==a.code?(layer.alert(a.msg),location.reload(!0)):layer.alert(a.code)},error:function(){}}):"确认验货"==$(this).children(".bottom").html()&&layer.alert("订单已完成")})}})}},pageHandler={pageContentEvent:function(){$(".page_div3").empty().paging({total:Math.ceil(b/12),animation:!1,centerBgColor:"#fff",centerFontColor:"#000",centerBorder:"1px solid #ddd",transition:"all .2s",centerHoverBgColor:"#eec988",centerHoverBorder:"1px solid #eec988",centerFontHoverColor:"#fff",otherFontHoverColor:"#fff",otherBorder:"1px solid #ddd",otherHoverBorder:"1px solid #eec988",otherBgColor:"#fff",otherHoverBgColor:"#eec988",currentFontColor:"#fff",currentBgColor:"#eec988",currentBorder:"1px solid #eec988",fontSize:13,currentFontSize:13,cormer:2,gapWidth:3,showJump:!0,jumpBgColor:"#fff",jumpFontHoverColor:"#fff",jumpHoverBgColor:"#eec988",jumpBorder:"1px solid #ddd",jumpHoverBorder:"1px solid #eec988",submitType:"get",idParameter:"page",url:o,ajaxData:{user_id:H,page:1,limit:12},dataOperate:function(a){var b="";$.each(a.data,function(a,c){b+=splicePicHandler.spliceStrEvent(c)}),$(".picWrap").html(b)}})}},splicePicHandler={spliceStrEvent:function(a){var b='<div class="works_detail works_detail_first fl complete_img" panorama_id="'+a.panorama_id+'">';return b+='\t<a id="pic_del" class="complete_del" href="javascript:;">',b+='\t\t<em class="sprite-details"></em>',b+="\t\t</a>",b+='\t\t<div class="detail_img">',b+='\t<img src="'+a.panorama_img+'">',b+="\t</div><!--detail_img-->",b+='\t\t<a href="'+a.panorama_url+'" class="complete_bg"></a><!--complete_bg-->',b+="\t\t\t<span>"+a.panorama_style+"</span>",b+='\t\t\t<a href="'+a.panorama_url+'" class="bg"></a>',b+="\t\t\t</div><!--works_detail-->"}},billPageHandler={pageContentEvent:function(){$(".page_div").empty().paging({total:Math.ceil(c/4),animation:!1,centerBgColor:"#fff",centerFontColor:"#000",centerBorder:"1px solid #ddd",transition:"all .2s",centerHoverBgColor:"#eec988",centerHoverBorder:"1px solid #eec988",centerFontHoverColor:"#fff",otherFontHoverColor:"#fff",otherBorder:"1px solid #ddd",otherHoverBorder:"1px solid #eec988",otherBgColor:"#fff",otherHoverBgColor:"#eec988",currentFontColor:"#fff",currentBgColor:"#eec988",currentBorder:"1px solid #eec988",fontSize:13,currentFontSize:13,cormer:2,gapWidth:3,showJump:!0,jumpBgColor:"#fff",jumpFontHoverColor:"#fff",jumpHoverBgColor:"#eec988",jumpBorder:"1px solid #ddd",jumpHoverBorder:"1px solid #eec988",submitType:"get",idParameter:"page",url:q,ajaxData:{user_id:H,page:1,limit:4},dataOperate:function(a){var b="";$.each(a.data.calculator_data,function(a,c){b+=spliceBillHandler.spliceStrEvent(c)}),$(".billWrap").html(b)}})}},spliceBillHandler={spliceStrEvent:function(a){e=JSON.stringify(a);var b='<div class="check_list" data-cal=\''+e+"' calculator_results_id =\""+a.calculator_results_id+'">';return b+='\t<div class="check_list_title">',b+='\t\t<span class="covered_area">建筑面积</span>',b+='\t\t<span class="room_number">厅数</span>',b+='\t<span class="room">房间</span>',b+='\t<span class="toilet">卫生间</span>',b+='\t\t<span class="balcony">阳台</span>',b+='\t\t\t<span class="clearing_time">结算时间</span>',b+='\t\t\t<a id="collection_del" class="collection_del" href="javascript:;">',b+='\t\t\t<em class="sprite-details"></em>',b+="\t\t\t</a>",b+="\t\t\t</div><!--check_list_title-->",b+='\t\t\t<div class="check_list_content">',b+='\t\t\t<span class="covered_area"><i>'+a.area+"</i>m<sup>2</sup></span>",b+='\t\t\t<span class="room_number">'+a.parlour+"</span>",b+='\t\t\t<span class="room">'+a.room+"</span>",b+='\t\t\t<span class="toilet">'+a.toilet+"</span>",b+='\t\t\t<span class="balcony">'+a.balcony+"</span>",b+='\t\t\t<span class="clearing_time">'+a.calculator_results_time+"</span>",b+='\t\t\t<a class="collection_detail" target="_blank" href="calresult.html#/calresult?cs='+a.city+"&mj="+a.area+"&fj="+a.room+"&kt="+a.parlour+"&wsj="+a.toilet+"&yt="+a.balcony+'">查看详情</a>',b+="\t\t\t</div><!--check_list_content-->",b+="\t\t\t</div><!--check_list-->"}},shopPageHandler={pageContentEvent:function(){$(".page_div1").empty().paging({total:Math.ceil(d/4),animation:!1,centerBgColor:"#fff",centerFontColor:"#000",centerBorder:"1px solid #ddd",transition:"all .2s",centerHoverBgColor:"#eec988",centerHoverBorder:"1px solid #eec988",centerFontHoverColor:"#fff",otherFontHoverColor:"#fff",otherBorder:"1px solid #ddd",otherHoverBorder:"1px solid #eec988",otherBgColor:"#fff",otherHoverBgColor:"#eec988",currentFontColor:"#fff",currentBgColor:"#eec988",currentBorder:"1px solid #eec988",fontSize:13,currentFontSize:13,cormer:2,gapWidth:3,showJump:!0,jumpBgColor:"#fff",jumpFontHoverColor:"#fff",jumpHoverBgColor:"#eec988",jumpBorder:"1px solid #ddd",jumpHoverBorder:"1px solid #eec988",submitType:"get",idParameter:"page",url:p,ajaxData:{user_id:H,page:1,limit:4},dataOperate:function(a){var b="";$.each(a.data,function(a,c){b+=spliceShopHandler.spliceStrEvent(c)}),$(".shopWrap").html(b),$(".shopWrap .collection_shop .left_img").on("click",function(){var a=$(this).parent().attr("shopid");window.location.href="view_shop.html#/shopdetails?pos="+a})}})}},spliceShopHandler={spliceStrEvent:function(a){var b='<div class="collection_shop clearfix" shopId="'+a.shop_id+'">';return b+='\t<div class="left_img fl">',b+='\t<img src="'+a.img+'">',b+="\t\t</div><!--left_img-->",b+='\t\t<div class="left_detail fl">',b+='\t<p class="manager_shop">'+a.shop_name+'<i class="iconfont first_i">',$.each(a.authentication,function(a,c){b+='<img src="'+c+'">'}),b+="\t</i></p>",b+="\t<p>常驻地址：<span>"+a.shop_address+"</span></p>",b+="<p>服务范围：",$.each(a.servicearea,function(a,c){b+="<span>"+c+"</span>;"}),b+="</p>",b+='\t\t\t<a class="eyes" href="javascript:;">',b+='\t\t\t<i class="iconfont">&#xe69c;</i><span>'+a.shop_scan+"</span>",b+="\t\t\t</a>",b+='\t\t\t<a class="shake_hands" href="javascript:;">',b+='\t\t\t<i class="iconfont">&#xe626;</i><span>'+a.shop_volume+"</span>",b+="\t\t\t</a>",b+="\t\t\t</p>",b+="\t\t\t</div><!--left_detail-->",b+='\t\t\t<div class="collection_shop_right fr">',b+='\t\t\t<div class="shop_quality_wrap fl">',b+='\t\t\t<p class="shop_quality">工程质量<span>'+a.shop_score.projectquality+"</span>分</p>",b+="\t\t\t<p>服务态度<span>"+a.shop_score.serviceattitude+"</span>分</p>",b+="\t\t\t<p>综合评价<span>"+a.shop_score.overallmerit+"</span>分</p>",b+="\t\t\t</div><!--shop_quality_wrap-->",b+='\t\t\t<a class="collection_shop_del fl" href="javascript:;">',b+='\t\t\t<em class="sprite-details"></em>',b+="\t\t\t</a>",b+="\t\t\t</div><!--collection_shop_right-->",b+="\t\t\t</div><!--collection_shop-->"}},I.init()}();