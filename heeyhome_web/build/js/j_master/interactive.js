/*! Pc.Heigh-ho.Renovation-1.0.0.js 2017-03-23 */
!function(){var a,b,c,d,e,f,g,h=angular.module("heeyhomeApp"),i="/api/public/",j=i+"personal/foremaninfo?callback=JSON_CALLBACK",k=i+"personal/portrait",l=i+"personal/portrait/change",m=i+"personal/safe",n=i+"myworkers",o=i+"myworkers/workerinfo",p=i+"myworkers/changeworker",q=i+"myworkers/addworker",r=i+"myworkers/pricelist",s=i+"withdraw/apply",t=i+"mywallet/bill",u=i+"mywallet",v=i+"mywallet/bill/del",w=i+"personal/myshop?callback=JSON_CALLBACK",x=i+"personal/myshop/uploadimg",y=i+"personal/myshop/addtechnics",z=i+"personal/myshop/editechnics",A=i+"myworkcase?callback=JSON_CALLBACK",B=i+"addmyworkcase",C=i+"delmyworkcase",D=i+"bankcard/getname?callback=JSON_CALLBACK",E=i+"bankcard/getcardtype?callback=JSON_CALLBACK",F=i+"bankcard/cardverify?callback=JSON_CALLBACK",G=i+"mybankcards?callback=JSON_CALLBACK",H=i+"sendsms",I=i+"personal/myshop/stylelist?callback=JSON_CALLBACK",J=i+"personal/myshop/change",K=i+"personal/myshop/deltechnics",L=i+"personal/myshop/del",M=i+"personal/foremaninfo/change",N=i+"personal/message",O=i+"personal/message/del",P=i+"personal/message/read",Q=i+"personal/message/readall",R=i+"personal/message/isnew",S=i+"order/shop/list",T=i+"order/process/startWork",U=i+"order/process/lookWork",V=i+"order/shop/listfilter",W=i+"order/shop/subupdatemsg",X=i+"order/aeckonandactual/adddate",Y=i+"order/aeckonandactual/generatelist",Z=i+"order/aeckonandactual/getlistname?callback=JSON_CALLBACK",_=i+"order/aeckonandactual/getlistdata?callback=JSON_CALLBACK",aa=i+"order/aeckonandactual/update?callback=JSON_CALLBACK",ba=i+"order/aeckonandactual/selstatus",ca=i+"materialslist",da=i+"order/style/addhousestyle",ea=i+"order/material/produce",fa=i+"/order/appointment",ga=i+"/order/shop/destory",ha=i+"/order/shop/confirm",ia=i+"/order/shop/orderbasicinfo",ja=i+"/order/shop/ordercount",ka=0,la=0,ma='<div class="loading"><img src="image/icon-loading.gif"></div>',na="建筑面积不能为空",oa="请选择有效的户型",pa="请选择装修风格",qa="请选择合适的工期",ra="详细地址不能为空",sa="施工图片不能为空",ta={1:"平台实名认证",2:"保证金",3:"团队保险",4:"两年质保维修"},ua=$.cookie("userId");ua=null!=ua&&""!=ua&&void 0!=ua?$.base64.decode($.cookie("userId")):"";var va=/^(((13[0-9]{1})|(14[0-9]{1})|(17[0]{1})|(15[0-3]{1})|(15[5-9]{1})|(18[0-9]{1}))+\d{8})$/,wa=/^\d{19}$/,xa={init:function(){xa.initEvent()},initEvent:function(){var a=this;a.initStyleChangeEvent(),a.initMHomeEvent(),a.initMDataEvent(),a.initMWorkEvent(),a.initMNewWorkEvent(),a.initMTeamEvent(),a.initMShopEvent(),a.initMOrderEvent(),a.initWithdrawEvent(),a.initOrderProcessEvent(),a.initBankEvent(),a.initBillEvent(),a.initMsgInfo(),a.initTeamDetailEvent(),a.initTeamInfoEvent(),a.initTeamEditEvent(),a.initMaterialEvent(),a.initSuccessCase()},initStyleChangeEvent:function(){h.controller("leftCtrl",["$scope","$http",function(){$(".left_ul li").click(function(){$(this).addClass("left_active").siblings().removeClass("left_active")});var a=window.location.hash,b=$("#left_ul a");b.each(function(){var b=$(this).attr("ui-sref");-1!=a.indexOf(b.replace(".","/"))&&$(this).parent().addClass("left_active")}),$.ajaxSetup({beforeSend:function(){$(".right_content_wrap").append(ma),$(".safe_right_content").append(ma)},complete:function(){$(".right_content_wrap .loading").remove(),$(".safe_right_content .loading").remove()}}),$.ajax({type:"get",url:R,async:!0,dataType:"jsonp",data:{user_id:ua},success:function(a){null!=a&&"000"==a.code&&a.data.newmsgtotal>0&&$(".left_ul li").eq(7).append("<i>"+a.data.newmsgtotal+"</i>")},error:function(){}})}])},initMHomeEvent:function(){h.controller("mhomeCtrl",["$scope","$http",function(){$(".Jforeman").html("我的主页"),$(".left_ul li").eq(0).addClass("left_active").siblings().removeClass("left_active"),getHomeInfoHandler.getInfoEvent(),getHomeInfoHandler.getSafeEvent(),getHomeInfoHandler.getEmailEvent(),getHomeInfoHandler.getImgEvent(),getUserAvatarHandler.getInfoEvent()}])},initMDataEvent:function(){h.controller("mDataCtrl",["$scope","$http",function(){$(".Jforeman").html("个人资料"),$(".left_ul li").eq(1).addClass("left_active").siblings().removeClass("left_active"),$('[data-toggle="distpicker"]').distpicker(),getMasterInfoHandler.getInfoEvent()}])},initMWorkEvent:function(){h.controller("mWorkCtrl",["$scope","$http",function(){$(".Jforeman").html("我的作品"),$(".left_ul li").eq(4).addClass("left_active").siblings().removeClass("left_active");for(var a=$("#works_content_title1 div"),b=0,c=0,d=document.getElementById("title_active"),e=0;e<a.length-1;e++)a[e].onclick=function(){startMoveHandler.startMoveEvent(d,this.offsetLeft,b,c),$(".works_complete_wrap").hide(),$(".works_pending_wrap").hide(),$(".my_work >div:eq("+($(this).index()+1)+")").show().removeClass("hide"),WUndonePageHandler.pageContentEvent(),WCompletePageHandler.pageContentEvent()};getWorkInfoHandler.workInfo()}])},initMNewWorkEvent:function(){h.controller("newworkCtrl",["$scope","$http",function(){new YMDselect("year1","month1","day1"),new YMDselect("year2","month2","day2"),$('[data-toggle="distpicker"]').distpicker(),$.ajax({type:"get",url:I,async:!0,dataType:"jsonp",success:function(a){if(null!=a&&"000"==a.code){var b='<div class="new_stylecnt">';$.each(a.data,function(a,c){b+="<span>"+c.stylename+"</span>"}),b+="</div>",$(".new_style").append(b),$(".new_stylecnt span").on("click",function(){$(this).toggleClass("active").siblings().removeClass("active")})}},error:function(){}}),addPicture.constructionPic(),$(".new_work_content .submit").on("click",function(){ajaxSubmit.confirmAdd()}),removeError.clickEvent()}])},initSuccessCase:function(){h.controller("success_caseCtrl",["$scope","$http",function(){var a,b,c=sessionStorage.getItem("case_id"),d=sessionStorage.getItem("isshopdetail"),e=$.cookie("userType");2==$.base64.decode(e)&&"0"!=d?(a=$.base64.decode($.cookie("userId")),b=$.base64.decode($.cookie("userShopId"))):(a=$.base64.decode($.cookie("foremanId")),b=$.base64.decode($.cookie("shopid"))),$.ajax({type:"get",url:A,async:!0,dataType:"jsonp",data:{foreman_id:a},success:function(a){null!=a&&"000"==a.code?$.each(a.data,function(a,b){if(b.case_id==c){$(".content_top h2 span").html(b.area),$(".content_top .include").html(b.housetype),$(".content_bottom .time").html(b.timelong),$(".content_bottom .address").html(b.address);var d="<ul>";$.each(b.img,function(a,b){d+='<li><img src="'+b.case_img+'"></li>'}),d+="</ul>",$(".bg_picture").append(d),superSlide.slidePic()}}):layer.msg(a.msg)},error:function(){}}),$.ajax({url:w,type:"GET",async:!0,dataType:"jsonp",data:{shop_id:b},success:function(a){a&&"000"==a.code?$("#success_case .now_location .shopname").html(null!=a.data.shop_name&&""!=a.data.shop_name?a.data.shop_name:"无"):layer.alert(a.msg)},error:function(){}})}])},initMTeamEvent:function(){h.controller("mTeamCtrl",["$scope","$http",function(){$(".Jforeman").html("我的团队"),$(".left_ul li").eq(5).addClass("left_active").siblings().removeClass("left_active"),getTeamInfoHandler.getInfoEvent()}])},initTeamDetailEvent:function(){h.controller("teamDetailCtrl",["$scope","$http",function(){$(".left_ul li").eq(5).addClass("left_active").siblings().removeClass("left_active");var a,b=sessionStorage.getItem("cateid"),c=sessionStorage.getItem("eleworker_num"),d=sessionStorage.getItem("woodworker_num"),e=sessionStorage.getItem("brickworker_num"),f=sessionStorage.getItem("paintworker_num"),g=sessionStorage.getItem("mixworker_num");switch(b){case"1":a=g;break;case"2":a=c;break;case"3":a=e;break;case"4":a=d;break;case"5":a=f}$.ajax({type:"get",url:n,async:!0,dataType:"jsonp",data:{shop_id:$.base64.decode($.cookie("userShopId")),cate_id:b,page:1,limit:5},success:function(c){if(null!=c&&"000"==c.code){var d='<div class="team_detail_content clearfix">';$.each(c.data,function(a,b){d+='<div class="worker_box sprite_team" data-id="'+b.userid+'" data-action="edit"><a href="#/master/teamDetail_list">',d+='<div class="head_picture"><img src="'+b.portrait_img+'"></div>',d+='<div class="worker_content"><h3><span class="name">'+b.name+"</span>",d+='<span class="age">'+b.age+"岁</span></h3>",d+='<ul class="worker_information"><li>',d+='<span class="span_left">籍贯</span><span class="span_right">'+b.birthplace+"</span></li>",d+='<li><span class="span_left">从业时间</span><span class="span_right">'+b.worktime+"</span></li>",d+='<li><span class="span_left">手机号</span><span class="span_right">'+b.phone+"</span></li>",d+='<li><span class="span_left">身份证号</span><span class="span_right">'+b.idcard+"</span></li>",d+='<li><span class="span_left">开户银行</span><span class="span_right">'+b.bankname+"</span></li>",d+='<li><span class="span_left">银行卡号</span><span class="span_right">'+b.bankcard+"</span></li>",d+="</ul></div></a></div>"}),d+='<div class="worker_box sprite_team worker_add" data-action="add"><a href="#/master/teamDetail_edit"></a></div></div>',$(".team_detail_wrap .page_number").before(d),$(".team_detail_content .worker_box").on("click",function(){var a=$(this).attr("data-id"),b=$(this).attr("data-action");sessionStorage.setItem("userid",a),sessionStorage.setItem("action",b)}),workpageHandler.pageContentEvent(a,b)}else{var d='<div class="team_detail_content clearfix">';d+='<div class="worker_box sprite_team worker_add" data-action="add"><a href="#/master/teamDetail_edit"></a></div></div>',$(".team_detail_wrap .page_number").before(d),$(".team_detail_content .worker_box").on("click",function(){var a=$(this).attr("data-action");sessionStorage.setItem("action",a)})}},error:function(){}})}])},initTeamInfoEvent:function(){h.controller("teamDetail_listCtrl",["$scope","$http",function(){var a=sessionStorage.getItem("cateid"),b=sessionStorage.getItem("userid");$(".left_ul li").eq(5).addClass("left_active").siblings().removeClass("left_active"),$.ajax({type:"get",url:o,async:!0,dataType:"jsonp",data:{cate_id:a,worker_id:b},success:function(a){if(null!=a&&"000"==a.code){$(".staff_bg img").attr("src",""+a.data.portrait_img),$(".staff_top_info .wname .span_val").html(a.data.name),$(".staff_top_info .wage .span_val").html(a.data.age),$(".staff_top_info .wplace .span_val").html(a.data.birthplace),$(".staff_top_info .wtime .span_val").html(a.data.worktime),$(".staff_top_info .wphone .span_val").html(a.data.phone),$(".staff_top_info .wid_number .span_val").html(a.data.idcard),$(".staff_top_info .wbank_name .span_val").html(a.data.bankname),$(".staff_top_info .wbank_account .span_val").html(a.data.bankcard);var b="<ul>";$.each(a.data.pricelist,function(a,c){$.each(c.service,function(a,c){b+='<li><span class="name">'+c.servicename+"</span>",b+='<span class="unit">'+c.unit+"</span>",b+='<span class="num">'+c.cost+"</span></li>"})}),b+="</ul>",$(".staff_bottom_content").append(b)}else layer.msg(a.msg)},error:function(){}})}])},initTeamEditEvent:function(){h.controller("teamDetail_editCtrl",["$scope","$http",function(){$(".left_ul li").eq(5).addClass("left_active").siblings().removeClass("left_active"),loadDetail.showInformation();var a=sessionStorage.getItem("action");"edit"==a?getInformation.workDetail():($(".staff_picture .add_picture").find("input").change(function(){var a=$(this);a.parent().parent().attr("data-flag","0");var b=a.get(0).files[0],c=new FileReader;return/image\/\w+/.test(b.type)?(c.onload=function(b){a.parent().parent().attr("data-flag","1"),a.parent().parent().addClass("clear"),a.parent().siblings(".close").show(),a.parent().parent().css({background:'url("'+b.target.result+'") no-repeat',backgroundSize:"100% 100%"}),$(".close").on("click",function(){$(this).parent().removeClass("clear"),$(this).parent().css("background",""),$(this).hide()})},void c.readAsDataURL(b)):(a.parent().parent().css("background",""),a.parent().parent().removeClass("clear"),layer.alert("请确保文件为图像类型"),a.val(""),!1)}),$(".staff_confirm").on("click",function(){workerAction.addWorker()}))}])},initMShopEvent:function(){h.controller("mShopCtrl",["$scope","$http",function(){$(".Jforeman").html("店铺资料"),$(".left_ul li").eq(2).addClass("left_active").siblings().removeClass("left_active"),getShopInfoHandler.shopInfo()}])},initWithdrawEvent:function(){getWithdrawInfoHandler.getInfoEvent()},initBankEvent:function(){getBankInfoHandler.getInfoEvent(),getBankInfoHandler.getNameEvent(),getBankInfoHandler.getLogoEvent(),getBankInfoHandler.sendCaptcha()},initBillEvent:function(){h.controller("billCtrl",["$scope","$http",function(){$(".Jforeman").html("我的钱包"),$(".left_ul li").eq(8).addClass("left_active").siblings().removeClass("left_active"),getWalletData.getMoney(),getNearByMonth.fiveMonth(),getBillInfoHandler.getInfoEvent()}])},initMOrderEvent:function(){h.controller("mOrderCtrl",["$scope","$http",function(){$(".Jforeman").html("我的订单"),$(".left_ul li").eq(3).addClass("left_active").siblings().removeClass("left_active"),orderList.getInfoEvent(),orderFilter.getEvent()}])},initOrderProcessEvent:function(){getOrderProcessHandler.getInfoEvent(),getOrderBudgetHandler.getInfoEvent()},initMaterialEvent:function(){h.controller("materialCtrl",["$scope","$http",function(){var a,b,c,d,e,f,g,h=sessionStorage.getItem("orderId");$.ajax({type:"get",url:ia,async:!0,dataType:"jsonp",data:{shop_id:$.base64.decode($.cookie("userShopId")),order_id:h},success:function(i){null!=i&&"000"==i.code?(a=i.data.order_list[0].order_time,b=i.data.order_list[0].user_realname,c=i.data.order_list[0].user_phone,d=i.data.order_list[0].order_address,e=i.data.order_list[0].room+"室"+i.data.order_list[0].parlour+"厅"+i.data.order_list[0].toilet+"卫"+i.data.order_list[0].balcony+"阳台",f=i.data.order_list[0].area,g=i.data.order_list[0].user_portrait,$(".owner_content .owner_picture img").attr("src",g),$(".owner_summary h3").html(b),$(".owner_summary p span").html(c),$(".owner_left .area span").html(f),$(".owner_left .order p").html(h),$(".owner_middle .type p").html(e),$(".owner_middle .time p").html(a),$(".owner_right .address p").html(d),$(".owner_picture img").attr("src",g)):layer.msg(i.msg)},error:function(){}}),MaterialList.getList()}])},initMsgInfo:function(){h.controller("msginfoCtrl",["$scope","$http",function(){$(".Jforeman").html("消息中心"),$(".left_ul li").eq(7).addClass("left_active").siblings().removeClass("left_active"),initInfo.info()}])}};startMoveHandler={startMoveEvent:function(a,b,c,d){clearInterval(a.timer),a.timer=setInterval(function(){c+=(b-a.offsetLeft)/10,c*=.7,d+=c,Math.abs(c)<1&&Math.abs(d-b)<1?(clearInterval(a.timer),a.style.left=b+"px"):a.style.left=d+"px"},30)}},arrowClick={getEvent:function(){var a=$(".order_title div").eq(6),b=($(".order_content .order_box"),$(".order_title div").eq(6).find("ul"));$(a).click(function(){$(b).slideDown(500)},function(){$(a).hasClass("item_hover_180")?$(a).removeClass("item_hover_180"):$(a).addClass("item_hover_180"),$(b).slideToggle(500)})}},orderFilter={getEvent:function(){var a=$(".order_title div").eq(6).find("ul li"),b=0;$(a).click(function(){"待确认"==$(this).html()?b=1:"待上门量房"==$(this).html()?b=3:"待用户预支付"==$(this).html()?b=4:"订单进行中"==$(this).html()?b=5:"已完成"==$(this).html()&&(b=6),$.ajax({url:V,type:"GET",async:!0,dataType:"jsonp",data:{shop_id:$.base64.decode($.cookie("userShopId")),order_status:b,page:1,limit:3},success:function(a){if(a&&"000"==a.code){var c="";f=a.data.order_count,$.each(a.data.order_list,function(b,d){"1"==a.data.order_list[b].order_status?a.data.order_list[b].order_status="待确认":"2"==a.data.order_list[b].order_status?a.data.order_list[b].order_status="待预约":"3"==a.data.order_list[b].order_status?a.data.order_list[b].order_status="待上门量房":"4"==a.data.order_list[b].order_status?a.data.order_list[b].order_status="待用户预支付":"5"==a.data.order_list[b].order_status?a.data.order_list[b].order_status="订单进行中":"6"==a.data.order_list[b].order_status&&(a.data.order_list[b].order_status="已完成"),c+=spliceOrderContent.spliceStrEvent(d),$(".order_wrap").html(c)}),OrderPageHandler.pageContentEvent(f,V,{shop_id:$.base64.decode($.cookie("userShopId")),order_status:b,page:1,limit:3})}else layer.msg(a.msg)},error:function(a){layer.alert(a.msg)}})})}},orderList={getInfoEvent:function(){$.ajax({url:S,type:"GET",async:!0,dataType:"jsonp",data:{shop_id:$.base64.decode($.cookie("userShopId")),page:1,limit:4},success:function(a){if(a&&"000"==a.code){e=a.data.order_count,$(".order_wrap").empty();var b="";$.each(a.data.order_list,function(c,d){"1"==a.data.order_list[c].order_status?a.data.order_list[c].order_status="待确认":"2"==a.data.order_list[c].order_status?a.data.order_list[c].order_status="待预约":"3"==a.data.order_list[c].order_status?a.data.order_list[c].order_status="待上门量房":"4"==a.data.order_list[c].order_status?a.data.order_list[c].order_status="待用户预支付":"5"==a.data.order_list[c].order_status?a.data.order_list[c].order_status="订单进行中":"6"==a.data.order_list[c].order_status?a.data.order_list[c].order_status="已完成":"7"==a.data.order_list[c].order_status?a.data.order_list[c].order_status="已取消":"8"==a.data.order_list[c].order_status&&(a.data.order_list[c].order_status="工长店铺取消"),b+=spliceOrderContent.spliceStrEvent(d),$(".order_wrap").html(b)}),OrderPageHandler.pageContentEvent(e,S,{shop_id:$.base64.decode($.cookie("userShopId")),page:1,limit:4}),arrowClick.getEvent()}else"205"==a.code&&($("#orderContent").remove(),$(".not_information").show().removeClass("hide"),$(".not_information_text").html("您的订单空空如也~~"))},error:function(a){layer.alert(a.msg)}}),$(document).off("click",".progress_updates").on("click",".progress_updates",function(a){var b=$(a.target).parents(".block").find(".stage span").html();"已取消"==b||"工长店铺取消"==b?layer.msg("您现在的订单状态还不能点击~~"):(sessionStorage.setItem("status",$(a.target).parents(".order_box").attr("status")),sessionStorage.setItem("step",$(a.target).parents(".order_box").attr("step")),sessionStorage.setItem("orderId",$(a.target).parents(".order_box").attr("orderId")),window.location.href="order.html#/order")})}},getOrderProcessHandler={getInfoEvent:function(){h.controller("order",["$scope","$http",function(){function a(){$.ajax({url:ia,type:"GET",async:!0,dataType:"jsonp",data:{shop_id:$.base64.decode($.cookie("userShopId")),order_id:g},success:function(a){a&&"000"==a.code&&(c=a.data.order_list[0].order_step,d=a.data.order_list[0].order_status,b())}})}function b(){if("1"==d||"2"==d)$.ajax({url:fa,type:"GET",async:!0,dataType:"jsonp",data:{order_id:g},success:function(a){if("000"==a.code){$("#Ju").val(a.data.user_id);var b="";if(null!=a.data.reservation_time1&&""!=a.data.reservation_time1){var c=a.data.reservation_time1.split(" ")[0];b+='<span class="reservation_time">'+c+"</span>"}if(null!=a.data.reservation_time2&&""!=a.data.reservation_time2){var d=a.data.reservation_time2.split(" ")[0];b+='<span class="reservation_time">'+d+"</span>"}$(".whetherOrders_style").append(b),$(".reservation_time").addClass("cursor")}}}),$(".order_wrap input").attr("disabled","disabled"),$("#whetherOrders_sure").attr("disabled",!1).addClass("bg_eec988"),$("#whetherOrders_cancel").attr("disabled",!1).addClass("border_eec988").addClass("col_eec988"),$(document).on("click",".whetherOrders_style span",function(){$(this).hasClass("on")?$(this).removeClass("border_eec988").removeClass("col_eec988").removeClass("on"):($(this).addClass("border_eec988").addClass("col_eec988").addClass("on"),$(this).siblings("span").removeClass("border_eec988").removeClass("col_eec988").removeClass("on"))}),$(document).on("click","#whetherOrders_sure",function(){var a=$("#Ju").val(),b=!1,c=[];$.each($(".whetherOrders_style span"),function(a,d){$(d).hasClass("on")&&(b=!0,c.push($(d).index()))}),b?$.ajax({url:ha,type:"GET",async:!0,dataType:"jsonp",data:{order_id:g,user_id:a,confirm_time:c[0]},success:function(a){"000"==a.code&&(layer.msg("接单成功"),window.location.href="master.html#/master/morder")}}):layer.msg("请先选择上门时间~~")}),$(document).on("click","#whetherOrders_cancel",function(){var a=$("#Ju").val();$.ajax({url:ga,type:"GET",async:!0,dataType:"jsonp",data:{order_id:g,user_id:a},success:function(a){"000"==a.code&&(layer.msg(a.msg),window.close())}})});else if("3"==d)$.ajax({url:fa,type:"GET",async:!0,dataType:"jsonp",data:{order_id:g},success:function(a){if("000"==a.code){if($("#Ju").val(a.data.user_id),$(".whetherOrders_style p ").html("您的上门时间为"),1==a.data.confirm_time)var b=a.data.reservation_time1.split(" ")[0],c='<span class="reservation_time">'+b+"</span>";else if(2==a.data.confirm_time)var d=a.data.reservation_time2.split(" ")[0],c='<span class="reservation_time">'+d+"</span>";$(".whetherOrders_style span").remove(),$(".whetherOrders_style").append(c),$("#whetherOrders_cancel").addClass("centerit").val("已接单"),$("#whetherOrders_sure").remove()}}}),$(".order_wrap input").attr("disabled","disabled"),$("#order_edit").attr("disabled",!1);else if("4"==d)$.ajax({url:fa,type:"GET",async:!0,dataType:"jsonp",data:{order_id:g},success:function(a){if("000"==a.code){if($("#Ju").val(a.data.user_id),$(".whetherOrders_style p ").html("您的上门时间为"),1==a.data.confirm_time)var b=a.data.reservation_time1.split(" ")[0],c='<span class="reservation_time">'+b+"</span>";else if(2==a.data.confirm_time)var d=a.data.reservation_time2.split(" ")[0],c='<span class="reservation_time">'+d+"</span>";$(".whetherOrders_style span").remove(),$(".whetherOrders_style").append(c),$("#whetherOrders_cancel").addClass("centerit").val("已接单"),$("#whetherOrders_sure").remove()}}}),$(".order_wrap input").attr("disabled","disabled"),$("#order_edit").attr("disabled",!1).addClass("border_eec988").addClass("col_eec988").addClass("new_edit"),$("#order_edit").val("查看"+$("#order_edit").val().substr(2,5));else if("5"==d)switch($(".whetherOrders").hide(),c){case"1":$(".order_process input").attr("disabled","disabled"),$("#order_edit").attr("disabled",!1).addClass("new_edit"),$("#order_edit ").val("查看"+$("#order_edit ").val().substr(2,5)),$.ajax({url:da,type:"GET",async:!0,dataType:"jsonp",data:{order_id:g},success:function(a){a&&"000"==a.code&&null!=a.data["装修风格"]&&""!=a.data["装修风格"]&&void 0!=a.data["装修风格"]&&$(".order_increase").eq(0).attr("disabled",!1)},error:function(){}}),$("#confirm_type").click(function(){var a=$("#testSelect").val();$.ajax({url:da,type:"GET",async:!0,dataType:"jsonp",data:{order_id:g,house_style:a},success:function(b){b&&"000"==b.code&&($(".order_process input").attr("disabled",!1),$(".process_style p").html(a),$("#confirm_type").hide(),$("#testSelect").hide())}})});for(var a=1;18>a;a++)$(".order_edit").eq(a).addClass("determine_process"),$(".order_increase").eq(a).addClass("add_process");submitOrderProgress.getInfoEvent();break;case"2":case"3":case"6":case"7":case"10":case"11":case"14":case"15":$(".order_increase").eq(parseInt(c)-1).attr("disabled",!1);for(var a=0;a<parseInt(c)-1;a++)$(".process_center").eq(a).find("img").attr("src","image/order_success.png"),$(".order_increase").eq(a).hide(),$(".detail_a").eq(a).css("display","block").removeClass("hide"),"0"==e&&$("#order_edit").addClass("new_edit"),c-1>a?($(".order_edit").eq(a).addClass("new_edit"),$(".order_edit").eq(a).val("查看"+$(".order_edit").eq(a).val().substr(2,5))):"0"==f&&($(".order_edit").eq(a).addClass("new_edit"),$(".order_edit").eq(a).val("查看"+$(".order_edit").eq(a).val().substr(2,5)));for(var a=parseInt(c);18>a;a++)$(".order_edit").eq(a).addClass("determine_process"),$(".order_increase").eq(a).addClass("add_process");submitOrderProgress.getInfoEvent();break;case"4":case"8":case"12":case"16":$(".order_edit").eq(parseInt(c)).attr("disabled","disabled"),$(".order_increase").eq(parseInt(c)-1).attr("disabled",!1);for(var a=0;a<parseInt(c);a++)$(".process_center").eq(a).find("img").attr("src","image/order_success.png"),$(".order_increase").eq(a).hide(),$(".detail_a").eq(a).css("display","block").removeClass("hide"),"0"==e&&$("#order_edit").addClass("new_edit"),c-1>a?($(".order_edit").eq(a).addClass("new_edit"),$(".order_edit").eq(a).val("查看"+$(".order_edit").eq(a).val().substr(2,5))):"0"==f&&($(".order_edit").eq(a).addClass("new_edit"),$(".order_edit").eq(a).val("查看"+$(".order_edit").eq(a).val().substr(2,5)));for(var a=parseInt(c)+1;18>a;a++)$(".order_edit").eq(a).addClass("determine_process"),$(".order_increase").eq(a).addClass("add_process");submitOrderProgress.getInfoEvent();break;case"5":case"9":case"13":case"17":for(var a=0;a<parseInt(c);a++)a!=c-1&&$(".process_center").eq(a).find("img").attr("src","image/order_success.png"),$(".order_increase").eq(a).hide(),$(".detail_a").eq(a).css("display","block").removeClass("hide"),"0"==e&&$("#order_edit").addClass("new_edit").val("查看预算单"),c-1>a?($(".order_edit").eq(a).addClass("new_edit"),$(".order_edit").eq(a).val("查看"+$(".order_edit").eq(a).val().substr(2,5))):"0"==f&&($(".order_edit").eq(a).addClass("new_edit"),$(".order_edit").eq(a).val("查看"+$(".order_edit").eq(a).val().substr(2,5))),0!=a&&$(".order_edit").eq(a-1).val("查看"+$(".order_edit").eq(a-1).val().substr(2,5));for(var a=parseInt(c);18>a;a++)$(".order_edit").eq(a).addClass("determine_process"),$(".order_increase").eq(a).addClass("add_process");submitOrderProgress.getInfoEvent()}else if("6"==d){$(".whetherOrders").hide();for(var a=0;17>a;a++)$(".process_center").eq(a).find("img").attr("src","image/order_success.png"),$(".order_increase").eq(a).hide(),$(".detail_a").eq(a).css("display","block").removeClass("hide"),$(".order_edit").eq(a).addClass("new_edit"),$(".order_edit").eq(a).val("查看"+$(".order_edit").eq(a).val().substr(2,5));$(".order_wrap input").attr("disabled",!1)}}new YMDselect("year1","month1","day1");var c,d,e,f,g=sessionStorage.getItem("orderId");a(),$(".order_edit").click(function(){$(this).hasClass("determine_process")?layer.msg("亲，你需要先完成上一步~~"):$(this).hasClass("new_edit")?(sessionStorage.setItem("num","0"),window.location.href="editSheet.html#/budget_sheet"):(sessionStorage.setItem("num","1"),sessionStorage.setItem("typename",$(this).parent(".order_process").find(".process_title").attr("typename")),window.location.href="editSheet.html#/budget_sheet")}),$(".order_increase").click(function(){var a=sessionStorage.getItem("budgetState");if($(this).hasClass("add_process"))layer.msg("亲，你需要先完成上一步~~");else if("1"==a&&"18"==c)$("#pre_add1").attr("disabled","disabled");else if($(this).hasClass("approach")){var b=$(this).parent(".order_process");$(this).addClass("upload"),$(this).siblings(".detail_a").addClass("detail_upload"),$(".add_technology").show().removeClass("hide"),$(".wrap").show().removeClass("hide"),$(".add_technology").css("top",($(window).height()-b.outerHeight())/2+$(document).scrollTop()-100),orderStartWork.upload()}else sessionStorage.setItem("type",$(this).parent(".order_process").find(".process_title").attr("typename")),sessionStorage.setItem("isClick","1"),window.location.href="material.html#/material/list"}),$("#add_close").click(function(){$(".add_technology").hide(),$(".wrap").hide()}),$(".detail_a ").click(function(){if($(this).hasClass("detail_m"))sessionStorage.setItem("type",$(this).parent(".order_process").find(".process_title").attr("typename")),sessionStorage.setItem("isClick","0"),window.location.href="material.html#/material/list";else{var a=$(this).parent(".order_process");$(".see_details").show().removeClass("hide"),$(".wrap").show().removeClass("hide"),$(".see_details").css("top",($(window).height()-a.outerHeight())/2+$(document).scrollTop()-100);var b=$(this).parents(".order_process").index()-1;(5==b||9==b||13==b||17==b)&&(b-=1),orderDeatilWork.detail(b)}}),$(".complete").click(function(){$(".see_details").hide(),$(".wrap").hide()}),$.ajax({type:"get",url:ia,async:!0,dataType:"jsonp",data:{shop_id:$.base64.decode($.cookie("userShopId")),order_id:g},success:function(a){null!=a&&"000"==a.code?(time=a.data.order_list[0].order_time,name=a.data.order_list[0].user_realname,phone=a.data.order_list[0].user_phone,address=a.data.order_list[0].order_address,type=a.data.order_list[0].room+"室"+a.data.order_list[0].parlour+"厅"+a.data.order_list[0].toilet+"卫"+a.data.order_list[0].balcony+"阳台",area=a.data.order_list[0].area,src=a.data.order_list[0].user_portrait,$(".owner_summary h3").html(name),$(".owner_summary p span").html(phone),$(".owner_left .area span").html(area),$(".owner_left .order p").html(g),$(".owner_middle .type p").html(type),$(".owner_middle .time p").html(time),$(".owner_right .address p").html(address),$(".owner_picture img").attr("src",src)):layer.msg(a.msg)},error:function(){}}),$.ajax({url:ba,type:"GET",async:!0,dataType:"jsonp",data:{order_id:g},success:function(a){a&&"000"==a.code?(e=a.data["预算单编辑状态"],f=a.data["结算单编辑状态"],b()):a&&"200"==a.code},error:function(){}}),$.ajax({url:da,type:"GET",async:!0,dataType:"jsonp",data:{order_id:g},success:function(a){a&&"000"==a.code&&null!=a.data["装修风格"]&&($(".process_style p").html(a.data["装修风格"]),$("#confirm_type").hide(),$("#testSelect").hide(),b(),1==c&&($("#pre_add1").attr("disabled",!1),$("#order_edit").attr("disabled",!1)))},error:function(){}})}])}},getOrderBudgetHandler={getInfoEvent:function(){h.controller("edit_sheetCtrl",["$scope","$http",function(){var a,b=sessionStorage.getItem("orderId"),c=sessionStorage.getItem("num");$(document).on("blur","input[type=number]",function(a){var b=$(a.target).val();parseInt(b)<0?($(a.target).css("borderColor","red"),layer.tips("数字不能为负!",$(a.target),{tips:[2,"red"],tipsMore:!0,time:1e3})):$(a.target).css("borderColor","#D4D4D4")}),$.ajax({url:Z,type:"GET",async:!0,dataType:"jsonp",data:{shop_id:$.base64.decode($.cookie("userShopId"))},success:function(d){d&&"000"==d.code&&($.each(d.data,function(a,b){"杂工"==b.category?$(".handyman_ul").append('<li> <span class="servicename">'+b.servicename+'</span> <span class="unit"><b>'+b.cost+"</b>元/<i>"+b.unit+'</i></span> <input type="number" bid="'+b.id+'" typename="杂工"> </li>'):"水电工"==b.category?$(".plumber_ul").append('<li> <span class="servicename">'+b.servicename+'</span> <span class="unit"><b>'+b.cost+"</b>元/<i>"+b.unit+'</i></span> <input type="number" bid="'+b.id+'" typename="水电"> </li>'):"瓦工"==b.category?$(".bricklayer_ul").prepend('<li> <span class="servicename">'+b.servicename+'</span> <span class="unit"><b>'+b.cost+"</b>元/<i>"+b.unit+'</i></span> <input type="number" bid="'+b.id+'" typename="瓦工"> </li>'):"木工"==b.category?$(".wood_ul").prepend('<li> <span class="servicename">'+b.servicename+'</span> <span class="unit"><b>'+b.cost+"</b>元/<i>"+b.unit+'</i></span> <input type="number" bid="'+b.id+'" typename="木工"> </li>'):"油漆工"==b.category?$(".painter_ul").append('<li> <span class="servicename">'+b.servicename+'</span> <span class="unit"><b>'+b.cost+"</b>元/<i>"+b.unit+'</i></span> <input type="number" bid="'+b.id+'" typename="油漆"> </li>'):"工长"==b.category&&$(".foreman_ul").append('<li> <span class="servicename">'+b.servicename+'</span> <span class="unit"><b>'+b.cost+"</b>元/<i>"+b.unit+'</i></span> <input type="number" bid="'+b.id+'" class="foreman"> </li>')}),$.ajax({url:ia,type:"GET",async:!0,dataType:"jsonp",data:{shop_id:$.base64.decode($.cookie("userShopId")),order_id:b},success:function(b){if(b&&"000"==b.code)if(a=b.data.order_list[0].order_step,"18"==a)$(".sheet_right input").attr("disabled","disabled"),$(".after_submit").attr("disabled","disabled");else if("1"==c){$(".construction_sheet input").attr("disabled","disabled");var d=sessionStorage.getItem("typename");"木工"==d?($('.sheet_right input[typename="木工"]').attr("disabled",!1),$(".after_submit").attr("disabled",!1),$("#after_remark").attr("disabled",!1)):"水电"==d?($('.sheet_right input[typename="水电"]').attr("disabled",!1),$('.sheet_right input[typename="杂工"]').attr("disabled",!1),$(".after_submit").attr("disabled",!1),$("#after_remark").attr("disabled",!1)):"瓦工"==d?($('.sheet_right input[typename="瓦工"]').attr("disabled",!1),$(".after_submit").attr("disabled",!1),$("#after_remark").attr("disabled",!1)):"油漆"==d&&($('.sheet_right input[typename="油漆"]').attr("disabled",!1),$(".after_submit").attr("disabled",!1),$("#after_remark").attr("disabled",!1))}}})),$.ajax({url:_,type:"GET",async:!0,dataType:"jsonp",data:{order_id:b},success:function(a){if(a&&"000"==a.code){$("#before_remark").val(a.data["预算单数据"][0].remark),$("#after_remark").val(a.data["结算单数据"][0].remark);var b=a.data["预算单数据"][0];$('.sheet_left input[bid="64"]').val(a.data["预算单数据"][0].foreman_price),$.each(b,function(a,b){a.indexOf("service")>=0&&$('.sheet_left input[bid="'+a.substring(7)+'"]').val(b)});var c=a.data["结算单数据"][0];
$('.sheet_right input[bid="64"]').val(a.data["结算单数据"][0].foreman_price),$.each(c,function(a,b){a.indexOf("service")>=0&&$('.sheet_right input[bid="'+a.substring(7)+'"]').val(b)})}},error:function(){}}),"0"==c&&$(".construction_sheet input").attr("disabled","disabled")},error:function(){}});var d={};$(document).off("click",".before_submit").on("click",".before_submit",function(){var a=!0,c=$('.sheet_left input[type="number"]');$.each(c,function(b,c){d[parseInt($(c).attr("bid")-1)]=$(c).val(),$(c).val()<0&&(a=!1)}),a?$.ajax({url:Y,type:"GET",async:!0,dataType:"jsonp",data:{order_id:b},success:function(){$.ajax({url:X,type:"GET",async:!0,dataType:"jsonp",data:{order_id:b,list_data_json:JSON.stringify(d),remark:$("#before_remark").val()},success:function(a){a&&"000"==a.code?(layer.msg(a.msg),window.location.href="order.html#/order/home"):layer.msg(a.msg)},error:function(){}})},error:function(){}}):layer.msg("数字不能小于0哦~~")}),$(document).off("click",".after_submit").on("click",".after_submit",function(){var a=!0,c={},d=$('.sheet_right input[type="number"]');$.each(d,function(b,d){c[parseInt($(d).attr("bid")-1)]=$(d).val(),$(d).val()<0&&(a=!1)}),a?$.ajax({url:aa,type:"GET",async:!0,dataType:"jsonp",data:{order_id:b,list_data_json:JSON.stringify(c),remark:$("#after_remark").val()},success:function(a){layer.msg(a.msg),a&&"000"==a.code&&(window.location.href="order.html#/order/home")},error:function(){}}):layer.msg("数字不能小于0哦~~")})}])}},orderStartWork={upload:function(){function a(a){$(a).find("input").change(function(){var a=$(this),b=a.get(0).files[0],c=new FileReader;return/image\/\w+/.test(b.type)?(c.onload=function(b){a.parent().addClass("opacity"),a.parent().parent().css("background-image",'url("'+b.target.result+'")'),a.parent().parent().find(".close").removeClass("hide").show()},void c.readAsDataURL(b)):(a.parent().parent().css("background-image",""),a.parent().removeClass("opacity"),layer.msg("请确保文件为图像类型"),a.val(""),!1)})}a(".add_picture"),$(".close").click(function(){$(this).parent().find("a").removeClass("opacity"),$(this).parent().css("background-image",""),$(this).hide()}),$(document).off("click","#upload").on("click","#upload",function(){var a=new FormData,b=$(".year1 option:selected"),c=$(".month1 option:selected"),d=$(".day1 option:selected"),e=b.val()+"-"+c.val()+"-"+d.val();a.append("order_id",sessionStorage.getItem("orderId")),a.append("content",$(".message_input").val()),a.append("time",e);for(var f=1;3>=f;f++)$("#file"+f).val()&&a.append("myfile[]",$("#file"+f)[0].files[0]);"-年份-"==b.html()||"-月份-"==c.html()||"-日期-"==d.html()?(layer.msg("请填写完整的开工时间~"),$(".wrap").show()):$.ajax({url:T,type:"POST",data:a,dataType:"jsonp",jsonp:"callback",cache:!1,processData:!1,contentType:!1,success:function(a){if("000"===a.code){layer.msg(a.msg),$(".upload").hide(),$(".add_technology").hide(),$(".wrap").hide(),$(".detail_upload").removeClass("hide").show();var b=sessionStorage.getItem("orderId");$.ajax({url:ia,type:"GET",async:!0,dataType:"jsonp",data:{shop_id:$.base64.decode($.cookie("userShopId")),order_id:b},success:function(a){a&&"000"==a.code&&sessionStorage.setItem("step",a.data.order_list[0].order_step)}}),location.reload()}else layer.msg(a.msg)},error:function(){alert("错误！！")}})})}},orderDeatilWork={detail:function(a){var b=sessionStorage.getItem("orderId");$(".construction_photo").html(""),$.ajax({url:U,type:"GET",async:!0,dataType:"jsonp",data:{order_id:b,order_step:a},success:function(a){if(a&&"000"==a.code){var b=a.data.time.substring(0,10),c=b.split("-");$(".start_year").html(c[0]),$(".start_month").html(c[1]),$(".start_day").html(c[2]),$(".detail_describe").html(a.data.content),$.each(a.data.imgs,function(a,b){$(".construction_photo").append('<div class="photo fl"> <img src='+b.img_url+"> </div><!--photo-->")})}else layer.msg(a.msg)},error:function(a){layer.alert(a.msg)}})}},submitOrderProgress={getInfoEvent:function(){var a=sessionStorage.getItem("orderId");$(document).on("click",".order_submit",function(){$.ajax({url:W,type:"GET",async:!0,dataType:"jsonp",data:{order_id:a},success:function(a){layer.msg(a&&"000"==a.code?a.msg:a.msg)},error:function(a){layer.alert(a.msg)}})})}},MaterialList={getList:function(){h.controller("listCtrl",["$scope","$http",function(){var a=sessionStorage.getItem("orderId"),b=sessionStorage.getItem("type");"木工"==b?b="wood":"水电"==b?b="ele":"瓦工"==b?b="brick":"油漆"==b&&(b="paint"),$.ajax({type:"get",url:ca,async:!0,dataType:"jsonp",data:{order_id:a},success:function(a){if(null!=a&&"000"==a.code){var c="<ul>";switch(b){case"ele":var d=a.data.ele;$(".title_picture em").css("background-position","-286px -261px"),$(".type_cname").html("水电工"),$(".type_ename").html("PLUMBER");break;case"brick":var d=a.data.brick;$(".title_picture em").css("background-position","-30px -261px"),$(".type_cname").html("瓦工"),$(".type_ename").html("BRICKLAYER");break;case"wood":var d=a.data.wood;$(".title_picture em").css("background-position","-418px -261px"),$(".type_cname").html("木工"),$(".type_ename").html("WOODWORKING");break;case"paint":var d=a.data.paint;$(".title_picture em").css("background-position","-155px -261px"),$(".type_cname").html("油漆工"),$(".type_ename").html("PAINTER")}$.each(d,function(a,b){c+='<li><div class="picture">',c+='<img src="'+b.img+'"></div>',c+='<div class="name">'+b.name+"</div>",c+='<div class="li_right clearfix" id="li_right"><div class="format">',b.spec.length>1?($.each(b.spec,function(a,b){c+="<span>"+b.spec_name+"</span>"}),c+='</div><div class="unit">',$.each(b.spec,function(){c+="<span>"+b.unit+"</span>"}),c+='</div><div class="number">',$.each(b.spec,function(a,b){c+='<div class="control_number"><span class="minus"></span>',c+='<input type="number" value="'+b.num+'" data-id="'+b.id+'"><span class="plus"></span></div>'})):(c+='<span class="none"></span>',c+='</div><div class="unit">',c+='<span class="none">'+b.unit+"</span>",c+='</div><div class="number">',c+='<div class="control_number none"><span class="minus"></span>',c+='<input type="number" value="'+b.spec.num+'" data-id="'+b.spec.id+'"><span class="plus"></span></div>'),c+="</div></div></li>"}),c+="</ul>",$(".sure_send").before(c),numberControl.plusMinus(),sureSend.toUser();var e=sessionStorage.getItem("isClick");"0"==e&&($(".sure_send").attr("disabled",!0),$('.control_number input[type="number"]').attr("disabled",!0))}else layer.msg(a.msg)},error:function(){}})}])}},numberControl={plusMinus:function(){$(".control_number .minus").on("click",function(){var a=$(this).siblings("input");if(a.val()<="0")layer.msg("请输入合理的数量！");else{var b=Math.ceil(a.val());b--,a.val(b)}}),$(".control_number .plus").on("click",function(){var a=$(this).siblings("input"),b=Math.ceil(a.val());b++,a.val(b)})}},sureSend={toUser:function(){$(".sure_send").on("click",function(){for(var a=!0,b=$(".material_content").find("ul input"),c={},d=[],e=[],f=0,g=0;g<b.length;g++)d[g]=b.eq(g).attr("data-id"),b.eq(g).val()!=Math.ceil(b.eq(g).val())?a=!1:(e[g]=b.eq(g).val(),f++),c[d[g]]=e[g];var h=JSON.stringify(c);if(a){var i,j=sessionStorage.getItem("orderId"),k=sessionStorage.getItem("type");"木工"==k?i=4:"水电"==k?i=1:"瓦工"==k?i=3:"油漆"==k&&(i=5),$.ajax({type:"get",url:ea,async:!0,dataType:"jsonp",data:{order_id:j,material_type:i,material_arr:h},beforeSend:function(){$(".sure_send").attr("disabled",!0)},success:function(a){null!=a&&"000"==a.code?(layer.msg(a.msg),window.location.href="order.html#/order/home"):layer.msg(a.msg)},complete:function(){$(".sure_send").attr("disabled",!1)},error:function(){}})}})}},getHomeInfoHandler={getInfoEvent:function(){$.ajax({url:w,type:"GET",async:!0,dataType:"jsonp",data:{shop_id:$.base64.decode($.cookie("userShopId"))},success:function(a){a&&"000"==a.code&&($("#shop_name").html(null!=a.data.shop_name&&""!=a.data.shop_name?a.data.shop_name:"无"),$.each(a.data.authentication,function(a,b){$(".store_name").append("<span title="+ta[b]+"></span>"),$(".store_name span").eq(a).css("background-position","-"+20*(b-1)+"px 0")}),$("#team_person").html(a.data.shop_workernum),$("#shop_scan").html(a.data.shop_scan),$("#projectquality").html(a.data.shop_score.projectquality),$("#serviceattitude").html(a.data.shop_score.serviceattitude),$("#overallmerit").html(a.data.shop_score.overallmerit),$("#collectnum").html(a.data.collectnum))},error:function(){}}),$.ajax({url:ja,type:"GET",async:!0,dataType:"jsonp",data:{shop_id:$.base64.decode($.cookie("userShopId"))},success:function(a){a&&"000"==a.code&&($("#completed").html(a.data["已完成"]),$("#order_progress").html(a.data["未完成"]))},error:function(a){layer.alert(a.msg)}}),$(".enter_store").click(function(){window.location.href="view_shop.html#/shopdetails?pos="+$.base64.decode($.cookie("userShopId"))})},getSafeEvent:function(){$.ajax({dataType:"JSONP",url:m,type:"GET",async:!0,data:{user_id:ua},success:function(a){a&&"000"==a.code&&(parseInt(a.data.score)>0&&parseInt(a.data.score)<=3.3?($("#active_level").css("width","47px"),$(".safe_name span").eq(0).addClass("active_name")):parseInt(a.data.score)>3.3&&parseInt(a.data.score)<=6.7?($("#active_level").css("width","94px"),$(".safe_name span").eq(1).addClass("active_name")):($("#active_level").css("width","141px"),$(".safe_name span").eq(2).addClass("active_name")))},error:function(){}})},getEmailEvent:function(){$.ajax({url:j,type:"GET",async:!0,dataType:"jsonp",data:{foreman_id:ua},success:function(b){null!=b&&"000"==b.code&&(a=b.data.foremaninfo_email,null!=a&&$("#email_p").html("<span>"+a+'</span><a href="#/master/setting/email/email_1">修改绑定</a>'))},error:function(){}})},getImgEvent:function(){$.ajax({url:k,type:"GET",async:!0,dataType:"jsonp",data:{user_id:ua},success:function(a){a&&"000"==a.code&&$(".head").html('<img src="'+a.data.user_img+'"><a class="edit_avatar" href="javascript:;">修改头像<input type="file" name="" id="avatar_file"></a> ')},error:function(){}})}},getUserAvatarHandler={getInfoEvent:function(){$(document).off("change","#avatar_file").on("change","#avatar_file",function(){var a=$(this),b=a.get(0).files[0];if(!/image\/\w+/.test(b.type))return layer.msg("请确保文件为图像类型"),a.val(""),!1;var c=new FormData;c.append("user_id",ua),c.append("myfile",$("#avatar_file")[0].files[0]),$.ajax({type:"POST",url:l,data:c,dataType:"jsonp",jsonp:"callback",cache:!1,processData:!1,contentType:!1,success:function(a){"000"==a.code?(layer.msg(a.msg),getHomeInfoHandler.getImgEvent()):layer.alert(a.msg)},error:function(){layer.alert("未知错误")}})})}},getMasterInfoHandler={getInfoEvent:function(){var b=$(".personal_area_list .area_edit"),c=[],d='<div class="fl reduce"><input class="input_all" type="text" title=""><a class="experience new_circle" style="display:none;" href="javascript:;">删除</a></div> ',e='<a id="area_circle" class="personal_circle new_circle" href="javascript:;">添加</a>',f='<a id="experience_circle" class="personal_circle new_circle" href="javascript:;">添加</a><a id="experience_edit" class="personal_circle new_circle" href="javascript:;">编辑</a>',g='<div class="fl reduce"><input class="personal_user_community" type="text" title=""> <a class="experience1 new_circle"  style="display:none;" href="javascript:;">删除</a></div> ',h='<a id="area_circle" class="personal_circle new_circle" href="javascript:;">添加</a><a id="area_edit" class="personal_circle new_circle" href="javascript:;">编辑</a>';$(".sex").click(function(){$(".sex em").removeClass("checked"),$(this).find("em").addClass("checked")}),$.ajax({url:j,type:"GET",async:!0,dataType:"jsonp",data:{foreman_id:ua},success:function(b){if(b&&"000"==b.code){var c=b.data.foremaninfo_phone.substr(0,3)+"****"+b.data.foremaninfo_phone.substr(7,11);if($(".personal_tel").html(c),$(".personal_user_age").val(b.data.foremaninfo_age),$(".personal_service_length").val(b.data.worktime),$(".personal_user_nickname").val(b.data.foremaninfo_nickname),$(".personal_area_detail").val(b.data.loc_address),a=b.data.foremaninfo_email,null!=a){var d=a.length,g=a.substr(0,3)+"****"+a.substr(d-3,d);$("#email_p").html("<span>"+g+'</span><a href="#/master/setting/email/email_1">修改绑定</a>')}$(".personal_user_name").val(b.data.user_name),1==b.data.foremaninfo_sex?($("#man").attr("checked","checked"),$(".sman em").addClass("checked")):($("#women").attr("checked","checked"),$(".swomen em").addClass("checked"));var i=b.data.experience.length;if(0==i)$(".personal_form_area").append('<a id="experience_circle" class="personal_circle new_circle" href="javascript:;">添加</a>');else{for(var j=0;i>j;j++)$(".personal_form_area").append('<div class="fl"> <input type="text" title="" class="input_all" value="'+b.data.experience[j]+'"><a class="experience new_circle" style="display:none;" href="javascript:;">删除</a></div>');$(".input_all").eq(0).addClass("first"),$(".personal_form_area .experience").eq(0).before(f)}for(var k=b.data.servicearea.length,j=0;k>j;j++)""!=b.data.servicearea[j]&&$("#personal_circle").before('<a class="personal_area" href="javascript:;">'+b.data.servicearea[j]+"</a>");var l=b.data.decoratedareas.length;if(0==l)$(".renovation_area").append(e);else{for(var j=0;l>j;j++)$(".renovation_area").append('<div class="fl"> <input type="text" title="" class="personal_user_community" value="'+b.data.decoratedareas[j]+'"><a class="experience1 new_circle" style="display: none" href="javascript:;">删除</a></div>');$(".renovation_area .experience1").eq(0).before(h)}2==b.data.isedit&&$(".personal_user_name").attr("disabled",!0),$(".personal_user_community").eq(0).addClass("personal_user_first"),$("#loc").distpicker({province:b.data.loc_province,city:b.data.loc_city,district:b.data.loc_district}),$("#home").distpicker({province:b.data.home_province,city:b.data.home_city,district:b.data.home_district})}},error:function(){}}),$("#personal_circle").click(function(){b.removeClass("display");for(var a=0;a<$(".personal_area_list .personal_area").length;a++)c[a]=$(".personal_area_list .personal_area").eq(a).html();for(var a=0;a<$(".personal_area_list .area_edit span").length;a++)$.inArray($(".personal_area_list .area_edit span").eq(a).html(),c)>=0&&$(".personal_area_list .area_edit span").eq(a).addClass("current");b.find("span").unbind("click").click(function(){if($(this).hasClass("current")){$(this).removeClass("current");for(var a=0;a<$(".personal_area_list .personal_area").length;a++)$(this).html()==$(".personal_area_list .personal_area").eq(a).html()&&$(".personal_area_list .personal_area").eq(a).remove()}else $(this).addClass("current"),$("#personal_circle").before('<a class="personal_area" href="javascript:;">'+$(this).html()+"</a>")}),b.find(".area_sure").unbind("click").click(function(){b.addClass("display"),c=[]})}),$(document).off("click","#experience_circle").on("click","#experience_circle",function(){$(".personal_form_area").append(d),$(".input_all").eq(0).addClass("first"),$(".personal_form_area #experience_circle").remove(),$(".personal_form_area #experience_edit").remove(),$(".personal_form_area .experience").eq(0).before(f)}),$(document).off("click","#area_circle").on("click","#area_circle",function(){$(".renovation_area").append(g),$(".personal_user_community").eq(0).addClass("personal_user_first"),$(".renovation_area #area_circle").remove(),$(".renovation_area #area_edit").remove(),$(".renovation_area .experience1").eq(0).before(h)}),$(document).off("click","#experience_edit").on("click","#experience_edit",function(){$(this).parents(".personal_form_area ").find(".experience").show()}),$(document).off("click","#area_edit").on("click","#area_edit",function(){$(this).parents(".renovation_area ").find(".experience1").show()}),$(document).off("click",".experience").on("click",".experience",function(){$(this).parent().remove(),$(".personal_form_area #experience_circle").remove(),$(".personal_form_area #experience_edit").remove(),$(".input_all").eq(0).addClass("first"),0==$(".personal_form_area .experience").length?$(".personal_form_area").append('<a id="experience_circle" class="personal_circle new_circle" href="javascript:;">添加</a>'):0==$(".personal_form_area #experience_circle").length&&$(".personal_form_area").find(".experience").eq(0).before(f)}),$(document).off("click",".experience1").on("click",".experience1",function(){$(this).parent().remove(),$(".renovation_area #area_circle").remove(),$(".renovation_area #area_edit").remove(),$(".personal_user_community").eq(0).addClass("personal_user_first"),0==$(".renovation_area .experience1").length?$(".renovation_area").append(e):$(".renovation_area").find(".experience1").eq(0).before(h)}),$("#personal_submit").click(function(){for(var a=[],b=[],c=[],d=0;d<$(".input_all").length;d++)a.push($(".input_all").eq(d).val());for(var d=0;d<$(".personal_user_community").length;d++)b.push($(".personal_user_community").eq(d).val());for(var d=0;d<$(".personal_area").length;d++)c.push($(".personal_area").eq(d).html());$.ajax({url:M,type:"GET",async:!0,dataType:"jsonp",data:{foreman_id:ua,name:$(".personal_user_name").val(),nickname:$(".personal_user_nickname").val(),age:$(".personal_user_age").val(),worktime:$(".personal_service_length").val(),experience:a,decoratedareas:b,servicearea:c,loc_address:$(".personal_area_detail").val(),loc_province:$("#province1").val(),loc_city:$("#city1").val(),loc_district:$("#district1").val(),home_province:$("#province2").val(),home_city:$("#city2").val(),home_district:$("#district2").val(),sex:$("input[name='sex']:checked").val()},success:function(a){null!=a&&"000"==a.code&&layer.msg(a.msg)},error:function(){}})})}},getWalletData={getMoney:function(){$.ajax({type:"get",url:u,async:!0,dataType:"jsonp",data:{user_id:ua},success:function(a){null!=a&&"000"==a.code?($(".wallet_content_top li .withdraw span").html(a.data.available_total),sessionStorage.setItem("availableTotal",a.data.available_total),sessionStorage.setItem("processType",a.data.process_type),sessionStorage.setItem("money",a.data.money),sessionStorage.setItem("bank",a.data.bank),$(".wallet_content_top li .total span").html(a.data.total),$(".wallet_content_top li .margin span").html(a.data.deposit)):layer.alert(a.msg)},error:function(){}})}},getNearByMonth={fiveMonth:function(){var a,b=new Date,c=[],d=[],e=[];for(a=0;5>a;a++)c[a]=""+b.getFullYear();for(d[0]=b.getMonth()+1,a=1;5>a;a++)if(d[a]=d[a-1]-1,d[a]<=0){d[a]+=12,c[a]--;for(var f=a+1;5>f;f++)c[f]=c[f-1]}for(a=0;5>a;a++)d[a]<10&&(d[a]="0"+d[a]),e[a]=c[a]+" - "+d[a],$(".bottom_title_left a").eq(a).html(e[a])}},BillDelete={deleteRecord:function(){$(".dd_opera").on("click",function(){var a=$(this).parent().attr("data-id");$.ajax({type:"get",url:v,async:!0,dataType:"jsonp",data:{id:a},success:function(a){a&&"000"==a.code?getBillInfoHandler.getInfoEvent():layer.alert(a.msg)},error:function(){}})})}},getBillInfoHandler={getInfoEvent:function(){var a,b,c=$(".bottom_title_left a");c.eq(0).addClass("active"),a=c.eq(0).html().substring(0,4)+c.eq(0).html().substring(7,9),$(".wallet_month").html(c.eq(0).html()),c.on("click",function(){$(this).addClass("active").siblings().removeClass("active"),$(".wallet_month").html($(this).html()),b=$(this).html().substring(0,4)+$(this).html().substring(7,9),$.ajax({type:"get",url:t,async:!0,dataType:"jsonp",data:{user_id:ua,month:b,page:1,limit:4},success:function(a){if(null!=a&&"000"==a.code){var c="",d=a.data[0].total;$.each(a.data,function(a,b){c+=spliceBillContent.spliceStrEvent(b)}),$(".wallet_dl").nextAll().remove(),$(".wallet_bottom_content").append(c),BillDelete.deleteRecord(),BillPageHandler.pageContentEvent(d,b),$(".not_information").hide(),$(".not_information_text").html(),$(".page_number").css("opacity","1"),$(".wallet_bottom_content").css("min-height","220px")}else $(".wallet_dl").nextAll().remove(),$(".page_number").css("opacity","0"),$(".wallet_bottom_content").css("min-height","0"),$(".not_information").show().removeClass("hide"),$(".not_information_text").html("您还没有交易记录哦~~")},error:function(){}})}),$.ajax({type:"get",url:t,async:!0,dataType:"jsonp",data:{user_id:ua,month:a,page:1,limit:4},success:function(b){if(null!=b&&"000"==b.code){var c="",d=b.data[0].total;$.each(b.data,function(a,b){c+=spliceBillContent.spliceStrEvent(b)}),$(".wallet_dl").nextAll().remove(),$(".wallet_bottom_content").append(c),BillDelete.deleteRecord(),BillPageHandler.pageContentEvent(d,a),$(".wallet_bottom_content").css("min-height","220px")}else $(".wallet_dl").nextAll().remove(),$(".page_number").css("opacity","0"),$(".wallet_bottom_content").css("min-height","0"),$(".not_information").show().removeClass("hide"),$(".not_information_text").html("您还没有交易记录哦~~")},error:function(){}})}},BillPageHandler={pageContentEvent:function(a,b){$(".page_div5").empty().paging({total:Math.ceil(a/4),animation:!1,centerBgColor:"#fff",centerFontColor:"#000",centerBorder:"1px solid #ddd",transition:"all .2s",centerHoverBgColor:"#eec988",centerHoverBorder:"1px solid #eec988",centerFontHoverColor:"#fff",otherFontHoverColor:"#fff",otherBorder:"1px solid #ddd",otherHoverBorder:"1px solid #eec988",otherBgColor:"#fff",otherHoverBgColor:"#eec988",currentFontColor:"#fff",currentBgColor:"#eec988",currentBorder:"1px solid #eec988",fontSize:13,currentFontSize:13,cormer:2,gapWidth:3,showJump:!0,jumpBgColor:"#fff",jumpFontHoverColor:"#fff",jumpHoverBgColor:"#eec988",jumpBorder:"1px solid #ddd",jumpHoverBorder:"1px solid #eec988",submitType:"get",idParameter:"page",url:t,ajaxData:{user_id:ua,month:b,page:1,limit:4},dataOperate:function(a){$(".wallet_dl").nextAll().remove();var b="";$.each(a.data,function(a,c){b+=spliceBillContent.spliceStrEvent(c)}),$(".wallet_dl").nextAll().remove(),$(".wallet_bottom_content").append(b),BillDelete.deleteRecord(),$(".not_information").hide(),$(".not_information_text").html(),$(".page_number").css("opacity","1")}})}},spliceBillContent={spliceStrEvent:function(a){var b='<div class="wallet_dd" data-id="'+a.id+'">';return b+='<span class="wallet_time">'+a.time+"</span>",b+='<span class="wallet_account">'+a.content+"</span>",b+='<span class="wallet_coin">'+a.money+"</span>",b+='<span class="wallet_cash">支付成功</span>',b+='<a href="javascript:;" class="dd_opera">',b+='<em class="sprite_team"></em>',b+="</a></div>"}},getWithdrawInfoHandler={getInfoEvent:function(){h.controller("withdraw",["$scope","$http",function(a,b){$("#headerWrapper").remove();var c=sessionStorage.getItem("availableTotal");$(".current_balance b").html(c);var d=sessionStorage.getItem("processType"),e=sessionStorage.getItem("money"),f=sessionStorage.getItem("bank"),g=[];"false"==d?b({method:"JSONP",url:G,params:{user_id:ua}}).success(function(b){"000"===b.code&&($.each(b.data,function(b,c){if(c.bankname==f){var d=c.bankcardno;c.bankcardnoDim=d.substr(d.length-4),g.push(c),a.wbanks=g}}),a.renderFinish=function(){$(".radio_money").attr("checked","checked"),$(".bank_fr").remove(),$("#money").attr("disabled",!0).val(e),$("#cash_confirm").attr("disabled",!0).val("正在提现中...")})}):b({method:"JSONP",url:G,params:{user_id:ua}}).success(function(b){if("000"===b.code){for(var c=0;c<b.data.length;c++){var d=b.data[c].bankcardno;b.data[c].bankcardnoDim=d.substr(d.length-4)}a.wbanks=b.data}else $("#choose_bank").append('<div class="not_bank fl"> <span>您还没有绑定银行卡哦~~ 点击去</span><a href="bank.html#/bank/home"> 绑定 </a> </div><!--not_bank-->')}).error(function(){}),$("#cash_confirm").click(function(){var b=$('input:radio[name="money"]:checked').val();if(null==b)return layer.alert("请至少选择一个银行卡！"),!1;if(""==$("#money").val())layer.alert("提现金额不能为空！");else if($("#money").val()<=0)layer.alert("提现金额不能小于等于0！");else{var c;$.each(a.wbanks,function(a,b){$(".bank :radio").eq(a).data("no",b.bankcardno),b.bankcardno==$(".bank :radio:checked").data("no")&&(c=b)}),$.ajax({url:s,type:"GET",async:!0,dataType:"jsonp",data:{user_id:ua,bankcardno:c.bankcardno,bankname:c.bankname,cardtype:c.cardtype,money:$("#money").val()},success:function(a){"000"==a.code?($(".withdraw_complete").show().removeClass("hide"),$(".withdraw_contentWrap").hide()):layer.msg(a.msg)},error:function(a){layer.msg(a.msg)}})}})}])}},getBankInfoHandler={getInfoEvent:function(){h.controller("bank",["$scope","$http",function(a,b){$("#headerWrapper").remove(),b({method:"JSONP",url:G,params:{user_id:ua}}).success(function(b){if("000"===b.code){for(var c=0;c<b.data.length;c++){var d=b.data[c].bankcardno;b.data[c].bankcardno=d.substr(d.length-4)}a.banks=b.data}else layer.msg(b.msg)}).error(function(){})}]),h.controller("process4",["$scope","$http",function(){$("#headerWrapper").remove()}])},getNameEvent:function(){h.controller("process1",["$scope","$http",function(){$("#headerWrapper").remove(),$.ajax({url:D,type:"GET",async:!0,dataType:"jsonp",data:{user_id:ua},success:function(a){a&&"000"==a.code?(b=a.data.realname,c=a.data.idcardno,$("#process1_next").click(function(){""==$("#card_name").val()?layer.alert("持卡人姓名不能为空"):$("#card_name").val()!=b?layer.alert("持卡人姓名与真实姓名不相符"):""==$("#card_no").val()?layer.alert("卡号不能为空"):wa.test($("#card_no").val())?($.cookie("b",$.base64.encode($("#card_no").val())),$.cookie("r",$.base64.encode(a.data.realname,"utf8")),$.cookie("i",$.base64.encode(a.data.idcardno)),window.location.href="#bank/add_process2"):layer.alert("银行卡格式不正确")})):"133"==a.code&&(layer.alert("您还没有进行身份验证，您可以在安全设置中进行验证~~如果您已验证过，请耐心等待我们的审核~~"),$("#card_name").attr("disabled",!0),$("#card_no").attr("disabled",!0),$("#process1_next").attr("disabled",!0))},error:function(a){layer.alert(a.msg)}})}])},getLogoEvent:function(){h.controller("process2",["$scope","$http",function(){var a=$.base64.decode($.cookie("b"));$("#headerWrapper").remove(),$.ajax({url:E,type:"GET",async:!0,dataType:"jsonp",data:{user_id:ua,realname:b,idcardno:c,bankcardno:a},success:function(a){a&&"000"==a.code&&($("#card_type").attr("placeholder",a.data.bankname),$("#process2_next").click(function(){""==$("#reserved_phone").val()?layer.alert("电话不能为空"):va.test($("#reserved_phone").val())?($.cookie("phone",$.base64.encode($("#reserved_phone").val())),$.cookie("bankname",$.base64.encode(a.data.bankname,"utf8")),sessionStorage.setItem("cardtype",a.data.cardtype),sessionStorage.setItem("banklogo",a.data.banklogo),window.location.href="#bank/add_process3"):layer.alert("手机号码格式不正确")}))},error:function(a){layer.alert(a.msg)}})}])},sendCaptcha:function(){h.controller("process3",["$scope","$http",function(){$("#headerWrapper").remove();var a=$.base64.decode($.cookie("phone")),b=$.base64.decode($.cookie("b")),c=unescape($.base64.decode($.cookie("bankname"),"utf8")),d=sessionStorage.getItem("cardtype"),e=sessionStorage.getItem("banklogo"),f=unescape($.base64.decode($.cookie("r"),"utf8")),g=$.base64.decode($.cookie("i")),h=$("#verification_code"),i=a.substr(0,3)+"****"+a.substr(7,11);$("#phone_number").html(i),h.click(function(){var b=60;$.ajax({url:H,type:"GET",async:!0,dataType:"jsonp",data:{phone:a},success:function(a){"000"==a.code?(h.addClass("zc_btnClick").attr("disabled",!0),h.val(b+"秒后重新获取"),InterValObj=window.setInterval(function(){1==b?(window.clearInterval(InterValObj),h.removeClass("zc_btnClick").removeAttr("disabled"),h.val("获取验证码")):(b--,h.val(b+"秒后重新获取"))},1e3)):layer.alert(a.msg)},error:function(){}})}),$("#process3_next").click(function(){""==$("#code_input").val()?layer.alert("验证码不能为空"):$.ajax({url:F,type:"GET",async:!0,dataType:"jsonp",data:{user_id:ua,realname:f,idcardno:g,bankcardno:b,bankname:c,cardtype:d,phone:a,captcha:$("#code_input").val(),banklogo:e},success:function(a){"000"==a.code?window.location.href="#bank/add_process4":layer.msg(a.msg)},error:function(a){layer.alert(a.msg)}})})}])}},getTeamInfoHandler={getInfoEvent:function(){var a=$(".team_bg_wrap");$.ajax({url:n,type:"GET",async:!0,dataType:"jsonp",data:{shop_id:$.base64.decode($.cookie("userShopId"))},success:function(b){null!=b&&"000"==b.code&&(sessionStorage.setItem("eleworker_num",b.data.eleworker.length),sessionStorage.setItem("woodworker_num",b.data.woodworker.length),sessionStorage.setItem("brickworker_num",b.data.brickworker.length),sessionStorage.setItem("paintworker_num",b.data.paintworker.length),sessionStorage.setItem("mixworker_num",b.data.mixworker.length),$("#eleworker").html(b.data.eleworker.length),$("#woodworker").html(b.data.woodworker.length),$("#brickworker").html(b.data.brickworker.length),$("#paintworker").html(b.data.paintworker.length),$("#mixworker").html(b.data.mixworker.length),$(".team_content .team_bg_wrap").on("click",function(){var a=$(this).children("a").attr("data-id");sessionStorage.setItem("cateid",a)}),0!=b.data.eleworker.length&&a.eq(0).css("background","url("+b.data.eleworker[0].portrait_img+")"),0!=b.data.woodworker.length&&a.eq(1).css("background","url("+b.data.woodworker[0].portrait_img+")"),0!=b.data.brickworker.length&&a.eq(2).css("background","url("+b.data.brickworker[0].portrait_img+")"),0!=b.data.paintworker.length&&a.eq(3).css("background","url("+b.data.paintworker[0].portrait_img+")"),0!=b.data.mixworker.length&&a.eq(4).css("background","url("+b.data.mixworker[0].portrait_img+")"))},error:function(){}})}},workerAction={editWorker:function(){var a=[],b=sessionStorage.getItem("cateid"),c=sessionStorage.getItem("userid"),d=!0,e=$(".staff_name .name").val(),f=$(".staff_name .sex option:selected").val(),g=$(".staff_name .age").val(),h=$(".staff_home .place").val(),i=$(".staff_date input").val(),j=$(".staff_phone .idcard").val(),k=$(".staff_phone .bankcard").val(),l=$(".staff_phone .phone").val(),m=$(".staff_phone .bankname").val();""==e||null==e?(layer.msg("姓名不能为空"),d=!1):""==g||null==g?(layer.msg("年龄不能为空"),d=!1):""==h||null==h?(layer.msg("籍贯不能为空"),d=!1):""==i||null==i?(layer.msg("从业时间不能为空"),d=!1):""==l||null==l?(layer.msg("手机号不能为空"),d=!1):""==j||null==j?(layer.msg("身份证号不能为空"),d=!1):""==m||null==m?(layer.msg("开户银行不能为空"),d=!1):(""==k||null==k)&&(layer.msg("银行卡号不能为空"),d=!1);for(var n=0;n<$(".edit_bottom li input").length;n++)if(""==$(".edit_bottom li input").eq(n).val()||null==$(".edit_bottom li input").eq(n).val()){layer.alert("价格明细表有项未填"),d=!1;break}if(d)switch(b){case"1":for(var n=0;n<$(".edit_bottom li input").length;n++)a[n+1]=$(".edit_bottom li input").eq(n).val();$.ajax({type:"get",url:p,async:!0,dataType:"jsonp",data:{cate_id:b,worker_id:c,name:e,sex:f,age:g,birthplace:h,worktime:i,idcard:j,bankcard:k,phone:l,bankname:m,service1:a[1],service2:a[2],service3:a[3],service4:a[4],service5:a[5],service6:a[6],service7:a[7],service8:a[8],service9:a[9],service10:a[10],service11:a[11],service12:a[12],service13:a[13],service14:a[14],service15:a[15],service16:a[16]},success:function(a){null!=a&&"000"==a.code?(layer.msg(a.msg),window.location.href="#/master/mteam",location.reload(!0)):layer.alert(a.msg)}});break;case"2":for(var n=0;n<$(".edit_bottom li input").length;n++)a[n+17]=$(".edit_bottom li input").eq(n).val();$.ajax({type:"get",url:p,async:!0,dataType:"jsonp",data:{cate_id:b,worker_id:c,name:e,sex:f,age:g,birthplace:h,worktime:i,idcard:j,bankcard:k,phone:l,bankname:m,service17:a[17],service18:a[18]},success:function(a){null!=a&&"000"==a.code?(layer.msg(a.msg),window.location.href="#/master/mteam",location.reload(!0)):layer.alert(a.msg)}});break;case"3":for(var n=0;n<$(".edit_bottom li input").length;n++)a[n+19]=$(".edit_bottom li input").eq(n).val();$.ajax({type:"get",url:p,async:!0,dataType:"jsonp",data:{cate_id:b,worker_id:c,name:e,sex:f,age:g,birthplace:h,worktime:i,idcard:j,bankcard:k,phone:l,bankname:m,service19:a[19],service20:a[20],service21:a[21],service22:a[22],service23:a[23],service24:a[24],service25:a[25],service26:a[26],service27:a[27],service28:a[28],service29:a[29],service30:a[30],service31:a[31],service32:a[32],service33:a[33],service34:a[34],service35:a[35],service36:a[36],service37:a[37],service38:a[38],service39:a[39],service40:a[40],service41:a[41]},success:function(a){null!=a&&"000"==a.code?(layer.msg(a.msg),window.location.href="#/master/mteam",location.reload(!0)):layer.alert(a.msg)}});break;case"4":for(var n=0;n<$(".edit_bottom li input").length;n++)a[n+42]=$(".edit_bottom li input").eq(n).val();$.ajax({type:"get",url:p,async:!0,dataType:"jsonp",data:{cate_id:b,worker_id:c,name:e,sex:f,age:g,birthplace:h,worktime:i,idcard:j,bankcard:k,phone:l,bankname:m,service42:a[42],service43:a[43],service44:a[44],service45:a[45],service46:a[46],service47:a[47],
service48:a[48],service49:a[49],service50:a[50],service51:a[51],service52:a[52],service53:a[53]},success:function(a){null!=a&&"000"==a.code?(layer.msg(a.msg),window.location.href="#/master/mteam",location.reload(!0)):layer.alert(a.msg)}});break;case"5":for(var n=0;n<$(".edit_bottom li input").length;n++)a[n+54]=$(".edit_bottom li input").eq(n).val();$.ajax({type:"get",url:p,async:!0,dataType:"jsonp",data:{cate_id:b,worker_id:c,name:e,sex:f,age:g,birthplace:h,worktime:i,idcard:j,bankcard:k,phone:l,bankname:m,service54:a[54],service55:a[55],service56:a[56],service57:a[57],service58:a[58],service59:a[59],service60:a[60],service61:a[61],service62:a[62],service63:a[63]},success:function(a){null!=a&&"000"==a.code?(layer.msg(a.msg),window.location.href="#/master/mteam",location.reload(!0)):layer.alert(a.msg)}})}},addWorker:function(){var a=[],b=sessionStorage.getItem("cateid"),c=(sessionStorage.getItem("shopid"),!0),d=new FormData,e=$(".staff_name .name").val(),f=$(".staff_name .sex option:selected").val(),g=$(".staff_name .age").val(),h=$(".staff_home .place").val(),i=$(".staff_date input").val(),j=$(".staff_phone .idcard").val(),k=$(".staff_phone .bankcard").val(),l=$(".staff_phone .phone").val(),m=$(".staff_phone .bankname").val();d.append("cate_id",b),d.append("myfile",$("#worker_picture")[0].files[0]),d.append("shop_id",$.base64.decode($.cookie("userShopId"))),d.append("name",e),d.append("sex",f),d.append("age",g),d.append("birthplace",h),d.append("worktime",i),d.append("idcard",j),d.append("bankcard",k),d.append("phone",l),d.append("bankname",m),"0"==$(".staff_picture .add_picture").attr("data-flag")?(layer.msg("未上传头像"),c=!1):""==e||null==e?(layer.msg("姓名不能为空"),c=!1):""==g||null==g?(layer.msg("年龄不能为空"),c=!1):""==h||null==h?(layer.msg("籍贯不能为空"),c=!1):""==i||null==i?(layer.msg("从业时间不能为空"),c=!1):""==l||null==l?(layer.msg("手机号不能为空"),c=!1):""==j||null==j?(layer.msg("身份证号不能为空"),c=!1):""==m||null==m?(layer.msg("开户银行不能为空"),c=!1):(""==k||null==k)&&(layer.msg("银行卡号不能为空"),c=!1);for(var n=0;n<$(".edit_bottom li input").length;n++)if(""==$(".edit_bottom li input").eq(n).val()||null==$(".edit_bottom li input").eq(n).val()){layer.msg("价格明细表有项未填"),c=!1;break}if(c)switch(b){case"1":for(var n=0;n<$(".edit_bottom li input").length;n++)a[n+1]=$(".edit_bottom li input").eq(n).val(),d.append("service"+(n+1),a[n+1]);$.ajax({type:"post",url:q,dataType:"jsonp",jsonp:"callback",data:d,cache:!1,processData:!1,contentType:!1,success:function(a){"000"==a.code?(layer.msg("添加工人成功"),window.location.href="#/master/mteam",location.reload(!0)):layer.alert(a.msg)},error:function(){layer.alert("未知错误")}});break;case"2":for(var n=0;n<$(".edit_bottom li input").length;n++)a[n+17]=$(".edit_bottom li input").eq(n).val(),d.append("service"+(n+17),a[n+17]);$.ajax({type:"post",url:q,dataType:"jsonp",jsonp:"callback",data:d,cache:!1,processData:!1,contentType:!1,success:function(a){"000"==a.code?(layer.msg("添加工人成功"),window.location.href="#/master/mteam",location.reload(!0)):layer.alert(a.msg)},error:function(){layer.alert("未知错误")}});break;case"3":for(var n=0;n<$(".edit_bottom li input").length;n++)a[n+19]=$(".edit_bottom li input").eq(n).val(),d.append("service"+(n+19),a[n+19]);$.ajax({type:"post",url:q,dataType:"jsonp",jsonp:"callback",data:d,cache:!1,processData:!1,contentType:!1,success:function(a){"000"==a.code?(layer.msg("添加工人成功"),window.location.href="#/master/mteam",location.reload(!0)):layer.alert(a.msg)},error:function(){layer.alert("未知错误")}});break;case"4":for(var n=0;n<$(".edit_bottom li input").length;n++)a[n+42]=$(".edit_bottom li input").eq(n).val(),d.append("service"+(n+42),a[n+42]);$.ajax({type:"post",url:q,dataType:"jsonp",jsonp:"callback",data:d,cache:!1,processData:!1,contentType:!1,success:function(a){"000"==a.code?(layer.msg("添加工人成功"),window.location.href="#/master/mteam",location.reload(!0)):layer.alert(a.msg)},error:function(){layer.alert("未知错误")}});break;case"5":for(var n=0;n<$(".edit_bottom li input").length;n++)a[n+54]=$(".edit_bottom li input").eq(n).val(),d.append("service"+(n+54),a[n+54]);$.ajax({type:"post",url:q,dataType:"jsonp",jsonp:"callback",data:d,cache:!1,processData:!1,contentType:!1,success:function(a){"000"==a.code?(layer.msg("添加工人成功"),window.location.href="#/master/mteam",location.reload(!0)):layer.alert(a.msg)},error:function(){layer.alert("未知错误")}})}}},getInformation={workDetail:function(){var a=sessionStorage.getItem("cateid"),b=sessionStorage.getItem("userid");$.ajax({type:"get",url:o,async:!0,dataType:"jsonp",data:{cate_id:a,worker_id:b},success:function(a){if(a&&"000"==a.code){var c=[],d=0,e=$(".edit_bottom li").length;$(".staff_picture .add_picture").attr("data-flag","1").addClass("clear").css({background:'url("'+a.data.portrait_img+'") no-repeat',backgroundSize:"100% 100%"}),$(".staff_name .name").val(a.data.name),1==a.data.sex?$("#man").attr("selected","selected"):$("#women").attr("selected","selected"),$(".staff_name .age").val(a.data.age),$(".staff_home .place").val(a.data.birthplace),$(".staff_date input").val(a.data.worktime),$(".staff_phone .idcard").val(a.data.idcard),$(".staff_phone .bankcard").val(a.data.bankcard),$(".staff_phone .phone").val(a.data.phone),$(".staff_phone .bankname").val(a.data.bankname),$.each(a.data.pricelist,function(a,b){$.each(b.service,function(a,b){c[d]=b.cost,d++})});for(var f=0;e>f;f++)$(".edit_bottom li").eq(f).find("input").val(c[f]);$(".staff_picture .add_picture").find("input").change(function(){var a=$(this);a.parent().parent().attr("data-flag","0");var c=a.get(0).files[0],d=new FileReader;return/image\/\w+/.test(c.type)?(d.onload=function(c){a.parent().parent().attr("data-flag","1"),a.parent().parent().addClass("clear"),a.parent().parent().css({background:'url("'+c.target.result+'") no-repeat',backgroundSize:"100% 100%"});var d=new FormData;d.append("myfile",$("#worker_picture")[0].files[0]),d.append("user_id",b),$.ajax({type:"post",url:l,cache:!1,data:d,dataType:"jsonp",jsonp:"callback",processData:!1,contentType:!1,success:function(a){layer.alert(a.msg)},error:function(){layer.alert("未知错误")}})},void d.readAsDataURL(c)):(a.parent().parent().css("background",""),a.parent().parent().removeClass("clear"),layer.alert("请确保文件为图像类型"),a.val(""),!1)}),$(".staff_confirm").on("click",function(){workerAction.editWorker()})}else layer.alert(a.msg)},error:function(){}})}},loadDetail={showInformation:function(){var a=sessionStorage.getItem("cateid");$.ajax({type:"get",url:r,async:!0,dataType:"jsonp",data:{cate_id:a,shop_id:$.base64.decode($.cookie("userShopId"))},success:function(a){var b="<ul>";null!=a&&"000"==a.code&&($.each(a.data,function(a,c){$.each(c.service,function(a,c){b+='<li><span class="name">'+c.servicename+"</span>",b+='<input title="" type="text" value="'+c.cost+'">',b+='<span class="unit">'+c.unit+"</span>"})}),b+="</ul>",$(".edit_bottom").append(b))},error:function(){}})},showTable:function(){var a=sessionStorage.getItem("cateid");$.ajax({type:"get",url:r,async:!0,dataType:"jsonp",data:{cate_id:a,shop_id:$.base64.decode($.cookie("userShopId"))},success:function(a){if(null!=a&&"000"==a.code){var b="<ul>";$.each(a.data,function(a,c){$.each(c.service,function(a,c){b+='<li><span class="name">'+c.servicename+"</span>",b+='<span class="unit">'+c.unit+"</span>",b+='<span class="num">'+c.cost+"</span></li>"})}),b+="</ul>",$(".staff_bottom_content").append(b)}},error:function(){}})}},getShopInfoHandler={shopInfo:function(){h.controller("shop",["$scope","$http",function(a,b){function c(a){$(a).find("input").unbind("change").change(function(){var a=$(this),b=a.get(0).files[0],c=a.parent().parent().attr("img_id"),d=new FileReader;if(b){if(!/image\/\w+/.test(b.type))return a.parent().parent().css("background-image",""),a.parent().removeClass("opacity new"),layer.msg("请确保文件为图像类型"),a.val(""),!1;d.onload=function(b){void 0==c?a.parent().parent().attr("count",1):-1!=h.indexOf(c)&&(a.parent().parent().attr("count",1),h.push(c)),a.parent().addClass("opacity new"),a.parent().parent().css("background-image",'url("'+b.target.result+'")'),a.parent().parent().find(".close").show()},d.readAsDataURL(b)}})}b({method:"JSONP",url:w,params:{shop_id:$.base64.decode($.cookie("userShopId"))}}).success(function(b){if("000"===b.code){var c=b.data.opentime;c=c.substring(0,10),$("#shop_name").val(b.data.shop_name),$("#shop_describe").val(b.data.shop_describe),$("#shop_age").val(c),$("#shop_ad").val(b.data.shop_address);for(var d=b.data.servicearea.length,e=0;d>e;e++)""!=b.data.servicearea[e]&&$("#personal_circle").before('<a class="personal_area service_area" href="javascript:;">'+b.data.servicearea[e]+"</a>");for(var f=b.data.servicetag.length,e=0;f>e;e++)""!=b.data.servicetag[e]&&$("#personal_style").before('<a class="personal_style" href="javascript:;">'+b.data.servicetag[e]+"</a>");for(var g=b.data.authentication.length,e=0;g>e;e++)$("#shop_head").append("<span title="+ta[b.data.authentication[e]]+"></span>"),$("#shop_head span").eq(e).css("background-position","-"+20*(b.data.authentication[e]-1)+"px 0");b.data.shop_technics.length>=5?(a.infos=b.data.shop_technics.slice(0,5),$("#technic_add").hide(),$(".detail_p").css("marginTop","100px")):(a.infos=b.data.shop_technics,$("#technic_add").show(),$(".detail_p").css("marginTop","5px")),b.data.shop_technics.length>0?$.each(b.data.shop_technics,function(a,b){$(".detail_p").append("<b>"+b.technics_text+"</b>")}):$(".detail_p").append("<b>随便说点什么吧！</b>"),b.data.shop_imgs.length>=4?(a.imgs=b.data.shop_imgs.slice(0,4),$(".renderings_img").hide()):(a.imgs=b.data.shop_imgs,$(".renderings_img").show())}else layer.layer.msg(b.msg)}).error(function(){});var d=$(".shop_detail_style .edit"),e=$(".shop_detail_area .area_edit"),f=[],g=[];$.ajax({type:"get",url:I,async:!0,dataType:"jsonp",success:function(a){if(null!=a&&"000"==a.code){var b='<div class="tag_content clearfix">';$.each(a.data,function(a,c){b+="<span>"+c.stylename+"</span>"}),b+='</div><a href="javascript:;" class="besure">确定</a>',d.append(b).addClass("display")}},error:function(){}}),$("#personal_style").click(function(){d.removeClass("display");for(var a=0;a<$(".shop_detail_style .personal_style").length;a++)f[a]=$(".shop_detail_style .personal_style").eq(a).html();for(var a=0;a<$(".shop_detail_style .edit span").length;a++)$.inArray($(".shop_detail_style .edit span").eq(a).html(),f)>=0&&$(".shop_detail_style .edit span").eq(a).addClass("current");d.find("span").unbind("click").click(function(){if($(this).hasClass("current")){$(this).removeClass("current");for(var a=0;a<$(".shop_detail_style .personal_style").length;a++)$(this).html()==$(".shop_detail_style .personal_style").eq(a).html()&&$(".shop_detail_style .personal_style").eq(a).remove()}else $(this).addClass("current"),$("#personal_style").before('<a class="personal_style" href="javascript:;">'+$(this).html()+"</a>")}),d.find(".besure").unbind("click").click(function(){d.addClass("display"),f=[]})}),$("#personal_circle").click(function(){e.removeClass("display");for(var a=0;a<$(".shop_detail_area .personal_area").length;a++)g[a]=$(".shop_detail_area .personal_area").eq(a).html();for(var a=0;a<$(".shop_detail_area .area_edit span").length;a++)$.inArray($(".shop_detail_area .area_edit span").eq(a).html(),g)>=0&&$(".shop_detail_area .area_edit span").eq(a).addClass("current");e.find("span").unbind("click").click(function(){if($(this).hasClass("current")){$(this).removeClass("current");for(var a=0;a<$(".shop_detail_area .personal_area").length;a++)$(this).html()==$(".shop_detail_area .personal_area").eq(a).html()&&$(".shop_detail_area .personal_area").eq(a).remove()}else $(this).addClass("current"),$("#personal_circle").before('<a class="personal_area" href="javascript:;">'+$(this).html()+"</a>")}),e.find(".area_sure").unbind("click").click(function(){e.addClass("display"),g=[]})}),$("#shop_save").click(function(){for(var a=[],b=[],c=0;c<$(".personal_style").length;c++)a.push($(".personal_style").eq(c).html());for(var c=0;c<$(".personal_area").length;c++)b.push($(".personal_area").eq(c).html());$.ajax({url:J,type:"GET",async:!0,dataType:"jsonp",data:{shop_id:$.base64.decode($.cookie("userShopId")),shop_name:$("#shop_name").val(),shop_address:$("#shop_ad").val(),shop_describe:$("#shop_describe").val(),servicetag:a,servicearea:b},success:function(a){null!=a&&"000"==a.code&&layer.msg(a.msg)},error:function(){}})}),$(document).off("click","#complete_del").on("click","#complete_del",function(){var c=$(this).attr("technicsid");$.ajax({url:K,type:"GET",async:!0,dataType:"jsonp",data:{technics_id:c},success:function(c){"000"==c.code?(layer.msg(c.msg),$(".detail_p b").remove(),b({method:"JSONP",url:w,params:{shop_id:$.base64.decode($.cookie("userShopId"))}}).success(function(b){"000"===b.code?(b.data.shop_technics.length>=5?(a.infos=b.data.shop_technics.slice(0,5),$("#technic_add").hide(),$(".detail_p").css("marginTop","100px")):(a.infos=b.data.shop_technics,$("#technic_add").show(),$(".detail_p").css("marginTop","5px")),b.data.shop_technics.length>0?$.each(b.data.shop_technics,function(a,b){$(".detail_p").append("<b>"+b.technics_text+"</b>")}):$(".detail_p").append("<b>随便说点什么吧！</b>")):layer.msg(b.msg)})):layer.msg(c.msg)},error:function(){}})}),$(document).off("click","#img_del").on("click","#img_del",function(){var c=$(this).attr("imgid");$.ajax({url:L,type:"GET",async:!0,dataType:"jsonp",data:{img_id:c},success:function(c){"000"==c.code?(layer.msg(c.msg),b({method:"JSONP",url:w,params:{shop_id:$.base64.decode($.cookie("userShopId"))}}).success(function(b){"000"===b.code?b.data.shop_imgs.length>=4?(a.imgs=b.data.shop_imgs.slice(0,4),$(".renderings_img").hide()):(a.imgs=b.data.shop_imgs,$(".renderings_img").show()):layer.layer.msg(b.msg)})):layer.msg(c.msg)},error:function(){}})}),$("#technic_add").click(function(){$(".add_picture input").val("");var a=$(this).parents(".right_content_wrap").next(".add_technology");$(".add_technology").css("top",($(window).height()-a.outerHeight())/2+$(document).scrollTop()),$(".add_technology").show().removeClass("hide").removeClass("edit"),$(".wrap").show().removeClass("hide");var b=$(".add_picture"),d=b.find("a");d.removeClass("opacity"),b.css("background-image",""),b.find(".close").hide(),$("#textarea").val(""),c(".add_picture")});var h=[];$(document).on("click",".renderings_show_a",function(){var b=$(this).parents(".right_content_wrap").next(".add_technology");$(".add_technology").show().removeClass("hide").addClass("edit"),$(".add_technology").css("top",($(window).height()-b.outerHeight())/2+$(document).scrollTop()),$(".wrap").show().removeClass("hide");var d=a.infos,e=$(".craft_img");$.each(e,function(a){$(this).data("imgs",d[a].technics_img),$(this).data("text",d[a].technics_text),$(this).data("tid",d[a].technics_id)});var f=$(".add_picture"),g=f.find("a");g.removeClass("opacity new"),f.css("background-image",""),f.removeAttr("img_id"),f.removeAttr("count"),f.find(".close").hide();var h=$(this).prev().prev(),i=h.data("imgs");$.each(i,function(a,b){g.eq(a).addClass("opacity"),f.eq(a).css("background-image","url("+b.technics_img+")"),f.eq(a).find(".close").show(),f.eq(a).attr("img_id",b.img_id),f.eq(a).attr("count",0)}),$(".add_technology").attr("technics_id",h.data("tid")),$("#textarea").val(h.data("text")),c(".add_picture")}),$("#add_close").click(function(){$(".add_technology").hide(),$(".add_technology").removeClass("edit"),$(".add_technology .add_picture").removeAttr("img_id"),$(".add_technology .add_picture").removeAttr("count"),$(".wrap").hide()}),$(".close").click(function(){$(this).parent().find("a").removeClass("opacity new"),$(this).parent().css("background-image",""),$(this).parent().attr("count",0);var a=$(this).parent().attr("img_id");void 0!=a&&h.indexOf(a)<0&&h.push(a),$(this).hide()}),$(document).off("change","#renderings_file").on("change","#renderings_file",function(){var c=$(this),d=c.get(0).files[0];if(!/image\/\w+/.test(d.type))return layer.msg("请确保文件为图像类型"),c.val(""),!1;var e=new FormData;e.append("shop_id",$.base64.decode($.cookie("userShopId"))),e.append("myfile",$("#renderings_file")[0].files[0]),$.ajax({url:x,type:"POST",data:e,dataType:"jsonp",jsonp:"callback",cache:!1,processData:!1,contentType:!1,success:function(c){"000"===c.code?(b({method:"JSONP",url:w,params:{shop_id:$.base64.decode($.cookie("userShopId"))}}).success(function(b){if("000"===b.code){b.data.shop_imgs.length>=4?(a.imgs=b.data.shop_imgs.slice(0,4),$(".renderings_img").hide()):(a.imgs=b.data.shop_imgs,$(".renderings_img").show());var c=$("#renderings_img");c.css("backgroundImage",""),c.find("a").removeClass("opacity")}else layer.msg(b.msg)}),layer.msg(c.msg),$("#renderings_file").val("")):(layer.msg(c.msg),$("#renderings_file").val(""))},error:function(){alert("错误！！")}})}),$(document).off("click",".complete").on("click",".complete",function(){var c=0;if($(this).parent().parent().parent().hasClass("edit")){var d=new FormData;d.append("technics_id",$(".add_technology").attr("technics_id")),d.append("describe",$("#textarea").val());for(var e=0;3>e;e++)1==$(".add_technology .add_picture").eq(e).attr("count")&&c++;d.append("count",c),d.append("type",1);for(var e=0;e<h.length;e++)d.append("img_id[]",h[e]);for(var e=1;3>=e;e++)$("#file"+e).val()&&$("#file"+e).parent().hasClass("new")&&d.append("myfile[]",$("#file"+e)[0].files[0]);$.ajax({type:"POST",url:z,data:d,dataType:"jsonp",jsonp:"callback",cache:!1,processData:!1,contentType:!1,success:function(c){"000"==c.code?(layer.msg(c.msg),$(".detail_p b").remove(),$(".add_technology").hide(),$(".wrap").hide(),b({method:"JSONP",url:w,params:{shop_id:$.base64.decode($.cookie("userShopId"))}}).success(function(b){"000"===b.code?(b.data.shop_technics.length>=5?(a.infos=b.data.shop_technics.slice(0,5),$("#technic_add").hide(),$(".detail_p").css("marginTop","100px")):(a.infos=b.data.shop_technics,$("#technic_add").show(),$(".detail_p").css("marginTop","5px")),b.data.shop_technics.length>0?$.each(b.data.shop_technics,function(a,b){$(".detail_p").append("<b>"+b.technics_text+"</b>")}):$(".detail_p").append("<b>随便说点什么吧！</b>")):layer.layer.msg(b.msg)}).error(function(){})):layer.alert(c.msg)},error:function(){layer.alert("未知错误")}})}else{var d=new FormData;d.append("shop_id",$.base64.decode($.cookie("userShopId"))),d.append("describe",$("#textarea").val());for(var e=1;3>=e;e++)$("#file"+e).val()&&d.append("myfile[]",$("#file"+e)[0].files[0]);$.ajax({url:y,type:"POST",data:d,dataType:"jsonp",jsonp:"callback",cache:!1,processData:!1,contentType:!1,success:function(c){"000"===c.code?($(".detail_p b").remove(),layer.msg(c.msg),$(".add_technology").hide(),$(".wrap").hide(),b({method:"JSONP",url:w,params:{shop_id:$.base64.decode($.cookie("userShopId"))}}).success(function(b){"000"===b.code?(b.data.shop_technics.length>=5?(a.infos=b.data.shop_technics.slice(0,5),$("#technic_add").hide(),$(".detail_p").css("marginTop","100px")):(a.infos=b.data.shop_technics,$("#technic_add").show(),$(".detail_p").css("marginTop","5px")),b.data.shop_technics.length>0?$.each(b.data.shop_technics,function(a,b){$(".detail_p").append("<b>"+b.technics_text+"</b>")}):$(".detail_p").append("<b>随便说点什么吧！</b>")):layer.layer.msg(b.msg)}).error(function(){}),$(".add_picture input").val("")):layer.msg(c.msg)},error:function(){alert("错误！！")}})}})}])}},getWorkInfoHandler={workInfo:function(){h.controller("work",["$scope","$http",function(a,b){function c(){b({method:"JSONP",url:A,params:{foreman_id:ua,type:1,limit:4},beforeSend:function(){$(".complete_before .works_detail").remove(),$(".complete_before").append(ma)},complete:function(){$(".complete_before .loading").remove()}}).success(function(b){b&&"000"===b.code&&(b.data.length>=4?(a.works=b.data.slice(0,4),$(".new_album").hide()):(a.works=b.data,$(".new_album").show()),$(document).on("click",".works_detail",function(){sessionStorage.setItem("case_id",$(this).attr("caseid")),sessionStorage.setItem("isshopdetail","1")}))}).error(function(){})}c(),$(document).off("click",".complete_del").on("click",".complete_del",function(){var a=$(this).attr("caseId");$.ajax({url:C,type:"GET",async:!0,dataType:"jsonp",data:{case_id:a},success:function(a){a&&"000"==a.code?(layer.msg(a.msg),c()):layer.msg(a.msg)},error:function(){}})}),$.ajax({type:"get",url:A,async:!0,dataType:"jsonp",data:{foreman_id:ua,type:2,page:1,limit:8},success:function(a){if(a&&"000"===a.code){ka=a.data[0].total;var b="";$.each(a.data,function(a,c){b+=spliceWCompleteContent.spliceStrEvent(c)}),$(".works_complete").html(b),WCompletePageHandler.pageContentEvent()}else"117"==a.code?($(".works_completeWrap").remove(),$(".works_complete_wrap .not_information").show().removeClass("hide"),$(".works_complete_wrap .not_information_text").html("您现在还没有已完成的作品哦~~")):layer.msg(a.msg)},error:function(){}}),$.ajax({type:"get",url:A,async:!0,dataType:"jsonp",data:{foreman_id:ua,type:3,page:1,limit:8},success:function(a){if(a&&"000"===a.code){la=a.data[0].total;var b="";$.each(a.data,function(a,c){b+=spliceWUndoneContent.spliceStrEvent(c)}),$(".worksPending").html(b),WUndonePageHandler.pageContentEvent()}else"117"==a.code?($(".works_pending").remove(),$(".works_pending_wrap .not_information").show().removeClass("hide"),$(".works_pending_wrap .not_information_text").html("您现在还没有待完成的作品哦~~")):layer.msg(a.msg)},error:function(){}}),$(document).on("click","#detail_bg",function(){sessionStorage.setItem("step",$(this).attr("step")),sessionStorage.setItem("orderId",$(this).attr("orderId")),sessionStorage.setItem("status","已完成"),window.open("order.html#/order")}),$(document).on("click",".undone",function(){sessionStorage.setItem("step",$(this).parents(".works_detail").attr("step")),sessionStorage.setItem("orderId",$(this).parents(".works_detail").attr("orderId")),sessionStorage.setItem("status","订单进行中"),window.open("order.html#/order")})}])}},superSlide={slidePic:function(){$("#success_case").slide({titCell:".hd ul",mainCell:".bg_picture ul",autoPage:!1,trigger:"click",effect:"leftLoop",autoPlay:!1,vis:1})}},ajaxSubmit={confirmAdd:function(){var a=$(".new_areacnt input"),b=$(".room option:selected"),c=$(".hall option:selected"),d=$(".toilet option:selected"),e=$(".balcony option:selected"),f=$(".new_stylecnt span.active"),g=$(".year1 option:selected"),h=$(".month1 option:selected"),i=$(".day1 option:selected"),j=$(".year2 option:selected"),k=$(".month2 option:selected"),l=$(".day2 option:selected"),m=$(".detail_address input"),n=0,o=!0,p=b.val()+"室"+c.val()+"厅"+d.val()+"卫"+e.val()+"阳",q=g.val()+"."+h.val()+"."+i.val()+"-"+j.val()+"."+k.val()+"."+l.val(),r=new FormData;r.append("foreman_id",ua),r.append("housetype",p),r.append("style",f.html()),r.append("timelong",q),r.append("address",m.val()),r.append("area",a.val());for(var s=1;5>=s;s++)$("#file"+s).val()&&(r.append("myfile[]",$("#file"+s)[0].files[0]),n++);(""==a.val()||null==a.val())&&(errorRemind.errorContent(na,$(".new_area h3")),o=!1),("请选择"==b.val()||"请选择"==c.val()||"请选择"==d.val()||"请选择"==e.val())&&(errorRemind.errorContent(oa,$(".new_type h3")),o=!1),(""==f.html()||null==f.html())&&(errorRemind.errorContent(pa,$(".new_style h3")),o=!1),"-年份-"==g.html()||"-月份-"==h.html()||"-日期-"==i.html()||"-年份-"==j.html()||"-月份-"==k.html()||"-日期-"==l.html()?(errorRemind.errorContent(qa,$(".new_schedule h3")),o=!1):parseInt(g.html())>parseInt(j.html())?(errorRemind.errorContent(qa,$(".new_schedule h3")),o=!1):parseInt(g.html())==parseInt(j.html())&&parseInt(h.html())>parseInt(k.html())?(errorRemind.errorContent(qa,$(".new_schedule h3")),o=!1):parseInt(g.html())==parseInt(j.html())&&parseInt(h.html())==parseInt(k.html())&&parseInt(i.html())>=parseInt(l.html())&&(errorRemind.errorContent(qa,$(".new_schedule h3")),o=!1),(""==m.val()||null==m.val())&&(errorRemind.errorContent(ra,$(".new_address h3")),o=!1),0==n&&(errorRemind.errorContent(sa,$(".construction_picture h3")),o=!1),o&&$.ajax({type:"post",url:B,dataType:"jsonp",jsonp:"callback",data:r,cache:!1,processData:!1,contentType:!1,success:function(a){"000"==a.code?(window.location.href="#/master/mwork",location.reload(!0)):layer.alert("上传失败")},error:function(){layer.alert("未知错误")}})}},errorRemind={errorContent:function(a,b){b.siblings("label").text(a).addClass("whether")}},removeError={clickEvent:function(){$(".new_work_content>div").on("click",function(){$(this).children("label").removeClass("whether")})}},addPicture={constructionPic:function(){$(".add_picture input").on("change",function(){var a=$(this),b=a.get(0).files[0],c=new FileReader;return c.readAsDataURL(b),/image\/\w+/.test(b.type)?void(c.onload=function(b){a.parent().parent().addClass("clear"),a.parent().siblings(".close").show(),a.parent().parent().css({background:'url("'+b.target.result+'") no-repeat',backgroundSize:"100% 100%"}),$(".close").on("click",function(){$(this).parent().removeClass("clear"),$(this).parent().css("background",""),$(this).hide()})}):(a.parent().parent().css("background",""),a.parent().parent().removeClass("clear"),layer.alert("请确保文件为图像类型"),a.val(""),!1)})}},judgeNews={isnews:function(){$(".main_content").each(function(){"0"==$(this).attr("data-isread")&&$(this).addClass("isnews")})}},readNews={tobeRead:function(){$(".main_content .content").on("click",function(){var a=$(this).siblings(".cnt").html();if(layer.open({type:1,skin:"layui-layer-rim",area:["420px","240px"],content:"<p>"+a+"</p>"}),"0"==$(this).parent().attr("data-isread")){var b=$(this).parent().attr("data-id"),c=$(this).parent(),d=$(".left_ul li i").html();0!=d?(d--,0==d?$(".left_ul li i").remove():$(".left_ul li i").html(d)):$(".left_ul li i").remove(),$.ajax({type:"get",url:P,async:!0,dataType:"jsonp",data:{msgid:b},success:function(){c.attr("data-isread","1").removeClass("isnews")},error:function(){}})}})}},initInfo={info:function(){$.ajax({type:"get",url:N,async:!0,dataType:"jsonp",data:{user_id:ua,page:1,limit:10},success:function(a){null!=a&&"000"==a.code?($(".main_contentWrap").empty(),d=a.data[0].total,$.each(a.data,function(a,b){var c=spliceContentHandler.spliceStrEvent(b);$(".main_contentWrap").append(c)}),judgeNews.isnews(),readNews.tobeRead(),pageHandler.pageContentEvent(),deleteRecord.singleSelection(),markRead.checkAll()):"117"==a.code?($("#contentWrap").remove(),$(".not_information").show().removeClass("hide"),$(".not_information_text").html("您的消息空空如也~~")):layer.msg(a.msg)},error:function(){}})}},spliceContentHandler={spliceStrEvent:function(a){var b='<div class="main_content" data-isread="'+a.isread+'" data-id="'+a.id+'">';return b+='<span class="name">'+a.senduser+"</span>",b+='<span class="content">'+a.msgtitle+"</span>",b+='<span class="time">'+a.sendtime+"</span>",b+='<span class="cnt">'+a.msgcontent+"</span>",b+='<a class="delete" href="javascript:;"><em class="sprite-details"></em></a>',b+="</div>"}},pageHandler={pageContentEvent:function(){g=Math.ceil(d/10),$(".page_div3").empty().paging({total:g,animation:!1,centerBgColor:"#fff",centerFontColor:"#000",centerBorder:"1px solid #ddd",transition:"all .2s",centerHoverBgColor:"#eec988",centerHoverBorder:"1px solid #eec988",centerFontHoverColor:"#fff",otherFontHoverColor:"#fff",otherBorder:"1px solid #ddd",otherHoverBorder:"1px solid #eec988",otherBgColor:"#fff",otherHoverBgColor:"#eec988",currentFontColor:"#fff",currentBgColor:"#eec988",currentBorder:"1px solid #eec988",fontSize:13,currentFontSize:13,cormer:2,gapWidth:3,showJump:!0,jumpBgColor:"#fff",jumpFontHoverColor:"#fff",jumpHoverBgColor:"#eec988",jumpBorder:"1px solid #ddd",jumpHoverBorder:"1px solid #eec988",submitType:"get",idParameter:"page",url:N,ajaxData:{user_id:ua,page:1,limit:10},dataOperate:function(a){$(".main_contentWrap").empty(),$.each(a.data,function(a,b){var c=spliceContentHandler.spliceStrEvent(b);$(".main_contentWrap").append(c)}),judgeNews.isnews(),readNews.tobeRead(),deleteRecord.singleSelection()}})}},workpageHandler={pageContentEvent:function(a,b){g=Math.ceil(a/5),$(".page_div3").empty().paging({total:g,animation:!1,centerBgColor:"#fff",centerFontColor:"#000",centerBorder:"1px solid #ddd",transition:"all .2s",centerHoverBgColor:"#eec988",centerHoverBorder:"1px solid #eec988",centerFontHoverColor:"#fff",otherFontHoverColor:"#fff",otherBorder:"1px solid #ddd",otherHoverBorder:"1px solid #eec988",otherBgColor:"#fff",otherHoverBgColor:"#eec988",currentFontColor:"#fff",currentBgColor:"#eec988",currentBorder:"1px solid #eec988",fontSize:13,currentFontSize:13,cormer:2,gapWidth:3,showJump:!0,jumpBgColor:"#fff",jumpFontHoverColor:"#fff",jumpHoverBgColor:"#eec988",jumpBorder:"1px solid #ddd",jumpHoverBorder:"1px solid #eec988",submitType:"get",idParameter:"page",url:n,ajaxData:{shop_id:$.base64.decode($.cookie("userShopId")),cate_id:b,page:1,limit:5},dataOperate:function(a){$(".team_detail_content").remove();var b='<div class="team_detail_content clearfix">';$.each(a.data,function(a,c){b+='<div class="worker_box sprite_team" data-id="'+c.userid+'" data-action="edit"><a href="#/master/teamDetail_list">',b+='<div class="head_picture"><img src="'+c.portrait_img+'"></div>',b+='<div class="worker_content"><h3><span class="name">'+c.name+"</span>",b+='<span class="age">'+c.age+"岁</span></h3>",b+='<ul class="worker_information"><li>',b+='<span class="span_left">籍贯</span><span class="span_right">'+c.birthplace+"</span></li>",b+='<li><span class="span_left">从业时间</span><span class="span_right">'+c.worktime+"</span></li>",b+='<li><span class="span_left">手机号</span><span class="span_right">'+c.phone+"</span></li>",b+='<li><span class="span_left">身份证号</span><span class="span_right">'+c.idcard+"</span></li>",b+='<li><span class="span_left">开户银行</span><span class="span_right">'+c.bankname+"</span></li>",b+='<li><span class="span_left">银行卡号</span><span class="span_right">'+c.bankcard+"</span></li>",b+="</ul></div></a></div>"}),b+='<div class="worker_box sprite_team worker_add" data-action="add"><a href="#/master/teamDetail_edit"></a></div></div>',$(".team_detail_wrap .page_number").before(b),$(".team_detail_content .worker_box").on("click",function(){var a=$(this).attr("data-id"),b=$(this).attr("data-action");sessionStorage.setItem("userid",a),sessionStorage.setItem("action",b)})}})}},spliceOrderContent={spliceStrEvent:function(a){var b='<div class="order_box" step ="'+a.order_step+'" orderId ="'+a.order_id+'" status ="'+a.order_status+'">';return b+='<div class="ordercnt_title clearfix">',b+="<span>"+a.room+"室"+a.parlour+"厅"+a.toilet+"卫"+a.balcony+"阳台</span>",b+="<span>订单号</span>",b+="<span>"+a.order_id+"</span>",b+="<span>"+a.order_time+"</span>",b+="</div>",b+='<div class="ordercnt_content">',b+='<div class="block clearfix">',b+='<div class="name">',b+="<p>"+a.user_realname+"</p>",b+="<p>"+a.user_phone+"</p>",b+="</div>",b+='<div class="address">',b+="<span>"+a.order_address+"</span>",b+="</div>",b+='<div class="size area">',b+='<p class="item_hover_0">'+a.area+"</p>",b+="</div>",b+='<div class="stage">',b+="<span>"+a.order_status+"</span>",b+="</div>",b+='<div class="money">',b+=""!=a.actual_finish_amount&&null!=a.actual_finish_amount?"<span>"+a.actual_finish_amount+"</span>":"<span>0</span>",b+="</div>",b+='<div class="all">',b+='<a class="progress_updates">进度更新</a>',b+="</div>",b+="</div>",b+='<div class="order_detail display">',b+="<p>户型：三室两厅 &nbsp;&nbsp;餐厅、客厅、卧室、阳台、卫生间</p>",b+="<p>简介：起居室整体色彩干净清爽，浅色的背景墙和沙发让空间基调利落明快，而与之相对比的红色地毯则让空间现代化感更强，且不失活泼。利用侧面的“裸妆”墙体收货一个更为丰富且个性的立体装饰效果，同时也达到了客厅空间的收纳作用。</p>",b+="</div>",b+="</div>",b+="</div>"}},OrderPageHandler={pageContentEvent:function(a,b,c){$(".page_div3").empty().paging({total:Math.ceil(a/4),animation:!1,centerBgColor:"#fff",centerFontColor:"#000",centerBorder:"1px solid #ddd",transition:"all .2s",centerHoverBgColor:"#eec988",centerHoverBorder:"1px solid #eec988",centerFontHoverColor:"#fff",otherFontHoverColor:"#fff",otherBorder:"1px solid #ddd",otherHoverBorder:"1px solid #eec988",otherBgColor:"#fff",otherHoverBgColor:"#eec988",currentFontColor:"#fff",currentBgColor:"#eec988",currentBorder:"1px solid #eec988",fontSize:13,currentFontSize:13,cormer:2,gapWidth:3,showJump:!0,jumpBgColor:"#fff",jumpFontHoverColor:"#fff",jumpHoverBgColor:"#eec988",jumpBorder:"1px solid #ddd",jumpHoverBorder:"1px solid #eec988",submitType:"get",
idParameter:"page",url:b,ajaxData:c,dataOperate:function(a){$(".order_wrap").empty();var b="";$.each(a.data.order_list,function(c,d){"1"==a.data.order_list[c].order_status?a.data.order_list[c].order_status="待确认":"2"==a.data.order_list[c].order_status?a.data.order_list[c].order_status="待预约":"3"==a.data.order_list[c].order_status?a.data.order_list[c].order_status="待上门量房":"4"==a.data.order_list[c].order_status?a.data.order_list[c].order_status="待用户预支付":"5"==a.data.order_list[c].order_status?a.data.order_list[c].order_status="订单进行中":"6"==a.data.order_list[c].order_status?a.data.order_list[c].order_status="已完成":"7"==a.data.order_list[c].order_status?a.data.order_list[c].order_status="已取消":"8"==a.data.order_list[c].order_status&&(a.data.order_list[c].order_status="工长店铺取消"),b+=spliceOrderContent.spliceStrEvent(d),$(".order_wrap").html(b)})}})}},spliceWCompleteContent={spliceStrEvent:function(a){var b='<div class="works_detail fl works_bg">';return b+='<div class="detail_img">',b+='<img src="'+a.img[0].case_img+'">',b+="</div><!--detail_img-->",b+='<div id="detail_bg" class="detail_bg clearfix" step ="'+a.order_step+'" orderId ="'+a.case_id+'">',b+='<div class="detail_bg_div">',b+="</div><!--detail_bg_div-->",b+='<div class="detail_bg_content">',b+="<dl>",b+="<dd><span>"+a.area+"</span>m<sup>2</sup></dd>",b+="<dd>"+a.style+"</dd>",b+="<dd>"+a.housetype+"</dd>",b+="</dl>",b+="</div><!--detail_bg_content-->",b+="</div><!--detail_bg-->",b+="</div><!--works_detail-->"}},WCompletePageHandler={pageContentEvent:function(){$(".page_div4").empty().paging({total:Math.ceil(ka/8),animation:!1,centerBgColor:"#fff",centerFontColor:"#000",centerBorder:"1px solid #ddd",transition:"all .2s",centerHoverBgColor:"#eec988",centerHoverBorder:"1px solid #eec988",centerFontHoverColor:"#fff",otherFontHoverColor:"#fff",otherBorder:"1px solid #ddd",otherHoverBorder:"1px solid #eec988",otherBgColor:"#fff",otherHoverBgColor:"#eec988",currentFontColor:"#fff",currentBgColor:"#eec988",currentBorder:"1px solid #eec988",fontSize:13,currentFontSize:13,cormer:2,gapWidth:3,showJump:!0,jumpBgColor:"#fff",jumpFontHoverColor:"#fff",jumpHoverBgColor:"#eec988",jumpBorder:"1px solid #ddd",jumpHoverBorder:"1px solid #eec988",submitType:"get",idParameter:"page",url:A,ajaxData:{foreman_id:ua,type:2,page:1,limit:8},dataOperate:function(a){var b="";$.each(a.data,function(a,c){b+=spliceWCompleteContent.spliceStrEvent(c)}),$(".works_complete").html(b)}})}},spliceWUndoneContent={spliceStrEvent:function(a){var b='<div class="works_detail fl complete_img" step ="'+a.order_step+'" orderId ="'+a.case_id+'">';return b+='<div class="detail_img">',b+='<img src="'+a.img[0].case_img+'">',b+="</div><!--detail_img-->",b+='<div class="pending_font undone clearfix">',b+='<p class="pending_address fl"><em class="address_em sprite_team"></em>'+a.address+"</p>",b+='<p class="pending_name fl"><em class="sprite_team"></em>'+a.area+" m<sup>2</sup></p>",b+='<p class="pending_tel fl"><em class="sprite_team"></em>'+a.housetype+"</p>",b+="</div><!--pending_font-->",b+='<div class="bg undone"></div>',b+="</div><!--works_detail-->"}},WUndonePageHandler={pageContentEvent:function(){$(".page_div5").empty().paging({total:Math.ceil(la/8),animation:!1,centerBgColor:"#fff",centerFontColor:"#000",centerBorder:"1px solid #ddd",transition:"all .2s",centerHoverBgColor:"#eec988",centerHoverBorder:"1px solid #eec988",centerFontHoverColor:"#fff",otherFontHoverColor:"#fff",otherBorder:"1px solid #ddd",otherHoverBorder:"1px solid #eec988",otherBgColor:"#fff",otherHoverBgColor:"#eec988",currentFontColor:"#fff",currentBgColor:"#eec988",currentBorder:"1px solid #eec988",fontSize:13,currentFontSize:13,cormer:2,gapWidth:3,showJump:!0,jumpBgColor:"#fff",jumpFontHoverColor:"#fff",jumpHoverBgColor:"#eec988",jumpBorder:"1px solid #ddd",jumpHoverBorder:"1px solid #eec988",submitType:"get",idParameter:"page",url:A,ajaxData:{foreman_id:ua,type:3,page:1,limit:8},dataOperate:function(a){var b="";$.each(a.data,function(a,c){b+=spliceWUndoneContent.spliceStrEvent(c)}),$(".WUndonePageHandler").html(b)}})}},deleteRecord={singleSelection:function(){$(".main_contentWrap .delete").on("click",function(){var a=$(this).parent().attr("data-id");$.ajax({type:"get",url:O,async:!0,dataType:"jsonp",data:{id:a},success:function(a){null!=a&&"000"==a.code?(initInfo.info(),layer.msg(a.msg)):layer.alert(a.msg)},error:function(){}})})}},markRead={checkAll:function(){$(document).on("click",".set_default input",function(){$(this).is(":checked")?$(this).siblings("em").removeClass("checked"):$(this).siblings("em").addClass("checked")}),$(".information_choose a").on("click",function(){$(".information_choose .set_default em").hasClass("checked")?$.ajax({type:"get",url:Q,async:!0,dataType:"jsonp",data:{user_id:ua},success:function(a){null!=a&&"000"==a.code?($(".main_content").attr("data-isread","1").removeClass("isnews"),$(".left_ul li i").remove()):layer.alert(a.msg)},error:function(){}}):layer.alert("请先选中全选按钮")})}},xa.init()}();