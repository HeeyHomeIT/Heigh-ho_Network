angular.module("tm.pagination",[]).directive("tmPagination",[function(){return{restrict:"EA",template:'<div class="page-list page_number"><ul class="pagination" ng-show="conf.totalItems > 0"><li ng-class="{disabled: conf.currentPage == 1}" ng-click="prevPage()"><span class="previous">上一页</span></li><li ng-repeat="item in pageList track by $index" ng-class="{active: item == conf.currentPage, separate: item == \'...\'}" ng-click="changeCurrentPage(item)"><span class="num_page">{{ item }}</span></li><li ng-class="{disabled: conf.currentPage == conf.numberOfPages}" ng-click="nextPage()"><span class="next">下一页</span></li></ul><div class="page-total" ng-show="conf.totalItems > 0">',replace:!0,scope:{conf:"="},link:function(scope){function getPagination(){if(conf.currentPage&&(conf.currentPage=parseInt(scope.conf.currentPage,10)),conf.currentPage||(conf.currentPage=1),conf.totalItems&&(conf.totalItems=parseInt(conf.totalItems,10)),!conf.totalItems)return void(conf.totalItems=0);conf.itemsPerPage&&(conf.itemsPerPage=parseInt(conf.itemsPerPage,10)),conf.itemsPerPage||(conf.itemsPerPage=defaultPerPage),conf.numberOfPages=Math.ceil(conf.totalItems/conf.itemsPerPage),scope.conf.numberOfPages>0&&scope.conf.currentPage>scope.conf.numberOfPages&&(scope.conf.currentPage=scope.conf.numberOfPages);for(var perPageOptionsStatus,perPageOptionsLength=scope.conf.perPageOptions.length,i=0;perPageOptionsLength>i;i++)conf.perPageOptions[i]==conf.itemsPerPage&&(perPageOptionsStatus=!0);if(perPageOptionsStatus||conf.perPageOptions.push(conf.itemsPerPage),conf.perPageOptions.sort(function(a,b){return a-b}),scope.pageList=[],conf.numberOfPages<=conf.pagesLength)for(i=1;i<=conf.numberOfPages;i++)scope.pageList.push(i);else{var offset=(conf.pagesLength-1)/2;if(conf.currentPage<=offset){for(i=1;offset+1>=i;i++)scope.pageList.push(i);scope.pageList.push("..."),scope.pageList.push(conf.numberOfPages)}else if(conf.currentPage>conf.numberOfPages-offset){for(scope.pageList.push(1),scope.pageList.push("..."),i=offset+1;i>=1;i--)scope.pageList.push(conf.numberOfPages-i);scope.pageList.push(conf.numberOfPages)}else{for(scope.pageList.push(1),scope.pageList.push("..."),i=Math.ceil(offset/2);i>=1;i--)scope.pageList.push(conf.currentPage-i);for(scope.pageList.push(conf.currentPage),i=1;offset/2>=i;i++)scope.pageList.push(conf.currentPage+i);scope.pageList.push("..."),scope.pageList.push(conf.numberOfPages)}}scope.$parent.conf=conf}var conf=scope.conf,defaultPagesLength=9,defaultPerPage=15;conf.pagesLength?(conf.pagesLength=parseInt(conf.pagesLength,10),conf.pagesLength||(conf.pagesLength=defaultPagesLength),conf.pagesLength%2===0&&(conf.pagesLength+=1)):conf.pagesLength=defaultPagesLength,conf.perPageOptions||(conf.perPageOptions=defaultPagesLength),scope.prevPage=function(){conf.currentPage>1&&(conf.currentPage-=1),getPagination(),conf.onChange&&conf.onChange()},scope.nextPage=function(){conf.currentPage<conf.numberOfPages&&(conf.currentPage+=1),getPagination(),conf.onChange&&conf.onChange()},scope.changeCurrentPage=function(item){"..."!=item&&(conf.currentPage=item,getPagination(),conf.onChange&&conf.onChange())},scope.changeItemsPerPage=function(){conf.currentPage=1,getPagination(),conf.onChange&&conf.onChange()},scope.jumpToPage=function(){num=scope.jumpPageNum,num.match(/\d+/)&&(num=parseInt(num,10),num&&num!=conf.currentPage&&(num>conf.numberOfPages&&(num=conf.numberOfPages),conf.currentPage=num,getPagination(),conf.onChange&&conf.onChange(),scope.jumpPageNum=""))},scope.jumpPageKeyUp=function(e){var keycode=window.event?e.keyCode:e.which;13==keycode&&scope.jumpToPage()},scope.$watch("conf.totalItems",function(value,oldValue){value&&value!=oldValue||conf.onChange&&conf.onChange(),getPagination()})}}}]);