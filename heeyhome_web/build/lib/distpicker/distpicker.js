/*!
 * Distpicker v1.0.4
 * https://github.com/fengyuanchen/distpicker
 *
 * Copyright (c) 2014-2016 Fengyuan Chen
 * Released under the MIT license
 *
 * Date: 2016-06-01T15:05:52.606Z
 */

!function(factory){"function"==typeof define&&define.amd?define(["jquery","ChineseDistricts"],factory):"object"==typeof exports?factory(require("jquery"),require("ChineseDistricts")):factory(jQuery,ChineseDistricts)}(function($,ChineseDistricts){function Distpicker(element,options){this.$element=$(element),this.options=$.extend({},Distpicker.DEFAULTS,$.isPlainObject(options)&&options),this.placeholders=$.extend({},Distpicker.DEFAULTS),this.active=!1,this.init()}if("undefined"==typeof ChineseDistricts)throw new Error('The file "distpicker.data.js" must be included first!');var NAMESPACE="distpicker",EVENT_CHANGE="change."+NAMESPACE,PROVINCE="province",CIRY="city",DISTRICT="district";Distpicker.prototype={constructor:Distpicker,init:function(){var options=this.options,$select=this.$element.find("select"),length=$select.length,data={};$select.each(function(){$.extend(data,$(this).data())}),$.each([PROVINCE,CIRY,DISTRICT],$.proxy(function(i,type){data[type]?(options[type]=data[type],this["$"+type]=$select.filter("[data-"+type+"]")):this["$"+type]=length>i?$select.eq(i):null},this)),this.bind(),this.reset(),this.active=!0},bind:function(){this.$province&&this.$province.on(EVENT_CHANGE,this._changeProvince=$.proxy(function(){this.output(CIRY),this.output(DISTRICT)},this)),this.$city&&this.$city.on(EVENT_CHANGE,this._changeCity=$.proxy(function(){this.output(DISTRICT)},this))},unbind:function(){this.$province&&this.$province.off(EVENT_CHANGE,this._changeProvince),this.$city&&this.$city.off(EVENT_CHANGE,this._changeCity)},output:function(type){var code,matched,value,options=this.options,placeholders=this.placeholders,$select=this["$"+type],districts={},data=[];$select&&$select.length&&(value=options[type],code=type===PROVINCE?86:type===CIRY?this.$province&&this.$province.find(":selected").data("code"):type===DISTRICT?this.$city&&this.$city.find(":selected").data("code"):code,districts=$.isNumeric(code)?ChineseDistricts[code]:null,$.isPlainObject(districts)&&$.each(districts,function(code,address){var selected=address===value;selected&&(matched=!0),data.push({code:code,address:address,selected:selected})}),matched||(data.length&&(options.autoSelect||options.autoselect)&&(data[0].selected=!0),!this.active&&value&&(placeholders[type]=value)),options.placeholder&&data.unshift({code:"",address:placeholders[type],selected:!1}),$select.html(this.getList(data)))},getList:function(data){var list=[];return $.each(data,function(i,n){list.push('<option value="'+(n.address&&n.code?n.address:"")+'" data-code="'+(n.code||"")+'"'+(n.selected?" selected":"")+">"+(n.address||"")+"</option>")}),list.join("")},reset:function(deep){deep?this.$province&&this.$province.find(":first").prop("selected",!0).trigger(EVENT_CHANGE):(this.output(PROVINCE),this.output(CIRY),this.output(DISTRICT))},destroy:function(){this.unbind(),this.$element.removeData(NAMESPACE)}},Distpicker.DEFAULTS={autoSelect:!0,placeholder:!1,province:"—— 省 ——",city:"—— 市 ——",district:"—— 区 ——"},Distpicker.setDefaults=function(options){$.extend(Distpicker.DEFAULTS,options)},Distpicker.other=$.fn.distpicker,$.fn.distpicker=function(option){var args=[].slice.call(arguments,1);return this.each(function(){var options,fn,$this=$(this),data=$this.data(NAMESPACE);if(!data){if(/destroy/.test(option))return;options=$.extend({},$this.data(),$.isPlainObject(option)&&option),$this.data(NAMESPACE,data=new Distpicker(this,options))}"string"==typeof option&&$.isFunction(fn=data[option])&&fn.apply(data,args)})},$.fn.distpicker.Constructor=Distpicker,$.fn.distpicker.setDefaults=Distpicker.setDefaults,$.fn.distpicker.noConflict=function(){return $.fn.distpicker=Distpicker.other,this},$(function(){})});