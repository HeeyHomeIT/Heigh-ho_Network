!function($){$.extend($.fn,{dialog:function(options){return this.each(function(){var dialog=$.data(this,"dialog");dialog||(dialog=new $.dialog(options,this),$.data(this,"dialog",dialog))})}}),$.dialog=function(options,el){arguments.length&&this._init(options,el)},$.dialog.prototype={options:{title:"title",showHeader:!0,dragable:!1,cache:!0,html:"",width:"auto",height:"auto",cannelBtn:!0,confirmBtn:!0,cannelText:"Cannel",confirmText:"Confirm",showFooter:!0,onClose:!1,onOpen:!1,onConfirm:!1,onCannel:!1,getContent:!1},_init:function(options,el){this.options=$.extend(!0,{},this.options,options),this.element=$(el),this._build(this.options.html),this._bindEvents()},_bindEvents:function(){var self=this;this.element.delegate(".close","click",function(){self.close(self.options.onClose)}),this.element.delegate(".cannel","click",function(){self._cannel(self.options.onCannel)}),this.element.delegate(".confirm","click",function(){self._confirm(self.options.onConfirm)}),$(window).bind("resize",function(){self._center(),self._setLayerWidthHeight()}),self.options.dragable&&self._dragable()},_build:function(html){var html,footer="",header="",cfBtn="",clBtn="",bodyContent='<div class="body-content"></div>';if(html)html=html;else{if(this.options.confirmBtn&&(cfBtn='<button class="confirm">'+this.options.confirmText+"</button>"),this.options.cannelBtn&&(clBtn='<button class="cannel">'+this.options.cannelText+"</button>"),this.options.showFooter&&(footer='<div class="footer">											<div class="buttons">												'+cfBtn+"												"+clBtn+"											</div>										</div>"),this.options.showHeader&&(header='<div class="header">          									<h2 style="width:'+this.options.width+'px;">'+this.options.title+'</h2>          									<s class="close">X</s>          								</div>'),this.options.showFooter){var h=this.options.height-80;bodyContent='<div class="body-content" style="height:'+h+'px;"></div>'}else bodyContent='<div class="body-content" style="height:'+this.options.height+'px;"></div>';html='<div class="dialog">                '+header+'								<div class="body" style="width:'+this.options.width+"px;height:"+this.options.height+'px;">									'+bodyContent+"								</div>"+footer+'<iframe frameborder="0" border="0" class="lay"></div>'}this.element.html(html),$("body").append("<div class='layer-box' style='display:none;'><div class='back'></div><iframe frameborder='0' border='0' class='lay'></div>"),this.options.getContent&&this._setContent(this.options.getContent),this._center(),this._setLayerWidthHeight()},_dragable:function(){var d,startObjectX,startObjectY,h=this.element.find(".header").find("h2"),c=this.element.find(".dialog"),dragging=!1,ondragstart=function(e){dragging=!0;var pos=c.offset();startObjectX=pos.left,startObjectY=pos.top,d={maxX:$(document).width()-c.width(),maxY:$(document).height()-c.height(),posX:e.clientX-startObjectX,posY:e.clientY-startObjectY}},ondragging=function(e){dragging&&c.css({left:Math.max(0,Math.min(e.clientX-d.posX,d.maxX))+"px",top:Math.max(0,Math.min(e.clientY-d.posY,d.maxY))+"px"})},ondragstop=function(){dragging=!1};h.mousedown(ondragstart),$(document).mousemove(ondragging).mouseup(ondragstop),h.undraggable=function(){return h.unbind("mousedown",ondragstart),$(document).unbind("mousemove",ondragging).unbind("mouseup",ondragstop),delete h.undraggable,ondragstart=ondragstop=ondragging=null,this}},_center:function(){var d=this.element.find(".dialog");d.css({left:($(document).width()-d.width())/2,top:(document.documentElement.clientHeight-d.height())/2+$(document).scrollTop()})},_setLayerWidthHeight:function(){this._getDocHeight(),this._getDocWidth();$(".layer-box, .layer-box .back,.layer-box .lay").css({width:this._getDocWidth(),height:this._getDocHeight()})},_getDocHeight:function(){var d=document;return Math.max(d.body.scrollHeight,d.documentElement.scrollHeight,d.body.offsetHeight,d.documentElement.offsetHeight,d.body.clientHeight,d.documentElement.clientHeight)},_getDocWidth:function(){var d=document;return Math.max(Math.max(d.body.scrollWidth,d.documentElement.scrollWidth),Math.max(d.body.offsetWidth,d.documentElement.offsetWidth),Math.max(d.body.clientWidth,d.documentElement.clientWidth))},_confirm:function(cb){this._callback(cb),this._hide(),this.clearCache()},_cannel:function(cb){this._callback(cb),this._hide(),this.clearCache()},close:function(cb){this._callback(cb),this._hide(),this.clearCache()},open:function(cb){this._callback(cb),this.element.show(),$(".layer-box").show(),this._center(),this._setLayerWidthHeight(),this.clearCache()},clearCache:function(){this.options.cache||this.element.data("dialog","")},_hide:function(){this.element.hide(),$(".layer-box").hide()},_callback:function(cb){cb&&"function"==typeof cb&&cb.call(this)},_setContent:function(cb){cb&&"function"==typeof cb&&cb()}},$.extend($.fn,{open:function(cb){$(this).data("dialog")&&$(this).data("dialog").open(cb)},close:function(cb){$(this).data("dialog")&&$(this).data("dialog").close(cb)}})}(jQuery);